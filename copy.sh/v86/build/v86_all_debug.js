'use strict';var k,aa=[[1,""],[2,"CPU"],[32768,"DISK"],[4,"FPU"],[8,"MEM"],[16,"DMA"],[32,"IO"],[64,"PS2"],[128,"PIC"],[256,"VGA"],[512,"PIT"],[1024,"MOUS"],[2048,"PCI"],[4096,"BIOS"],[8192,"FLOP"],[16384,"SERI"],[65536,"RTC"],[262144,"ACPI"],[524288,"APIC"],[1048576,"NET"],[2097152,"VIO"],[4194304,"9P"],[8388608,"SB16"],[16777216,"FETC"]];const da=["shared","exclusive","unlock"];
function fa(a,b,c){this.h=a;this.A=c;this.C=[104,111,115,116,57,112];this.G=this.C.length;this.D="9P2000.L";this.j=this.u=8192;this.i=new Uint8Array(2*this.j);this.o=0;this.g=[];this.V=new ha(b,{name:"virtio-9p",Ta:48,Xe:4169,Eg:9,Ve:{ob:43008,$:[{ab:32,pb:0}],features:[0,32,29,28],Rh:()=>{}},notification:{ob:43264,Cg:!1,$e:[d=>{if(0!==d)l(!1,"Virtio9P Notified for non-existent queue: "+d+" (expected queue_id of 0)");else{for(;ia(this.l);)d=ja(this.l),la(this,d);d=this.l;l(!0,"Must skip a non-negative number of requests");
const e=d.s.Da(d.g+2)+0&65535;d.s.Xd(d.h+4+8*d.size,e)}}]},Ic:{ob:42752},cg:{ob:42496,qd:[{bytes:2,name:"mount tag length",read:()=>this.G,write:()=>{}}].concat(Array.from(Array(254).keys()).map(d=>({bytes:1,name:"mount tag name "+d,read:()=>this.C[d]||0,write:()=>{}})))}});this.l=this.V.$[0]}fa.prototype.ea=function(){var a=[];a[0]=this.C;a[1]=this.G;a[2]=this.V;a[3]=this.D;a[4]=this.u;a[5]=this.j;a[6]=this.i;a[7]=this.o;a[8]=this.g.map(function(b){return[b.ha,b.type,b.uid,b.ib]});a[9]=this.h;return a};
fa.prototype.I=function(a){this.C=a[0];this.G=a[1];this.V.I(a[2]);this.l=this.V.$[0];this.D=a[3];this.u=a[4];this.j=a[5];this.i=a[6];this.o=a[7];this.g=a[8].map(function(b){return{ha:b[0],type:b[1],uid:b[2],ib:b[3]}});this.h.I(a[9])};fa.prototype.reset=function(){this.g=[];this.V.reset()};function ma(a,b,c,d){l(0<=d,"9P: Negative payload size");oa(["w","b","h"],[d+7,b+1,c],a.i,0);d+7>=a.i.length&&q("Error in 9p: payloadsize exceeds maximum length");a.o=d+7}
function pa(a,b,c){c=oa(["w"],[c],a.i,7);ma(a,6,b,c)}function v(a,b){l(0<=a.o,"9P: Negative replybuffersize");qa(b,a.i.subarray(0,a.o));ra(a.l,b);sa(a.l)}
async function la(a,b){var c=new Uint8Array(b.ye);ta(b,c);var d={offset:0},e=A(["w","b","h"],c,d),f=e[0],h=e[1],g=e[2];switch(h){case 8:f=ua(a.h);c=va(a.h);e=[16914839];e[1]=a.u;e[2]=Math.floor(c/e[1]);e[3]=e[2]-Math.floor(f/e[1]);e[4]=e[2]-Math.floor(f/e[1]);e[5]=wa(a.h);e[6]=xa(a.h);e[7]=0;e[8]=256;f=oa("wwddddddw".split(""),e,a.i,7);ma(a,h,g,f);v(a,b);break;case 112:case 12:e=A(["w","w"],c,d);var m=e[0];d=e[1];q("[open] fid="+m+", mode="+d);c=a.g[m].ha;var n=ya(a.h,c);q("file open "+a.g[m].ib);
f=za(a.h,c,d);Aa(a.h,a.g[m].ha,function(){q("file opened "+this.g[m].ib+" tag:"+g);var y=[];y[0]=n.Ua;y[1]=this.j-24;oa(["Q","w"],y,this.i,7);ma(this,h,g,17);v(this,b)}.bind(a));break;case 70:e=A(["w","w","s"],c,d);c=e[0];m=e[1];f=e[2];q("[link] dfid="+c+", name="+f);f=Ca(a.h,a.g[c].ha,a.g[m].ha,f);if(0>f){-1!==f&&l(!1,"[link]: Unexpected error code: "+-f);pa(a,g,-f);v(a,b);break}ma(a,h,g,0);v(a,b);break;case 16:e=A(["w","s","s","w"],c,d);m=e[0];f=e[1];c=e[2];e=e[3];q("[symlink] fid="+m+", name="+
f+", symgt="+c+", gid="+e);c=Da(a.h,f,a.g[m].ha,c);n=ya(a.h,c);n.uid=a.g[m].uid;n.eb=e;oa(["Q"],[n.Ua],a.i,7);ma(a,h,g,13);v(a,b);break;case 18:e=A("wswwww".split(""),c,d);m=e[0];f=e[1];d=e[2];c=e[3];var p=e[4];e=e[5];q("[mknod] fid="+m+", name="+f+", major="+c+", minor="+p);c=Ea(a.h,f,a.g[m].ha,c,p);n=ya(a.h,c);n.mode=d;n.uid=a.g[m].uid;n.eb=e;oa(["Q"],[n.Ua],a.i,7);ma(a,h,g,13);v(a,b);break;case 22:e=A(["w"],c,d);m=e[0];n=ya(a.h,a.g[m].ha);q("[readlink] fid="+m+" name="+a.g[m].ib+" target="+n.gf);
f=oa(["s"],[n.gf],a.i,7);ma(a,h,g,f);v(a,b);break;case 72:e=A(["w","s","w","w"],c,d);m=e[0];f=e[1];d=e[2];e=e[3];q("[mkdir] fid="+m+", name="+f+", mode="+d+", gid="+e);c=Fa(a.h,f,a.g[m].ha);n=ya(a.h,c);n.mode=d|Ia;n.uid=a.g[m].uid;n.eb=e;oa(["Q"],[n.Ua],a.i,7);ma(a,h,g,13);v(a,b);break;case 14:e=A(["w","s","w","w","w"],c,d);m=e[0];f=e[1];c=e[2];d=e[3];e=e[4];a.A.send("9p-create",[f,a.g[m].ha]);q("[create] fid="+m+", name="+f+", flags="+c+", mode="+d+", gid="+e);c=Ja(a.h,f,a.g[m].ha);a.g[m].ha=c;a.g[m].type=
1;a.g[m].ib=f;n=ya(a.h,c);n.uid=a.g[m].uid;n.eb=e;n.mode=d|Ka;oa(["Q","w"],[n.Ua,a.j-24],a.i,7);ma(a,h,g,17);v(a,b);break;case 52:e=A("wbwddws".split(""),c,d);m=e[0];c=e[2];f=0===e[4]?Infinity:e[4];e=La(e[1],e[3],f,e[5],e[6]);q("[lock] fid="+m+", type="+da[e.type]+", start="+e.start+", length="+e.length+", proc_id="+e.g);f=Ma(a.h,a.g[m].ha,e,c);oa(["b"],[f],a.i,7);ma(a,h,g,1);v(a,b);break;case 54:e=A("wbddws".split(""),c,d);m=e[0];f=0===e[3]?Infinity:e[3];e=La(e[1],e[2],f,e[4],e[5]);q("[getlock] fid="+
m+", type="+da[e.type]+", start="+e.start+", length="+e.length+", proc_id="+e.g);f=Pa(a.h,a.g[m].ha,e);f||(f=e,f.type=2);f=oa(["b","d","d","w","s"],[f.type,f.start,Infinity===f.length?0:f.length,f.g,f.h],a.i,7);ma(a,h,g,f);v(a,b);break;case 24:e=A(["w","d"],c,d);m=e[0];n=ya(a.h,a.g[m].ha);q("[getattr]: fid="+m+" name="+a.g[m].ib+" request mask="+e[1]);if(!n||n.status===Qa){q("getattr: unlinked");pa(a,g,2);v(a,b);break}e[0]=e[1];e[1]=n.Ua;e[2]=n.mode;e[3]=n.uid;e[4]=n.eb;e[5]=n.Ja;e[6]=n.pg<<8|n.qg;
e[7]=n.size;e[8]=a.u;e[9]=Math.floor(n.size/512+1);e[10]=n.ne;e[11]=0;e[12]=n.ed;e[13]=0;e[14]=n.We;e[15]=0;e[16]=0;e[17]=0;e[18]=0;e[19]=0;oa("dQwwwddddddddddddddd".split(""),e,a.i,7);ma(a,h,g,153);v(a,b);break;case 26:e=A("wwwwwddddd".split(""),c,d);m=e[0];n=ya(a.h,a.g[m].ha);q("[setattr]: fid="+m+" request mask="+e[1]+" name="+a.g[m].ib);e[1]&1&&(n.mode=e[2]);e[1]&2&&(n.uid=e[3]);e[1]&4&&(n.eb=e[4]);e[1]&16&&(n.ne=Math.floor((new Date).getTime()/1E3));e[1]&32&&(n.ed=Math.floor((new Date).getTime()/
1E3));e[1]&64&&(n.We=Math.floor((new Date).getTime()/1E3));e[1]&128&&(n.ne=e[6]);e[1]&256&&(n.ed=e[8]);e[1]&8&&await Ra(a.h,a.g[m].ha,e[5]);ma(a,h,g,0);v(a,b);break;case 50:e=A(["w","d"],c,d);m=e[0];ma(a,h,g,0);v(a,b);break;case 40:case 116:e=A(["w","d","w"],c,d);m=e[0];f=e[1];p=e[2];n=ya(a.h,a.g[m].ha);40===h&&q("[treaddir]: fid="+m+" offset="+f+" count="+p);116===h&&q("[read]: fid="+m+" ("+a.g[m].ib+") offset="+f+" count="+p+" fidtype="+a.g[m].type);if(!n||n.status===Qa){q("read/treaddir: unlinked");
pa(a,g,2);v(a,b);break}if(2===a.g[m].type){(void 0).length<f+p&&(p=(void 0).length-f);for(e=0;e<p;e++)a.i[11+e]=(void 0)[f+e];oa(["w"],[p],a.i,7);ma(a,h,g,4+p)}else za(a.h,a.g[m].ha,void 0),e=a.g[m].ha,p=Math.min(p,a.i.length-11),n.size<f+p?p=n.size-f:40===h&&(p=Sa(a.h,e,f+p)-f),f>n.size&&(p=0),a.A.send("9p-read-start",[a.g[m].ib]),e=await Ta(a.h,e,f,p),a.A.send("9p-read-end",[a.g[m].ib,p]),e&&a.i.set(e,11),oa(["w"],[p],a.i,7),ma(a,h,g,4+p);v(a,b);break;case 118:e=A(["w","d","w"],c,d);m=e[0];f=e[1];
p=e[2];e=a.g[m].ib;q("[write]: fid="+m+" ("+e+") offset="+f+" count="+p+" fidtype="+a.g[m].type);if(2===a.g[m].type){pa(a,g,95);v(a,b);break}else await Wa(a.h,a.g[m].ha,f,p,c.subarray(d.offset));a.A.send("9p-write-end",[e,p]);oa(["w"],[p],a.i,7);ma(a,h,g,4);v(a,b);break;case 74:e=A(["w","s","w","s"],c,d);f=e[0];c=e[1];d=e[2];e=e[3];q("[renameat]: oldname="+c+" newname="+e);f=await Xa(a.h,a.g[f].ha,c,a.g[d].ha,e);if(0>f){-2!==f&&-1!==f&&-39!==f&&l(!1,"[renameat]: Unexpected error code: "+-f);pa(a,
g,-f);v(a,b);break}ma(a,h,g,0);v(a,b);break;case 76:e=A(["w","s","w"],c,d);d=e[0];f=e[1];c=e[2];q("[unlink]: dirfd="+d+" name="+f+" flags="+c);m=Ya(a.h,a.g[d].ha,f);if(-1===m){pa(a,g,2);v(a,b);break}f=Za(a.h,a.g[d].ha,f);if(0>f){-39!==f&&-1!==f&&l(!1,"[unlink]: Unexpected error code: "+-f);pa(a,g,-f);v(a,b);break}ma(a,h,g,0);v(a,b);break;case 100:e=A(["w","s"],c,d);q("[version]: msize="+e[0]+" version="+e[1]);a.j!==e[0]&&(a.j=e[0],a.i=new Uint8Array(Math.min(16777216,2*a.j)));f=oa(["w","s"],[a.j,
a.D],a.i,7);ma(a,h,g,f);v(a,b);break;case 104:e=A(["w","w","s","s","w"],c,d);m=e[0];f=e[4];q("[attach]: fid="+m+" afid="+B(e[1])+" uname="+e[2]+" aname="+e[3]);a.g[m]={ha:0,type:1,uid:f,ib:""};n=ya(a.h,a.g[m].ha);oa(["Q"],[n.Ua],a.i,7);ma(a,h,g,13);v(a,b);a.A.send("9p-attach");break;case 108:e=A(["h"],c,d);q("[flush] "+g);ma(a,h,g,0);v(a,b);break;case 110:e=A(["w","w","h"],c,d);m=e[0];p=e[1];var t=e[2];q("[walk]: fid="+e[0]+" nwfid="+e[1]+" nwname="+t);if(0===t){a.g[p]={ha:a.g[m].ha,type:1,uid:a.g[m].uid,
ib:a.g[m].ib};oa(["h"],[0],a.i,7);ma(a,h,g,2);v(a,b);break}f=[];for(e=0;e<t;e++)f.push("s");d=A(f,c,d);c=a.g[m].ha;f=9;var x=0;q("walk in dir "+a.g[m].ib+" to: "+d.toString());for(e=0;e<t;e++){c=Ya(a.h,c,d[e]);if(-1===c){q("Could not find: "+d[e]);break}f+=oa(["Q"],[ya(a.h,c).Ua],a.i,f);x++;a.g[p]={ha:c,type:1,uid:a.g[m].uid,ib:d[e]}}oa(["h"],[x],a.i,7);ma(a,h,g,f-7);v(a,b);break;case 120:e=A(["w"],c,d);q("[clunk]: fid="+e[0]);a.g[e[0]]&&0<=a.g[e[0]].ha&&(await $a(a.h,a.g[e[0]].ha),a.g[e[0]].ha=-1,
a.g[e[0]].type=-1);ma(a,h,g,0);v(a,b);break;case 32:e=A(["w","s","d","w"],c,d);m=e[0];f=e[1];d=e[2];c=e[3];q("[txattrcreate]: fid="+m+" name="+f+" attr_size="+d+" flags="+c);a.g[m].type=2;ma(a,h,g,0);v(a,b);break;case 30:e=A(["w","w","s"],c,d);m=e[0];f=e[2];q("[xattrwalk]: fid="+e[0]+" newfid="+e[1]+" name="+e[2]);pa(a,g,95);v(a,b);break;default:q("Error in Virtio9p: Unknown id "+h+" received"),ab()}};function bb(a,b){function c(D){D=D.toString(16);return"#"+"0".repeat(6-D.length)+D}function d(D){var C=256*Q,J=8*G,O=ba?ba.canvas:null;O&&O.width===C&&O.height===J||(O?(O.width=C,O.height=J):(O=new OffscreenCanvas(C,J),ba=O.getContext("2d")),I=ba.createImageData(C,J));const U=I.data;let V=0,R;J=mb?function(X){R=R||X;U[V+3]=X;U[V+7]=X;V+=8}:function(X){R=R||X;U[V+3]=X;V+=4};O=32-G;const ea=C*(G-1)*4;C=4*(Q-C*G);const ca=1020*Q;for(let X=0,ka=0;2048>X;++X,ka+=O,V+=C){const Na=X%256;X&&!Na&&(V+=ea);
R=!1;for(let Ua=0;Ua<G;++Ua,++ka,V+=ca){const Va=D[ka];for(let Ba=128;0<Ba;Ba>>=1)J(Va&Ba?255:0);na&&J(Ga&&192<=Na&&223>=Na&&Va&1?255:0)}L[X]=R?1:0}ba.putImageData(I,0,0)}function e(D,C,J,O){if(C&&J){D.style.width="";D.style.height="";O&&(D.style.transform="");var U=D.getBoundingClientRect();O?D.style.transform=(1===C?"":" scaleX("+C+")")+(1===J?"":" scaleY("+J+")"):(0===C%1&&0===J%1?(h.style.imageRendering="crisp-edges",h.style.imageRendering="pixelated",h.style["-ms-interpolation-mode"]="nearest-neighbor"):
(h.style.imageRendering="",h.style["-ms-interpolation-mode"]=""),O=window.devicePixelRatio||1,0!==O%1&&(C/=O,J/=O));1!==C&&(D.style.width=U.width*C+"px");1!==J&&(D.style.height=U.height*J+"px")}}const f=a.ag;this.bh=b;console.assert(f,"options.container must be provided");this.o=1;this.u=2;var h=f.getElementsByTagName("canvas")[0],g=h.getContext("2d",{alpha:!1}),m=f.getElementsByTagName("div")[0],n=document.createElement("div"),p,t,x=void 0!==a.scale?a.scale:1,y=void 0!==a.scale?a.scale:1,F=1,z,u,
w,r,E,N,P,ba,I,L=new Int8Array(2048),G,Q,na,mb,Ga,nb=0,ob=0,db,Hb=0,eb,pb,Ha,Oa=[],H=0,S=!1;this.Eb=function(){const D=new Uint16Array([32,9786,9787,9829,9830,9827,9824,8226,9688,9675,9689,9794,9792,9834,9835,9788,9658,9668,8597,8252,182,167,9644,8616,8593,8595,8594,8592,8735,8596,9650,9660]),C=new Uint16Array([8962,199,252,233,226,228,224,229,231,234,235,232,239,238,236,196,197,201,230,198,244,246,242,251,249,255,214,220,162,163,165,8359,402,225,237,243,250,241,209,170,186,191,8976,172,189,188,161,
171,187,9617,9618,9619,9474,9508,9569,9570,9558,9557,9571,9553,9559,9565,9564,9563,9488,9492,9524,9516,9500,9472,9532,9566,9567,9562,9556,9577,9574,9568,9552,9580,9575,9576,9572,9573,9561,9560,9554,9555,9579,9578,9496,9484,9608,9604,9612,9616,9600,945,223,915,960,931,963,181,964,934,920,937,948,8734,966,949,8745,8801,177,8805,8804,8992,8993,247,8776,176,8729,183,8730,8319,178,9632,160]);for(var J=0,O;256>J;J++)O=126<J?C[J-127]:32>J?D[J]:J,Oa.push(String.fromCharCode(O));n.classList.add("cursor");
n.style.position="absolute";n.style.backgroundColor="#ccc";n.style.width="7px";n.style.display="inline-block";this.g(!1);this.i(80,25);2===u&&this.h(720,400);this.fh(x,y);this.Sc()};this.Pj=function(){const D=new Image;if(1===u||2===u)D.src=h.toDataURL("image/png");else{const C=[9,16],J=document.createElement("canvas");J.width=r*C[0];J.height=E*C[1];const O=J.getContext("2d");O.imageSmoothingEnabled=!1;O.font=window.getComputedStyle(m).font;O.textBaseline="top";for(let U=0;U<E;U++)for(let V=0;V<r;V++){const R=
4*(U*r+V),ea=w[R],ca=w[R+3];O.fillStyle=c(w[R+2]);O.fillRect(V*C[0],U*C[1],C[0],C[1]);O.fillStyle=c(ca);O.fillText(Oa[ea],V*C[0],U*C[1])}"none"!==n.style.display&&p<E&&t<r&&(O.fillStyle=n.style.backgroundColor,O.fillRect(t*C[0],p*C[1]+parseInt(n.style.marginTop,10),parseInt(n.style.width,10),parseInt(n.style.height,10)));D.src=J.toDataURL("image/png")}return D};this.j=function(D,C,J,O,U,V){l(0<=D&&D<E);l(0<=C&&C<r);l(0<=J&&256>J);C=4*(D*r+C);w[C]=J;w[C+1]=O;w[C+2]=U;w[C+3]=V;z[D]=1};this.Sc=function(){H=
requestAnimationFrame(()=>this.Z())};this.Z=function(){S||(0===u?this.aa():1===u?this.U():this.X());this.Sc()};this.aa=function(){for(var D=0;D<E;D++)z[D]&&(this.R(D),z[D]=0)};this.U=function(){this.bh()};this.X=function(){if(N){var D=performance.now();if(266<D-Hb){db=!db;Ha&&(z[p]=1);var C=4*r;for(let ea=0,ca=0;ea<E;++ea)if(z[ea])ca+=C;else for(var J=0;J<r;++J,ca+=4)if(w[ca+1]&1){z[ea]=1;ca+=C-4*J;break}Hb=D}D=ba.canvas;C=P.canvas;J=4*r;const U=r*Q,V=G;let R=0;for(let ea=0,ca=0,X=0;ea<E;++ea,ca+=
G){if(!z[ea]){X+=J;continue}++R;P.clearRect(0,V,U,G);let ka,Na,Ua,Va;for(let Ba=0;Ba<U;Ba+=Q,X+=4){const ae=w[X];var O=w[X+1];const be=w[X+2],ce=w[X+3],de=O&2?ob:nb;O=(!(O&1)||db)&&L[(de<<8)+ae];Ua!==be&&(void 0!==Ua&&(N.fillStyle=c(Ua),N.fillRect(Va,ca,Ba-Va,G)),Ua=be,Va=Ba);ka!==ce&&(void 0!==ka&&(P.fillStyle=c(ka),P.fillRect(Na,0,Ba-Na,G)),ka=ce,Na=Ba);O&&P.drawImage(D,ae*Q,de*G,Q,G,Ba,V,Q,G)}P.fillStyle=c(ka);P.fillRect(Na,0,U-Na,G);P.globalCompositeOperation="destination-in";P.drawImage(C,0,
V,U,G,0,0,U,G);P.globalCompositeOperation="source-over";N.fillStyle=c(Ua);N.fillRect(Va,ca,U-Va,G);N.drawImage(C,0,0,U,G,0,ca,U,G)}R&&(db&&Ha&&z[p]&&(N.fillStyle=c(w[4*(p*r+t)+3]),N.fillRect(t*Q,p*G+eb,Q,pb-eb+1)),z.fill(0));R&&g.drawImage(N.canvas,0,0)}};this.Aa=function(){H&&(cancelAnimationFrame(H),H=0)};this.pause=function(){S=!0;n.classList.remove("blinking-cursor")};this.continue=function(){S=!1;n.classList.add("blinking-cursor")};this.g=function(D){u=D?1:a.Cl?2:0;0===u?(m.style.display="block",
h.style.display="none"):(m.style.display="none",h.style.display="block",2===u&&z&&z.fill(1))};this.C=function(D,C,J,O,U,V){const R=J?16:C?9:8;if(G!==D||Q!==R||na!==C||mb!==J||Ga!==O||V)V=Q!==R||G!==D,G=D,Q=R,na=C,mb=J,Ga=O,2===u&&(d(U),z.fill(1),V&&this.P())};this.D=function(D,C){if(nb!==D||ob!==C)nb=D,ob=C,z.fill(1)};this.N=function(){g.fillStyle="#000";g.fillRect(0,0,h.width,h.height)};this.P=function(){if(ba){var D=Q*r,C=G*E,J=2*G;N&&N.canvas.width===D&&N.canvas.height===C&&P.canvas.height===J||
(N?(N.canvas.width=D,N.canvas.height=C,P.canvas.width=D,P.canvas.height=J):(N=(new OffscreenCanvas(D,C)).getContext("2d",{alpha:!1}),P=(new OffscreenCanvas(D,J)).getContext("2d")),this.h(D,C),z.fill(1))}};this.i=function(D,C){if(D!==r||C!==E)if(z=new Int8Array(C),w=new Int32Array(D*C*4),r=D,E=C,0===u){for(;m.childNodes.length>C;)m.removeChild(m.firstChild);for(;m.childNodes.length<C;)m.appendChild(document.createElement("div"));for(D=0;D<C;D++)this.R(D);e(m,x,y,!0)}else 2===u&&this.P()};this.h=function(D,
C){h.style.display="block";h.width=D;h.height=C;g.imageSmoothingEnabled=!1;F=640>=D&&2*D<window.innerWidth*window.devicePixelRatio&&2*C<window.innerHeight*window.devicePixelRatio?2:1;e(h,x*F,y*F,!1)};this.fh=function(D,C){x=D;y=C;e(m,x,y,!0);e(h,x*F,y*F,!1)};this.J=function(D,C,J){if(D!==eb||C!==pb||J!==Ha)0===u?J?(n.style.display="inline",n.style.height=C-D+"px",n.style.marginTop=D+"px"):n.style.display="none":2===u&&p<E&&(z[p]=1),eb=D,pb=C,Ha=J};this.G=function(D,C){if(D!==p||C!==t)D<E&&(z[D]=1),
p<E&&(z[p]=1),p=D,t=C};this.R=function(D){var C=4*D*r,J;var O=m.childNodes[D];var U=document.createElement("div");for(var V=0;V<r;){var R=document.createElement("span");var ea=w[C+1]&1;var ca=w[C+2];var X=w[C+3];ea&&R.classList.add("blink");R.style.backgroundColor=c(ca);R.style.color=c(X);for(J="";V<r&&(w[C+1]&1)===ea&&w[C+2]===ca&&w[C+3]===X;){var ka=w[C];J+=Oa[ka];l(Oa[ka]);V++;C+=4;if(D===p)if(V===t)break;else if(V===t+1){n.style.backgroundColor=R.style.color;U.appendChild(n);break}}R.textContent=
J;U.appendChild(R)}O.parentNode.replaceChild(U,O)};this.l=function(D){for(const C of D)g.putImageData(C.Hc,C.dh-C.Yf,C.eh-C.Zf,C.Yf,C.Zf,C.Lg,C.Kg)};this.Eb()};(function(){function a(z){document.title=z+" - v86 - debug";const u=document.querySelector("meta[name=description]");u&&(u.content="Running "+z)}function b(z){return!!z&&"0"!==z}function c(z){return document.getElementById(z)}function d(){function z(){const I={};for(var L of ba)I[L.id.replace(/filter_/,"")]=L.checked;L=!Object.values(I).includes(!0);for(const G of P){const Q=L||I.graphical&&G.Mh||I.text&&!G.Mh||I.linux&&"Linux"===G.family||I.bsd&&"BSD"===G.family||I.windows&&"Windows"===G.family||
I.unix&&"Unix"===G.family||I.dos&&"DOS"===G.family||I.custom&&"Custom"===G.family||I.floppy&&"Floppy"===G.Sg||I.cd&&"CD"===G.Sg||I.hd&&"HD"===G.Sg||I.modern&&"Modern"===G.status||I.historic&&"Historic"===G.status||I.opensource&&"Open-source"===G.source||I.proprietary&&"Proprietary"===G.source||I.bootsector&&512>=G.size||I.lt5mb&&5242880>=G.size||I.gt5mb&&5242880<G.size||I["16bit"]&&"16-bit"===G.qh||I["32bit"]&&"32-bit"===G.qh||I.asm&&G.languages.has("ASM")||I.c&&G.languages.has("C")||I.cpp&&G.languages.has("C++")||
I.other_lang&&["Java","Haskell","Rust","Erlang","Oberon"].some(na=>G.languages.has(na));G.element.style.display=Q?"":"none"}}function u(I,L){if(I=c(I))I.onclick=()=>c("relay_url").value=L}if(window.WebAssembly){c("start_emulation").onclick=function(L){f(null,null);c("start_emulation").blur();L.preventDefault()};e();t&&(c("relay_url").value="ws://localhost:8080/");var w=new URLSearchParams(location.search),r=w.get("cdn")||(t?"images/":"//i.copy.sh/");r=[{id:"archlinux",name:"Arch Linux",F:536870912,
la:8388608,state:{url:r+"arch_state-v2.bin.zst"},filesystem:{Xf:r+"arch/"},Gf:"virtio"},{id:"archlinux-boot",name:"Arch Linux",F:536870912,la:8388608,filesystem:{Xf:r+"arch/",Wi:{url:r+"fs.json"}},Mb:"rw apm=off vga=0x344 video=vesafb:ypan,vremap:8 root=host9p rootfstype=9p rootflags=trans=virtio,cache=loose mitigations=off audit=0 init_on_free=on tsc=reliable random.trust_cpu=on nowatchdog init=/usr/bin/init-openrc net.ifnames=0 biosdevname=0",Ue:!0,Gf:"virtio"},{id:"copy/skiffos",name:"SkiffOS",
Y:{url:r+"skiffos/.iso",size:124672E3,async:!0,L:1048576,ca:!0},F:536870912},{id:"serenity",name:"SerenityOS",K:{url:r+"serenity-v3/.img.zst",size:734003200,async:!0,L:1048576,ca:!0},F:536870912,state:{url:r+"serenity_state-v4.bin.zst"},M:"https://serenityos.org/",Vb:!0},{id:"serenity-boot",name:"SerenityOS",K:{url:r+"serenity-v3/.img.zst",size:734003200,async:!0,L:1048576,ca:!0},F:536870912,M:"https://serenityos.org/"},{id:"redox",name:"Redox",K:{url:r+"redox_demo_i686_2024-09-07_1225_harddrive/.img",
size:671088640,async:!0,L:1048576,ca:!0},F:1073741824,state:{url:r+"redox_state-v2.bin.zst"},M:"https://www.redox-os.org/",xa:!0},{id:"redox-boot",name:"Redox",K:{url:r+"redox_demo_i686_2024-09-07_1225_harddrive/.img",size:671088640,async:!0,L:1048576,ca:!0},F:1073741824,M:"https://www.redox-os.org/",xa:!0},{id:"helenos",F:268435456,Y:{url:r+"HelenOS-0.14.1-ia32.iso",size:25792512,async:!1},name:"HelenOS",M:"http://www.helenos.org/"},{id:"fiwix",F:268435456,K:{url:r+"FiwixOS-3.3-i386/.img",size:1073741824,
async:!0,L:1048576,ca:!0},name:"FiwixOS",M:"https://www.fiwix.org/"},{id:"haiku",F:536870912,K:{url:r+"haiku-v4/.img",size:1073741824,async:!0,L:1048576,ca:!0},state:{url:r+"haiku_state-v4.bin.zst"},name:"Haiku",M:"https://www.haiku-os.org/"},{id:"haiku-boot",F:536870912,K:{url:r+"haiku-v4/.img",size:1073741824,async:!0,L:1048576,ca:!0},name:"Haiku",M:"https://www.haiku-os.org/"},{id:"beos",F:536870912,K:{url:r+"beos5/.img",size:536870912,async:!0,L:1048576,ca:!0},name:"BeOS 5"},{id:"msdos",K:{url:r+
"msdos622/.img",size:67108864,async:!0,L:262144,ca:!0},name:"MS-DOS 6.22"},{id:"msdos4",W:{url:r+"msdos4.img",size:1474560},name:"MS-DOS 4"},{id:"freedos",W:{url:r+"freedos722.img",size:737280},name:"FreeDOS"},{id:"freegem",K:{url:r+"freegem/.bin",size:209715200,async:!0,L:262144,ca:!0},name:"Freedos with FreeGEM"},{id:"xcom",W:{url:r+"xcom144.img",size:1474560},name:"Freedos with Xcom",M:"http://xcom.infora.hu/index.html"},{id:"psychdos",K:{url:r+"psychdos/.img",size:549453824,async:!0,L:262144,
ca:!0},name:"PsychDOS",M:"https://psychoslinux.gitlab.io/DOS/INDEX.HTM"},{id:"86dos",W:{url:r+"pc86dos.img",size:163840},name:"86-DOS",M:"https://www.os2museum.com/wp/pc-86-dos/"},{id:"oberon",K:{url:r+"oberon.img",size:25165824,async:!1},name:"Oberon"},{id:"windows1",W:{url:r+"windows101.img",size:1474560},name:"Windows 1.01"},{id:"windows2",K:{url:r+"windows2.img",size:4177920,async:!1},name:"Windows 2.03"},{id:"linux26",Y:{url:r+"linux.iso",size:6547456,async:!1},name:"Linux"},{id:"linux3",Y:{url:r+
"linux3.iso",size:8638464,async:!1},name:"Linux"},{id:"linux4",Y:{url:r+"linux4.iso",size:7731200,async:!1},name:"Linux",filesystem:{}},{id:"buildroot",Db:{url:r+"buildroot-bzimage.bin",size:5166352,async:!1},name:"Buildroot Linux",filesystem:{},Mb:"tsc=reliable mitigations=off random.trust_cpu=on"},{id:"buildroot6",Db:{url:r+"buildroot-bzimage68.bin",size:10068480,async:!1},name:"Buildroot Linux 6.8",filesystem:{},Mb:"tsc=reliable mitigations=off random.trust_cpu=on"},{id:"basiclinux",K:{url:r+"bl3-5.img",
size:104857600,async:!1},name:"BasicLinux"},{id:"xpud",Y:{url:r+"xpud-0.9.2.iso",size:67108864,async:!1},name:"xPUD",F:268435456},{id:"elks",K:{url:r+"elks-hd32-fat.img",size:32514048,async:!1},name:"ELKS",M:"https://github.com/ghaerr/elks"},{id:"nodeos",Db:{url:r+"nodeos-kernel.bin",size:14452E3,async:!1},name:"NodeOS",Mb:"tsc=reliable mitigations=off random.trust_cpu=on"},{id:"dsl",F:268435456,Y:{url:r+"dsl-4.11.rc2.iso",size:52824064,async:!1},name:"Damn Small Linux",M:"http://www.damnsmalllinux.org/"},
{id:"xwoaf",F:268435456,Y:{url:r+"xwoaf_rebuild4.iso",size:2205696,async:!1},name:"xwoaf",M:"https://pupngo.dk/xwinflpy/xwoaf_rebuild.html"},{id:"minix",name:"Minix",F:268435456,Y:{url:r+"minix-3.3.0/.iso",size:605581312,async:!0,L:1048576,ca:!0},M:"https://www.minix3.org/"},{id:"unix-v7",name:"Unix V7",K:{url:r+"unix-v7x86-0.8a/.img",size:152764416,async:!0,L:262144,ca:!0}},{id:"kolibrios",W:{url:t?r+"kolibri.img":"//builds.kolibrios.org/en_US/data/data/kolibri.img",size:1474560},name:"KolibriOS",
M:"https://kolibrios.org/en/"},{id:"kolibrios-fallback",W:{url:r+"kolibri.img",size:1474560},name:"KolibriOS"},{id:"mu",K:{url:r+"mu-shell.img",size:10321920,async:!1},F:268435456,name:"Mu",M:"https://github.com/akkartik/mu"},{id:"openbsd",K:{url:r+"openbsd/.img",size:1073741824,async:!0,L:1048576,ca:!0},state:{url:r+"openbsd_state.bin.zst"},F:268435456,name:"OpenBSD"},{id:"sortix",Y:{url:r+"sortix-1.0-i686.iso",size:71075840,async:!1},F:536870912,name:"Sortix"},{id:"openbsd-boot",K:{url:r+"openbsd/.img",
size:1073741824,async:!0,L:1048576,ca:!0},F:268435456,name:"OpenBSD"},{id:"netbsd",K:{url:r+"netbsd/.img",size:511000064,async:!0,L:1048576,ca:!0},F:268435456,name:"NetBSD"},{id:"crazierl",Fb:{url:r+"crazierl-elf.img",size:896592,async:!1},Ub:{url:r+"crazierl-initrd.img",size:18448316,async:!1},xa:!0,Mb:"kernel /libexec/ld-elf32.so.1",F:134217728,name:"Crazierl"},{id:"solos",W:{url:r+"os8.img",size:1474560},name:"Sol OS",M:"http://oby.ro/os/"},{id:"bootchess",W:{url:r+"bootchess.img",size:1474560},
name:"BootChess",M:"http://www.pouet.net/prod.php?which=64962"},{id:"bootbasic",W:{url:r+"bootbasic.img",size:512},name:"bootBASIC",M:"https://github.com/nanochess/bootBASIC"},{id:"bootlogo",W:{url:r+"bootlogo.img",size:512},name:"bootLogo",M:"https://github.com/nanochess/bootLogo"},{id:"sectorlisp",W:{url:r+"sectorlisp-friendly.bin",size:512},name:"SectorLISP",M:"https://justine.lol/sectorlisp2/"},{id:"sectorforth",W:{url:r+"sectorforth.img",size:512},name:"sectorforth",M:"https://github.com/cesarblum/sectorforth"},
{id:"floppybird",W:{url:r+"floppybird.img",size:1474560},name:"Floppy Bird",M:"http://mihail.co/floppybird"},{id:"stillalive",W:{url:r+"stillalive-os.img",size:368640},name:"Still Alive",M:"https://github.com/maniekx86/stillalive-os"},{id:"hello-v86",W:{url:r+"hello-v86.img",size:512},name:"Hello v86"},{id:"tetros",W:{url:r+"tetros.img",size:512},name:"TetrOS",M:"https://github.com/daniel-e/tetros"},{id:"dino",W:{url:r+"bootdino.img",size:512},name:"dino",M:"https://github.com/franeklubi/dino"},{id:"bootrogue",
W:{url:r+"bootrogue.img",size:512},name:"bootRogue",M:"https://github.com/nanochess/bootRogue"},{id:"duskos",K:{url:r+"duskos.img",async:!1,size:8388608},name:"Dusk OS",M:"http://duskos.org/"},{id:"windows2000",F:536870912,K:{url:r+"windows2k/.img",size:2147483648,async:!0,L:262144,ca:!0},name:"Windows 2000",state:{url:r+"windows2k_state-v2.bin.zst"},Vb:!0},{id:"windows2000-boot",F:536870912,K:{url:r+"windows2k/.img",size:2147483648,async:!0,L:262144,ca:!0},name:"Windows 2000"},{id:"windows-me",F:134217728,
K:{url:r+"windowsme/.img",size:834666496,async:!0,L:262144,ca:!0},state:{url:r+"windows-me_state.bin.zst"},name:"Windows ME"},{id:"windowsnt4",F:536870912,K:{url:r+"winnt4_noacpi/.img",size:523837440,async:!0,L:262144,ca:!0},name:"Windows NT 4.0",xd:2},{id:"windowsnt3",F:268435456,K:{url:r+"winnt31/.img",size:91226112,async:!0,L:262144,ca:!0},name:"Windows NT 3.1"},{id:"windows98",F:134217728,K:{url:r+"windows98/.img",size:314572800,async:!0,L:262144,ca:!0},name:"Windows 98",state:{url:r+"windows98_state.bin.zst"},
Vb:!0},{id:"windows98-boot",F:134217728,K:{url:r+"windows98/.img",size:314572800,async:!0,L:262144,ca:!0},name:"Windows 98"},{id:"windows95",F:67108864,K:{url:r+"windows95-v2/.img",size:471859200,async:!0,L:262144,ca:!0},name:"Windows 95"},{id:"windows95-boot",F:67108864,K:{url:r+"windows95-v2/.img",size:471859200,async:!0,L:262144,ca:!0},name:"Windows 95"},{id:"windows30",F:67108864,Y:{url:r+"Win30.iso",size:7774208,async:!1},name:"Windows 3.0"},{id:"windows31",F:67108864,K:{url:r+"win31.img",async:!1,
size:34463744},name:"Windows 3.1"},{id:"tilck",F:134217728,K:{url:r+"tilck.img",async:!1,size:37748736},name:"Tilck",M:"https://github.com/vvaltchev/tilck"},{id:"littlekernel",Fb:{url:r+"littlekernel-multiboot.img",async:!1,size:969580},name:"Little Kernel",M:"https://github.com/littlekernel/lk"},{id:"sanos",F:134217728,K:{url:r+"sanos-flp.img",async:!1,size:1474560},name:"Sanos",M:"http://www.jbox.dk/sanos/"},{id:"freebsd",F:268435456,K:{url:r+"freebsd/.img",size:2147483648,async:!0,L:1048576,ca:!0},
state:{url:r+"freebsd_state.bin.zst"},name:"FreeBSD"},{id:"freebsd-boot",F:268435456,K:{url:r+"freebsd/.img",size:2147483648,async:!0,L:1048576,ca:!0},name:"FreeBSD"},{id:"reactos",F:536870912,K:{url:r+"reactos-v2/.img",size:681574400,async:!0,L:1048576,ca:!0},state:{url:r+"reactos_state-v2.bin.zst"},Vb:!0,name:"ReactOS",xa:!0,M:"https://reactos.org/"},{id:"reactos-boot",F:536870912,K:{url:r+"reactos-v2/.img",size:681574400,async:!0,L:1048576,ca:!0},name:"ReactOS",xa:!0,M:"https://reactos.org/"},
{id:"skift",Y:{url:r+"skift-20200910.iso",size:64452608,async:!1},name:"Skift",M:"https://skiftos.org/"},{id:"snowdrop",W:{url:r+"snowdrop.img",size:1474560},name:"Snowdrop",M:"http://www.sebastianmihai.com/snowdrop/"},{id:"openwrt",K:{url:r+"openwrt-18.06.1-x86-legacy-combined-squashfs.img",size:19846474,async:!1},name:"OpenWrt"},{id:"qnx",W:{url:r+"qnx-demo-network-4.05.img",size:1474560},name:"QNX 4.05"},{id:"9front",F:134217728,K:{url:r+"9front-8963.f84cf1e60427675514fb056cc1723e45da01e043.386/.iso",
size:477452288,async:!0,L:1048576,ca:!0},state:{url:r+"9front_state-v2.bin.zst"},xa:!0,name:"9front",M:"https://9front.org/"},{id:"9front-boot",F:134217728,K:{url:r+"9front-8963.f84cf1e60427675514fb056cc1723e45da01e043.386/.iso",size:477452288,async:!0,L:1048576,ca:!0},xa:!0,name:"9front",M:"https://9front.org/"},{id:"mobius",W:{url:r+"mobius-fd-release5.img",size:1474560},name:"Mobius"},{id:"android",F:536870912,Y:{url:r+"android-x86-1.6-r2/.iso",size:54661120,async:!0,L:1048576,ca:!0},name:"Android"},
{id:"android4",F:536870912,Y:{url:r+"android_x86_nonsse3_4.4r1_20140904/.iso",size:247463936,async:!0,L:1048576,ca:!0},name:"Android 4"},{id:"tinycore",F:268435456,K:{url:r+"TinyCore-11.0.iso",size:19922944,async:!1},name:"Tinycore",M:"http://www.tinycorelinux.net/"},{id:"slitaz",F:536870912,K:{url:r+"slitaz-rolling-2024.iso",size:56573952,async:!1},name:"SliTaz",M:"https://slitaz.org/"},{id:"freenos",F:268435456,Y:{url:r+"FreeNOS-1.0.3.iso",async:!1,size:11014144},name:"FreeNOS",xa:!0,M:"http://www.freenos.org/"},
{id:"syllable",F:536870912,K:{url:r+"syllable-destop-0.6.7/.img",async:!0,size:524288E3,L:524288,ca:!0},name:"Syllable",M:"http://syllable.metaproject.frl/"},{id:"toaruos",F:536870912,Y:{url:r+"toaruos-1.6.1-core.iso",size:67567616,async:!1},name:"ToaruOS",xa:!0,M:"https://toaruos.org/"},{id:"nopeos",Y:{url:r+"nopeos-0.1.iso",size:532480,async:!1},name:"Nope OS",M:"https://github.com/d99kris/nopeos"},{id:"soso",Y:{url:r+"soso.iso",size:22546432,async:!1},name:"Soso",M:"https://github.com/ozkl/soso"},
{id:"pcmos",W:{url:r+"PCMOS386-9-user-patched.img",size:1474560},name:"PC-MOS/386",M:"https://github.com/roelandjansen/pcmos386v501"},{id:"jx",W:{url:r+"jx-demo.img",size:1474560},name:"JX",M:"https://www4.cs.fau.de/Projects/JX/index.html"},{id:"house",W:{url:r+"hOp-0.8.img",size:1474560},name:"House",M:"https://programatica.cs.pdx.edu/House/"},{id:"bleskos",name:"BleskOS",Y:{url:r+"bleskos_2024u32.iso",size:1835008,async:!1},M:"https://github.com/VendelinSlezak/BleskOS"},{id:"boneos",name:"BoneOS",
Y:{url:r+"BoneOS.iso",size:11429888,async:!1},M:"https://amanuel.io/projects/BoneOS/"},{id:"mikeos",name:"MikeOS",Y:{url:r+"mikeos.iso",size:3311616,async:!1},M:"https://mikeos.sourceforge.net/"},{id:"bluejay",name:"Blue Jay",W:{url:r+"bj050.img",size:1474560},M:"https://archiveos.org/blue-jay/"},{id:"t3xforth",name:"T3XFORTH",W:{url:r+"t3xforth.img",size:1474560},M:"https://t3x.org/t3xforth/"},{id:"nanoshell",name:"NanoShell",Y:{url:r+"nanoshell.iso",size:6785024,async:!1},M:"https://github.com/iProgramMC/NanoShellOS"},
{id:"catk",name:"CatK",Y:{url:r+"catkernel.iso",size:11968512,async:!1},M:"https://catk.neocities.org/"},{id:"mcp",name:"M/CP",W:{url:r+"mcp2.img",size:512},M:"https://github.com/ybuzoku/MCP"},{id:"ibm-exploring",name:"Exploring The IBM Personal Computer",W:{url:r+"ibm-exploring.img",size:368640}},{id:"leetos",name:"lEEt/OS",W:{url:r+"leetos.img",size:1474560},M:"http://sininenankka.dy.fi/leetos/index.php"},{id:"newos",name:"NewOS",W:{url:r+"newos-flp.img",size:1474560,async:!1},M:"https://newos.org/"},
{id:"aros-broadway",name:"AROS Broadway",F:536870912,Y:{url:r+"broadway10/.iso",size:742051840,async:!0,L:524288,ca:!0},M:"https://web.archive.org/web/20231109224346/http://www.aros-broadway.de/"},{id:"icaros",name:"Icaros Desktop",F:536870912,Y:{url:r+"icaros-pc-i386-2.3/.iso",size:726511616,async:!0,L:524288,ca:!0},M:"http://vmwaros.blogspot.com/"},{id:"tinyaros",name:"Tiny Aros",F:536870912,Y:{url:r+"tinyaros-pc-i386/.iso",size:111175680,async:!0,L:524288,ca:!0},M:"https://www.tinyaros.it/"}];
const I="realmode cmpxchg8b port80 setjmp sieve hypercall init msr smap tsc_adjust tsc rmap_chain memory taskswitch taskswitch2 eventinj ioapic apic".split(" ");for(var E of I)r.push({name:"Test case: "+E,id:"test-"+E,F:134217728,Fb:{url:"tests/kvm-unit-tests/x86/"+E+".flat"}});var N=w.get("profile");E=document.createElement("link");E.rel="prefetch";E.href="build/xterm.js";document.head.appendChild(E);for(const L of r){if(N===L.id){f(L,w);return}const G=c("start_"+L.id);G&&(G.onclick=Q=>{Q.ctrlKey||
(Q.preventDefault(),G.blur(),f(L,null))})}if("custom"===N)w.has("hda.url")||w.has("cdrom.url")||w.has("fda.url")?f(null,w):(w.has("m")&&(c("memory_size").value=w.get("m")),w.has("vram")&&(c("vga_memory_size").value=w.get("vram")),w.has("relay_url")&&(c("relay_url").value=w.get("relay_url")),w.has("mute")&&(c("disable_audio").checked=b(w.get("mute"))),w.has("acpi")&&(c("acpi").checked=b(w.get("acpi"))),w.has("boot_order")&&(c("boot_order").value=w.get("boot_order")));else if(/^[a-zA-Z0-9\-_]+\/[a-zA-Z0-9\-_]+$/g.test(N)){const L=
"https://v86-user-images.b-cdn.net/"+N;fetch(L+"/profile.json").catch(()=>alert("Profile not found: "+N)).then(G=>G.json()).then(G=>{function Q(na){return na&&{url:L+"/"+na.url,async:na.async,size:na.size}}G={id:G.id,name:G.name,F:G.memory_size,la:G.vga_memory_size,xa:G.acpi,Lb:G.boot_order,K:Q(G.hda),Y:Q(G.cdrom),W:Q(G.fda),Fb:Q(G.multiboot),Db:Q(G.bzimage),Ub:Q(G.initrd)};f(G,w)})}var P=Array.from(document.querySelectorAll("#oses tbody tr")).map(L=>{const [,G,Q]=L.children[1].textContent.match(/([\d\.]+)\+? (\w+)/);
let na=+G;"MB"===Q?na*=1048576:"KB"===Q&&(na*=1024);return{element:L,size:na,Mh:"gui_icon"===L.children[2].firstChild.className,family:L.children[3].textContent.replace(/-like/,""),qh:L.children[4].textContent,status:L.children[5].textContent,source:L.children[6].textContent,languages:new Set(L.children[7].textContent.split(", ")),Sg:L.children[8].textContent}}),ba=document.querySelectorAll("#filter input");for(const L of ba)L.onchange=z;u("network_none","");u("network_fetch","fetch");u("network_relay",
"wss://relay.widgetry.org/");u("network_wisp","wisps://wisp.mercurywork.shop/v86/")}else alert("Your browser is not supported because it doesn't support WebAssembly")}function e(){const z=c("log_levels");if(z){for(let u=0;u<aa.length;u++){const w=aa[u][0];if(1===w)continue;const r=aa[u][1].toLowerCase(),E=document.createElement("input"),N=document.createElement("label");E.type="checkbox";N.htmlFor=E.id="log_"+r;cb&w&&(E.checked=!0);E.dd=w;N.append(E,fb(r,4)+" ");z.appendChild(N);u===Math.floor(aa.length/
2)&&z.append("\n")}z.onchange=function(u){u=u.target;const w=u.dd;cb=u.checked?cb|w:cb&~w;u.blur()}}}function f(z,u){c("boot_options").style.display="none";const w=new Map;w.set("profile",z?.id||"custom");const r={};z&&(z.state&&(c("reset").style.display="none"),a(z.name),r.lc=z.state,r.filesystem=z.filesystem,r.W=z.W,r.Y=z.Y,r.K=z.K,r.Fb=z.Fb,r.Db=z.Db,r.Ub=z.Ub,r.Mb=z.Mb,r.Ue=z.Ue,r.Vb=z.Vb,r.xd=z.xd,r.xa=z.xa,r.F=z.F,r.la=z.la,r.Lb=z.Lb,r.Gf=z.Gf);if(u){if(!r.lc){var E=parseInt(u.get("chunk_size"),
10);0<=E?(E=Math.min(4194304,Math.max(512,E)),E=gb(E)):E=262144;u.has("hda.url")&&(r.K={size:parseInt(u.get("hda.size"),10)||void 0,url:u.get("hda.url"),L:E,async:!0});u.has("cdrom.url")&&(r.Y={size:parseInt(u.get("cdrom.size"),10)||void 0,url:u.get("cdrom.url"),L:E,async:!0});u.has("fda.url")&&(r.W={size:parseInt(u.get("fda.size"),10)||void 0,url:u.get("fda.url"),async:!1});E=parseInt(u.get("m"),10);0<E&&(r.F=1048576*Math.max(16,E));E=parseInt(u.get("vram"),10);0<E&&(r.la=1048576*E);r.xa=u.has("acpi")?
b(u.get("acpi")):r.xa;r.Bl="bochs"===u.get("bios");r.Gf="virtio"===u.get("net_device_type")?"virtio":"ne2k"}r.Je=u.get("relay_url");r.sf=b(u.get("disable_jit"));r.dg=b(u.get("mute"))}r.Je||(r.Je=c("relay_url").value,x.includes(r.Je)||w.set("relay_url",r.Je));r.dg=c("disable_audio").checked||r.dg;r.dg&&w.set("mute","1");if(!r.lc){if(E=c("bios").files[0])r.Cb={buffer:E};var N=c("floppy_image").files[0];N&&(r.W={buffer:N});const I=c("cdrom_image").files[0];I&&(r.Y={buffer:I});const L=c("hda_image").files[0];
L&&(r.K={buffer:L});const G=c("hdb_image")?.files[0];G&&(r.Zc={buffer:G});const Q=c("multiboot_image")?.files[0];Q&&(r.Fb={buffer:Q});var P=c("bzimage").files[0];P&&(r.Db={buffer:P});if(P=c("initrd").files[0])r.Ub={buffer:P};(E=Q?.name||L?.name||I?.name||G?.name||N?.name||E?.name)&&a(E);E=parseInt(c("memory_size").value,10)||128;r.F&&128===E||(r.F=1048576*E);128!==E&&w.set("m",String(E));E=parseInt(c("vga_memory_size").value,10)||8;r.la&&8===E||(r.la=1048576*E);8!==E&&w.set("vram",String(E));E=parseInt(c("boot_order").value,
16)||0;r.Lb&&0===E||(r.Lb=E);0!==r.Lb&&w.set("boot_order",String(r.Lb));void 0===r.xa&&(r.xa=c("acpi").checked,r.xa&&w.set("acpi","1"));r.Cb||(r.Bl?(E="bochs-bios.bin",N="bochs-vgabios.bin"):(E="seabios-debug.bin",N="vgabios-debug.bin"),r.Cb={url:"bios/"+E},r.Rf={url:"bios/"+N})}u||p(w);const ba=new hb({screen:{ag:c("screen_container"),Cl:!1},bf:{type:r.Gf||"ne2k",Je:r.Je},Vi:!0,F:r.F,la:r.la,Lb:r.Lb,Cb:r.Cb,Rf:r.Rf,W:r.W,K:r.K,Zc:r.Zc,Y:r.Y,Fb:r.Fb,Db:r.Db,Ub:r.Ub,Mb:r.Mb,Ue:r.Ue,xa:r.xa,sf:r.sf,
lc:r.lc,filesystem:r.filesystem||{},nj:r.dg,Vb:r.Vb,xd:r.xd});window.h=ba;ib(ba,"emulator-ready",function(){m(ba);if(ba.Fa.s.Na.exports.profiler_is_enabled()){const I=document.createElement("pre");document.body.appendChild(I);setInterval(function(){if(ba.Cd()){var L=jb.xl(ba.Fa.s);I.textContent=L}},1E3)}"dsl helenos android android4 redox beos".split(" ").includes(z?.id)&&setTimeout(()=>{kb(ba,"\n")},3E3);h(r,ba);u?.has("c")&&setTimeout(function(){kb(ba,u.get("c")+"\n")},25);u?.has("s")&&setTimeout(function(){for(var I=
u.get("s")+"\n",L=0;L<I.length;L++)ba.A.send("serial0-input",I.charCodeAt(L))},25)});ib(ba,"download-progress",function(I){const L=c("loading");L.style.display="block";if(I.zf.endsWith(".wasm")){var G=I.zf.split("/");L.textContent="Fetching "+G[G.length-1]+" ..."}else if(I.yf===I.xf-1&&I.loaded>=I.total-2048)L.textContent="Done downloading. Starting now ...";else{G="Downloading images ";"number"===typeof I.yf&&I.xf&&(G+="["+(I.yf+1)+"/"+I.xf+"] ");if(I.total&&"number"===typeof I.loaded){I=Math.floor(I.loaded/
I.total*100);I=Math.min(100,Math.max(0,I));var Q=Math.floor(I/2);G=G+(I+"% [")+"#".repeat(Q);G+=" ".repeat(50-Q)+"]"}else G+=".".repeat(y++%50);L.textContent=G}});ib(ba,"download-error",function(I){const L=c("loading");L.style.display="block";L.textContent=`Loading ${I.zf} failed. Check your connection and reload the page to try again.`})}function h(z,u){function w(){var H=Date.now(),S=u.Fa?u.Fa.s.Lj[0]>>>0:0;S<I&&(I-=4294967296);var D=S-I;I=S;Q+=D;if(S=H-P)ba+=S,P=H,c("speed").textContent=(D/1E3/
S).toFixed(1),c("avg_speed").textContent=(Q/1E3/ba).toFixed(1),H=c("running_time"),D=ba/1E3|0,H.textContent=60>D?D+"s":3600>D?(D/60|0)+"m "+lb(D%60,2)+"s":(D/3600|0)+"h "+lb((D/60|0)%60,2)+"m "+lb(D%60,2)+"s"}function r(H,S,D){var C=c("get_"+D+"_image");!H||104857600<H.size?C.style.display="none":C.onclick=function(){const J=S.file&&S.file.name||z.id+("cdrom"===D?".iso":".img");if(S.Kh){var O=S.Kh(J);qb(O,J)}else S.kc(function(U){U?rb(U,J):alert("The file could not be loaded. Maybe it's too big?")});
C.blur()}}function E(H){H.ctrlKey?window.onbeforeunload=function(){window.onbeforeunload=null;return"CTRL-W cannot be sent to the emulator."}:window.onbeforeunload=null}c("loading").style.display="none";c("runtime_options").style.display="block";c("runtime_infos").style.display="block";c("screen_container").style.display="block";z.filesystem?g(u):ib(u,"9p-attach",function(){g(u)});c("run").onclick=function(){u.Cd()?(c("run").value="Run",u.stop()):(c("run").value="Pause",u.Lf());c("run").blur()};c("exit").onclick=
function(){u.stop();location.href=location.pathname};c("lock_mouse").onclick=function(){if(!N)c("toggle_mouse").onclick();sb();c("lock_mouse").blur()};var N=!0;c("toggle_mouse").onclick=function(){N=!N;u.j&&(u.j.jg=N);c("toggle_mouse").value=(N?"Dis":"En")+"able mouse";c("toggle_mouse").blur()};var P=0,ba=0,I=0,L=null,G=!1,Q=0;ib(u,"emulator-started",function(){P=Date.now();L=setInterval(w,1E3)});ib(u,"emulator-stopped",function(){w();null!==L&&clearInterval(L)});var na=0,mb=0,Ga=[];ib(u,"9p-read-start",
function(H){H=H[0];Ga.push(H);c("info_filesystem").style.display="block";c("info_filesystem_status").textContent="Loading ...";c("info_filesystem_last_file").textContent=H});ib(u,"9p-read-end",function(H){na+=H[1];c("info_filesystem_bytes_read").textContent=na;const S=H[0];Ga=Ga.filter(D=>D!==S);Ga[0]?c("info_filesystem_last_file").textContent=Ga[0]:c("info_filesystem_status").textContent="Idle"});ib(u,"9p-write-end",function(H){mb+=H[1];c("info_filesystem_bytes_written").textContent=mb;Ga[0]||(c("info_filesystem_last_file").textContent=
H[0])});var nb=0,ob=0,db=0,Hb=0;c("ide_type").textContent=u.ub.Y?" (CD-ROM)":" (hard disk)";ib(u,"ide-read-start",function(){c("info_storage").style.display="block";c("info_storage_status").textContent="Loading ..."});ib(u,"ide-read-end",function(H){nb+=H[1];ob+=H[2];c("info_storage_status").textContent="Idle";c("info_storage_bytes_read").textContent=nb;c("info_storage_sectors_read").textContent=ob});ib(u,"ide-write-end",function(H){db+=H[1];Hb+=H[2];c("info_storage_bytes_written").textContent=db;
c("info_storage_sectors_written").textContent=Hb});var eb=0,pb=0;ib(u,"eth-receive-end",function(H){pb+=H[0];c("info_network").style.display="block";c("info_network_bytes_received").textContent=pb});ib(u,"eth-transmit-end",function(H){eb+=H[0];c("info_network").style.display="block";c("info_network_bytes_transmitted").textContent=eb});ib(u,"mouse-enable",function(H){G=H;c("info_mouse_enabled").textContent=H?"Yes":"No"});ib(u,"screen-set-size",function(H){const [S,D,C]=H;c("info_res").textContent=
S+"x"+D+(C?"x"+C:"");c("info_vga_mode").textContent=C?"Graphical":"Text"});c("reset").onclick=function(){u.$g();c("reset").blur()};r(z.K,u.ub.K,"hda");r(z.Zc,u.ub.Zc,"hdb");r(z.W,u.ub.W,"fda");r(z.te,u.ub.te,"fdb");r(z.Y,u.ub.Y,"cdrom");c("change_fda_image").value=z.W?"Eject floppy image":"Insert floppy image";c("change_fda_image").onclick=function(){if(u.Fa.s.v.ue.zd)u.fg(),c("change_fda_image").value="Insert floppy image";else{const H=document.createElement("input");H.type="file";H.onchange=async function(){const S=
H.files[0];S&&(await u.Nf({buffer:S}),c("change_fda_image").value="Eject floppy image")};H.click()}c("change_fda_image").blur()};c("memory_dump").onclick=function(){const H=u.Fa.s.fb;rb(new Uint8Array(H.buffer,H.byteOffset,H.length),"v86memory.bin");c("memory_dump").blur()};c("capture_network_traffic").onclick=function(){function H(D,C){var J=S,O=J.push,U=performance.now()/1E3;const V=[];let R=0;for(;R+15<C.length;R+=16){var ea=lb(R.toString(16).toUpperCase(),5)+"   ";for(var ca=0;16>ca;ca++)ea+=
lb(C[R+ca].toString(16).toUpperCase(),2)+" ";ea+="  ";for(ca=0;16>ca;ca++){var X=C[R+ca];ea+=33<=X&&34!==X&&92!==X&&126>=X?String.fromCharCode(X):"."}V.push(ea)}for(ea=lb(R.toString(16).toUpperCase(),5)+"   ";R<C.length;R++)ea+=lb(C[R].toString(16).toUpperCase(),2)+" ";ca=R&15;ea+="   ".repeat(16-ca);ea+="  ";for(X=0;X<ca;X++){const ka=C[R+X];ea+=33<=ka&&34!==ka&&92!==ka&&126>=ka?String.fromCharCode(ka):"."}V.push(ea);O.call(J,{direction:D,time:U,Jj:"\n"+V.join("\n")+"\n"});c("capture_network_traffic").value=
S.length+" packets"}this.value="0 packets";let S=[];u.se.register("net0-receive",H.bind(this,"I"));ib(u,"net0-send",H.bind(this,"O"));this.onclick=function(){const D=S.map(({direction:C,time:J,Jj:O})=>C+" "+J.toFixed(6)+O+"\n").join("");rb(D,"traffic.hex");S=[];this.value="0 packets"}};c("save_state").onclick=async function(){const H=await u.Mf();rb(H,"v86state.bin");c("save_state").blur()};c("load_state").onclick=function(){c("load_state_input").click();c("load_state").blur()};c("load_state_input").onchange=
async function(){var H=this.files[0];if(H){var S=u.Cd();S&&await u.stop();var D=new FileReader;D.onload=async function(C){try{await u.ef(C.target.result)}catch(J){throw alert("Something bad happened while restoring the state:\n"+J+"\n\nNote that the current configuration must be the same as the original"),J;}S&&u.Lf()};D.readAsArrayBuffer(H);this.value=""}};c("ctrlaltdel").onclick=function(){tb(u,[29,56,83,157,184,211]);c("ctrlaltdel").blur()};c("alttab").onclick=function(){tb(u,[56,15]);setTimeout(function(){tb(u,
[184,143])},100);c("alttab").blur()};c("scale").onchange=function(){var H=parseFloat(this.value);(H||0<H)&&u.oc&&u.oc.fh(H,H)};c("fullscreen").onclick=function(){if(u.oc){var H=document.getElementById("screen_container");if(H){var S=H.requestFullScreen||H.webkitRequestFullscreen||H.mozRequestFullScreen||H.msRequestFullScreen;S&&(S.call(H),(H=document.getElementsByClassName("phone_keyboard")[0])&&H.focus());try{navigator.keyboard.lock()}catch(D){}sb()}}};c("screen_container").onclick=function(){u.Cd()&&
u.g&&"suspended"===u.g.S.state&&u.g.S.resume();if(N&&G)sb();else if(window.getSelection().isCollapsed){const H=document.getElementsByClassName("phone_keyboard")[0];H.style.top=document.body.scrollTop+100+"px";H.style.left=document.body.scrollLeft+100+"px";H.focus()}};const Ha=document.getElementsByClassName("phone_keyboard")[0];Ha.setAttribute("autocorrect","off");Ha.setAttribute("autocapitalize","off");Ha.setAttribute("spellcheck","false");Ha.tabIndex=0;c("screen_container").addEventListener("mousedown",
()=>{Ha.focus()},!1);c("take_screenshot").onclick=function(){const H=u.oc?u.oc.Pj():null;try{window.open("").document.write(H.outerHTML)}catch(S){}c("take_screenshot").blur()};if(u.g){let H=!1;c("mute").onclick=function(){H?(u.g.rg.Bg(1,void 0),H=!1,c("mute").value="Mute"):(u.g.rg.Bg(0,void 0),H=!0,c("mute").value="Unmute");c("mute").blur()}}else c("mute").remove();window.addEventListener("keydown",E,!1);window.addEventListener("keyup",E,!1);window.addEventListener("blur",E,!1);const Oa=document.createElement("script");
Oa.src="build/xterm.js";Oa.async=!0;Oa.onload=function(){var H=c("terminal");u.pc&&u.pc.Aa&&u.pc.Aa();u.pc=new ub(H,u.A);u.pc.show()};document.body.appendChild(Oa)}function g(z){c("filesystem_panel").style.display="block";c("filesystem_send_file").onchange=function(){Array.prototype.forEach.call(this.files,function(u){var w=new vb(u);w.onload=function(){w.kc(async function(r){await z.fj("/"+u.name,new Uint8Array(r))})};w.load()},this);this.value="";this.blur()};c("filesystem_get_file").onkeypress=
async function(u){if(13===u.which){this.disabled=!0;try{var w=await z.Kf(this.value)}catch(r){console.log(r)}this.disabled=!1;w?(u=this.value.replace(/\/$/,"").split("/"),u=u[u.length-1]||"root",rb(w,u),this.value=""):alert("Can't read file")}}}function m(z){if(z.Fa){var u=z.Fa.s.debug;c("dump_gdt").onclick=u.tj.bind(u);c("dump_idt").onclick=u.uj.bind(u);c("dump_regs").onclick=u.Ch.bind(u);c("dump_pt").onclick=u.vj.bind(u);c("dump_log").onclick=function(){rb(wb.join(""),"v86.log")};var w=z.Fa.s;c("debug_panel").style.display=
"block";setInterval(function(){c("debug_panel").textContent=w.debug.Ej().join("\n")+"\n"+w.debug.ea();c("dump_log").value="Dump log"+(wb.length?" ("+wb.length+" lines)":"")},1E3);window.s=w;window.g=rb}}function n(){location.reload()}function p(z){window.history.pushState&&(z="?"+[...z.entries()].map(([u,w])=>u+"="+w.replace(/[?&=#+]/g,encodeURIComponent)).join("&"),window.history.pushState({search:z},"",z))}const t=!location.hostname.endsWith("copy.sh"),x=["wss://relay.widgetry.org/","ws://localhost:8080/"];
let y=0;const F="memory_size video_memory_size networking_proxy disable_audio enable_acpi boot_order".split(" ");for(const z of F)try{window.localStorage.removeItem(z)}catch(u){}window.addEventListener("load",d,!1);window.addEventListener("load",function(){setTimeout(function(){window.addEventListener("popstate",n)},0)});"complete"===document.readyState&&d()})();var cb=-15786961;function xb(a){this.ports=[];this.s=a;for(var b=0;65536>b;b++)this.ports[b]=yb(this);var c=a.F[0];for(b=0;b<<17<c;b++)a.j[b]=a.Ff[b]=void 0,a.zb[b]=a.Ef[b]=void 0;zb(this,c,4294967296-c,function(d){K("Read from unmapped memory space, addr="+B(d>>>0,8),32);return 255},function(d,e){K("Write to unmapped memory space, addr="+B(d>>>0,8)+" value="+B(e,2),32)},function(d){K("Read from unmapped memory space, addr="+B(d>>>0,8),32);return-1},function(d,e){K("Write to unmapped memory space, addr="+B(d>>>0,
8)+" value="+B(e>>>0,8),32)})}function yb(a){return{$a:a.ig,Da:a.gg,Pd:a.hg,Ne:a.Rb,Xd:a.Rb,wa:a.Rb,Ba:void 0}}k=xb.prototype;k.ig=function(){return 255};k.gg=function(){return 65535};k.hg=function(){return-1};k.Rb=function(){};
function M(a,b,c,d,e,f){function h(g){l(!1,"Overlapped read"+g+" "+B(b,4)+" ("+c.name+")");return-1>>>32-g|0}l("number"===typeof b);l("object"===typeof c);l(!d||"function"===typeof d);l(!e||"function"===typeof e);l(!f||"function"===typeof f);l(d||e||f);d||(d=h.bind(a,8));e||(e=h.bind(a,16));f||(f=h.bind(a,32));d&&(a.ports[b].$a=d);e&&(a.ports[b].Da=e);f&&(a.ports[b].Pd=f);a.ports[b].Ba=c}
function T(a,b,c,d,e,f){function h(g){l(!1,"Overlapped write"+g+" "+B(b)+" ("+c.name+")")}l("number"===typeof b);l("object"===typeof c);l(!d||"function"===typeof d);l(!e||"function"===typeof e);l(!f||"function"===typeof f);l(d||e||f);d||(d=h.bind(a,8));e||(e=h.bind(a,16));f||(f=h.bind(a,32));d&&(a.ports[b].Ne=d);e&&(a.ports[b].Xd=e);f&&(a.ports[b].wa=f);a.ports[b].Ba=c}
k.Ie=function(a,b,c,d,e,f){function h(){return c.call(this)|d.call(this)<<8}function g(){return e.call(this)|f.call(this)<<8}function m(){return c.call(this)|d.call(this)<<8|e.call(this)<<16|f.call(this)<<24}l(4===arguments.length||6===arguments.length);e&&f?(M(this,a,b,c,h,m),M(this,a+1,b,d),M(this,a+2,b,e,g),M(this,a+3,b,f)):(M(this,a,b,c,h),M(this,a+1,b,d))};
k.nd=function(a,b,c,d,e,f){function h(n){c.call(this,n&255);d.call(this,n>>8&255)}function g(n){e.call(this,n&255);f.call(this,n>>8&255)}function m(n){c.call(this,n&255);d.call(this,n>>8&255);e.call(this,n>>16&255);f.call(this,n>>>24)}l(4===arguments.length||6===arguments.length);e&&f?(T(this,a,b,c,h,m),T(this,a+1,b,d),T(this,a+2,b,e,g),T(this,a+3,b,f)):(T(this,a,b,c,h),T(this,a+1,b,d))};k.Qj=function(a){var b=this.s.j[a>>>17];return b(a)|b(a+1)<<8|b(a+2)<<16|b(a+3)<<24};
k.Rj=function(a,b){var c=this.s.Ff[a>>>17];c(a,b&255);c(a+1,b>>8&255);c(a+2,b>>16&255);c(a+3,b>>>24)};function zb(a,b,c,d,e,f,h){K("mmap_register addr="+B(b>>>0,8)+" size="+B(c,8),32);l(0===(b&131071));l(c&&0===(c&131071));f||(f=a.Qj.bind(a));h||(h=a.Rj.bind(a));for(b>>>=17;0<c;b++)a.s.j[b]=d,a.s.Ff[b]=e,a.s.zb[b]=f,a.s.Ef[b]=h,c-=131072}function Ab(a,b){var c=a.ports[b];c.Pd===a.hg&&K("read32 port  #"+B(b,4)+Bb(b),32);a=c.Pd.call(c.Ba);l((a|0)===a);return a}
var Cb={4:"PORT_DMA_ADDR_2",5:"PORT_DMA_CNT_2",10:"PORT_DMA1_MASK_REG",11:"PORT_DMA1_MODE_REG",12:"PORT_DMA1_CLEAR_FF_REG",13:"PORT_DMA1_MASTER_CLEAR",32:"PORT_PIC1_CMD",33:"PORT_PIC1_DATA",64:"PORT_PIT_COUNTER0",65:"PORT_PIT_COUNTER1",66:"PORT_PIT_COUNTER2",67:"PORT_PIT_MODE",96:"PORT_PS2_DATA",97:"PORT_PS2_CTRLB",100:"PORT_PS2_STATUS",112:"PORT_CMOS_INDEX",113:"PORT_CMOS_DATA",128:"PORT_DIAG",129:"PORT_DMA_PAGE_2",146:"PORT_A20",160:"PORT_PIC2_CMD",161:"PORT_PIC2_DATA",178:"PORT_SMI_CMD",179:"PORT_SMI_STATUS",
212:"PORT_DMA2_MASK_REG",214:"PORT_DMA2_MODE_REG",218:"PORT_DMA2_MASTER_CLEAR",240:"PORT_MATH_CLEAR",368:"PORT_ATA2_CMD_BASE",496:"PORT_ATA1_CMD_BASE",632:"PORT_LPT2",744:"PORT_SERIAL4",760:"PORT_SERIAL2",884:"PORT_ATA2_CTRL_BASE",888:"PORT_LPT1",1E3:"PORT_SERIAL3",1008:"PORT_FD_BASE",1010:"PORT_FD_DOR",1012:"PORT_FD_STATUS",1013:"PORT_FD_DATA",1014:"PORT_HD_DATA",1015:"PORT_FD_DIR",1016:"PORT_SERIAL1",3320:"PORT_PCI_CMD",3321:"PORT_PCI_REBOOT",3324:"PORT_PCI_DATA",1026:"PORT_BIOS_DEBUG",1296:"PORT_QEMU_CFG_CTL",
1297:"PORT_QEMU_CFG_DATA",45056:"PORT_ACPI_PM_BASE",45312:"PORT_SMB_BASE",35072:"PORT_BIOS_APM"};function Bb(a){return Cb[a]?"  ("+Cb[a]+")":""};function Db(a,b){this.i=this.h=!1;this.l=!0;this.j=0;this.g=null;this.s=new Eb(a,b,()=>{this.l&&Fb(this,0)});this.A=a;this.o()}k=Db.prototype;k.Lf=function(){this.i=!1;this.h||(this.h=!0,this.A.send("emulator-started"));Fb(this,0)};function Gb(a){if(a.i||!a.h)a.i=a.h=!1,a.A.send("emulator-stopped");else{a.l=!1;var b=a.s.ee();Fb(a,b)}}function Fb(a,b){const c=++a.j;a.l=!0;a.C(b,c)}k.stop=function(){this.h&&(this.i=!0)};k.Aa=function(){this.u()};k.$g=function(){this.s.Ab();Ib(this.s)};
k.Eb=function(a){this.s.Eb(a,this.A);this.A.send("emulator-ready")};
if("undefined"!==typeof process)Db.prototype.C=function(a,b){1>a?global.setImmediate(c=>{c===this.j&&Gb(this)},b):setTimeout(c=>{c===this.j&&Gb(this)},a,b)},Db.prototype.o=function(){},Db.prototype.u=function(){};else if("undefined"!==typeof Worker){function a(){let b;globalThis.onmessage=function(c){const d=c.data.t;b=b&&clearTimeout(b);1>d?postMessage(c.data.Ci):b=setTimeout(()=>postMessage(c.data.Ci),d)}}Db.prototype.o=function(){const b=URL.createObjectURL(new Blob(["("+a.toString()+")()"],{type:"text/javascript"}));
this.g=new Worker(b);this.g.onmessage=c=>{c.data===this.j&&Gb(this)};URL.revokeObjectURL(b)};Db.prototype.C=function(b,c){this.g.postMessage({t:b,Ci:c})};Db.prototype.u=function(){this.g&&this.g.terminate();this.g=null}}else Db.prototype.C=function(a){setTimeout(()=>{Gb(this)},a)},Db.prototype.o=function(){},Db.prototype.u=function(){};Db.prototype.Mf=function(){return this.s.Mf()};Db.prototype.ef=function(a){return this.s.ef(a)};
if("object"===typeof performance&&performance.now)var Jb=performance.now.bind(performance);else if("function"===typeof require){const {performance:a}=require("perf_hooks");Jb=a.now.bind(a)}else"object"===typeof process&&process.hrtime?Jb=function(){var a=process.hrtime();return 1E3*a[0]+a[1]/1E6}:Jb=Date.now;var vb,Kb,Lb,Mb,Nb,Ob,Pb;function fb(a,b){return(a||0===a?a+"":"").padEnd(b," ")}function lb(a,b){return(a||0===a?a+"":"").padStart(b,"0")}function W(a,b,c,d){l(0<=c);return new Proxy({},{get:function(e,f){e=new a(b.buffer,c,d);const h=e[f];if("function"===typeof h)return h.bind(e);l(/^\d+$/.test(f)||"buffer"===f||"length"===f||"BYTES_PER_ELEMENT"===f||"byteOffset"===f);return h},set:function(e,f,h){l(/^\d+$/.test(f));(new a(b.buffer,c,d))[f]=h;return!0}})}
function B(a,b){return"0x"+lb((a?a.toString(16):"").toUpperCase(),b||1)}if("undefined"!==typeof crypto&&crypto.getRandomValues){const a=new Int32Array(1);var Qb=function(){crypto.getRandomValues(a);return a[0]}}else if("undefined"!==typeof require){const a=require("crypto");Qb=function(){return a.bm(4).readInt32LE(0)}}else l(!1,"Unsupported platform: No cryptographic random values");
(function(){if("function"===typeof Math.clz32)Kb=function(d){l(0<d);return 31-Math.clz32(d)};else{for(var a=new Int8Array(256),b=0,c=-2;256>b;b++)b&b-1||c++,a[b]=c;Kb=function(d){d>>>=0;l(0<d);var e=d>>>16;if(e){var f=e>>>8;return f?24+a[f]:16+a[e]}return(f=d>>>8)?8+a[f]:a[d]}}})();function gb(a){l(0<=a);return 1>=a?1:1<<1+Kb(a-1)}l(0===Kb(1));l(1===Kb(2));l(2===Kb(7));l(3===Kb(8));l(26===Kb(123456789));l(1===gb(0));l(1===gb(1));l(2===gb(2));l(8===gb(7));l(8===gb(8));l(134217728===gb(123456789));
function Rb(a){var b=new Uint8Array(a),c,d;l(0===(a&a-1));this.length=0;this.push=function(e){this.length!==a&&this.length++;b[d]=e;d=d+1&a-1};this.shift=function(){if(this.length){var e=b[c];c=c+1&a-1;this.length--;return e}return-1};this.clear=function(){this.length=d=c=0};this.clear()}function Sb(){this.size=65536;this.data=new Float32Array(65536);this.length=this.end=this.start=0;l(!0)}
Sb.prototype.push=function(a){this.length===this.size?this.start=this.start+1&this.size-1:this.length++;this.data[this.end]=a;this.end=this.end+1&this.size-1};Sb.prototype.shift=function(){if(this.length){var a=this.data[this.start];this.start=this.start+1&this.size-1;this.length--;return a}};
function Tb(a,b){var c=new Float32Array(b);b>a.length&&(b=a.length);var d=a.start+b,e=a.data.subarray(a.start,d);c.set(e);d>=a.size&&(d-=a.size,c.set(a.data.subarray(0,d),e.length));a.start=d;a.length-=b;return c}Sb.prototype.clear=function(){this.length=this.end=this.start=0};function rb(a,b){a instanceof Array||(a=[a]);qb(new Blob(a),b)}
function qb(a,b){var c=document.createElement("a");c.download=b;c.href=window.URL.createObjectURL(a);c.dataset.downloadurl=["application/octet-stream",c.download,c.href].join(":");document.createEvent?(a=document.createEvent("MouseEvent"),a.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),c.dispatchEvent(a)):c.click();window.URL.revokeObjectURL(c.href)}
function Ub(a){"number"===typeof a?this.view=new Uint8Array(a+7>>3):a instanceof ArrayBuffer?this.view=new Uint8Array(a):l(!1,"v86util.Bitmap: Invalid argument")}Ub.prototype.set=function(a,b){const c=a>>3;a=1<<(a&7);this.view[c]=b?this.view[c]|a:this.view[c]&~a};Ub.prototype.get=function(a){return this.view[a>>3]>>(a&7)&1};Ub.prototype.kc=function(){return this.view.buffer};var Xb="undefined"===typeof XMLHttpRequest?Vb:Wb;
function Wb(a,b,c){function d(){const m=c||0;setTimeout(()=>{Wb(a,b,m+1)},1E3*([1,1,2,3,5,8,13,21][m]||34))}var e=new XMLHttpRequest;e.open(b.method||"get",a,!0);e.responseType=b.le?"json":"arraybuffer";if(b.headers)for(var f=Object.keys(b.headers),h=0;h<f.length;h++){var g=f[h];e.setRequestHeader(g,b.headers[g])}b.He&&(f=b.He.start,e.setRequestHeader("Range","bytes="+f+"-"+(f+b.He.length-1)),e.setRequestHeader("X-Accept-Encoding","identity"),e.onreadystatechange=function(){200===e.status&&(console.error("Server sent full file in response to ranged request, aborting",
{filename:a}),e.abort())});e.onload=function(){if(4===e.readyState)if(200!==e.status&&206!==e.status)console.error("Loading the image "+a+" failed (status %d)",e.status),500<=e.status&&600>e.status&&d();else if(e.response){if(b.He){const m=e.getResponseHeader("Content-Encoding");m&&"identity"!==m&&console.error("Server sent Content-Encoding in response to ranged request",{filename:a,Rl:m})}b.done&&b.done(e.response,e)}};e.onerror=function(m){console.error("Loading the image "+a+" failed",m);d()};
b.progress&&(e.onprogress=function(m){b.progress(m)});e.send(null)}function Vb(a,b){const c=require("fs");b.He?(l(!b.le),c.open(a,"r",(d,e)=>{if(d)throw d;const f=b.He.length;var h=Buffer.allocUnsafe(f);c.read(e,h,0,f,b.He.start,(g,m)=>{if(g)throw g;l(m===f);b.done&&b.done(new Uint8Array(h));c.close(e,n=>{if(n)throw n;})})})):c.readFile(a,{encoding:b.le?"utf-8":null},function(d,e){d?console.log("Could not read file:",a,d):(d=e,b.le?d=JSON.parse(d):d=(new Uint8Array(d)).buffer,b.done(d))})};(function(){function a(h){l(h instanceof ArrayBuffer);this.buffer=h;this.byteLength=h.byteLength;this.onload=void 0}function b(h,g,m){this.filename=h;this.byteLength=g;this.g=new Map;this.i=new Set;this.L=m;this.u=!!m;this.onload=void 0}function c(h,g,m,n,p){const t=h.match(/\.[^\.]+(\.zst)?$/);this.j=t?t[0]:"";this.h=h.substring(0,h.length-this.j.length);this.D=this.j.endsWith(".zst");this.h.endsWith("/")||(this.h+="-");this.g=new Map;this.i=new Set;this.byteLength=g;this.L=m;this.G=!!n;this.C=p;
this.u=!!m;this.onload=void 0}function d(h){this.file=h;this.byteLength=h.size;1073741824<h.size&&console.warn("SyncFileBuffer: Allocating buffer of "+(h.size>>20)+" MB ...");this.buffer=new ArrayBuffer(h.size);this.onload=void 0}function e(h){this.file=h;this.byteLength=h.size;this.g=new Map;this.i=new Set;this.onload=void 0}Lb=a;Ob=b;Nb=c;Mb=e;vb=d;Pb=function(h,g){if(h.buffer instanceof ArrayBuffer)return new Lb(h.buffer);if("undefined"!==typeof File&&h.buffer instanceof File)return g=h.async,
void 0===g&&(g=268435456<=h.buffer.size),g?new Mb(h.buffer):new vb(h.buffer);if(h.url)return h.ca?new Nb(h.url,h.size,h.L,!1,g):new Ob(h.url,h.size,h.L);K("Ignored file: url="+h.url+" buffer="+h.buffer)};a.prototype.load=function(){this.onload&&this.onload({buffer:this.buffer})};a.prototype.get=function(h,g,m){l(h+g<=this.byteLength);m(new Uint8Array(this.buffer,h,g))};a.prototype.set=function(h,g,m){l(h+g.byteLength<=this.byteLength);(new Uint8Array(this.buffer,h,g.byteLength)).set(g);m()};a.prototype.kc=
function(h){h(this.buffer)};a.prototype.ea=function(){const h=[];h[0]=this.byteLength;h[1]=new Uint8Array(this.buffer);return h};a.prototype.I=function(h){this.byteLength=h[0];this.buffer=h[1].slice().buffer};b.prototype.load=function(){void 0!==this.byteLength?this.onload&&this.onload(Object.create(null)):f(this.filename,(h,g)=>{if(h)throw Error("Cannot use: "+this.filename+". "+h);l(0<=g);this.byteLength=g;this.onload&&this.onload(Object.create(null))})};b.prototype.h=function(h,g){var m=g/256;
h/=256;for(var n=0;n<m;n++)if(!this.g.get(h+n))return;if(1===m)return this.g.get(h);g=new Uint8Array(g);for(n=0;n<m;n++)g.set(this.g.get(h+n),256*n);return g};b.prototype.get=function(h,g,m){l(h+g<=this.byteLength);l(0===h%256);l(0===g%256);l(g);var n=this.h(h,g);if(n)m(n);else{var p=h,t=g;this.L&&(p=h-h%this.L,t=Math.ceil((h-p+g)/this.L)*this.L);Xb(this.filename,{done:function(x){x=new Uint8Array(x);this.j(p,t,x);p===h&&t===g?m(x):m(x.subarray(h-p,h-p+g))}.bind(this),He:{start:p,length:t}})}};b.prototype.set=
function(h,g,m){var n=g.length;l(h+g.byteLength<=this.byteLength);l(0===h%256);l(0===n%256);l(n);h/=256;n/=256;for(var p=0;p<n;p++){var t=this.g.get(h+p);if(void 0===t)this.g.set(h+p,g.slice(256*p,256*(p+1)));else{const x=g.subarray(256*p,256*(p+1));l(t.byteLength===x.length);t.set(x)}this.i.add(h+p)}m()};b.prototype.j=function(h,g,m){h/=256;g/=256;for(var n=0;n<g;n++){const p=this.g.get(h+n);p?m.set(p,256*n):this.u&&this.g.set(h+n,m.slice(256*n,256*(n+1)))}};b.prototype.kc=function(h){h()};b.prototype.ea=
function(){const h=[],g=[];for(const [m,n]of this.g)l(isFinite(m)),this.i.has(m)&&g.push([m,n]);h[0]=g;return h};b.prototype.I=function(h){h=h[0];this.g.clear();this.i.clear();for(const [g,m]of h)l(isFinite(g)),this.g.set(g,m),this.i.add(g)};c.prototype.load=function(){void 0===this.byteLength&&l(!1);this.onload&&this.onload(Object.create(null))};c.prototype.get=function(h,g,m){l(h+g<=this.byteLength);l(0===h%256);l(0===g%256);l(g);var n=this.l(h,g);if(n)m(n);else if(this.L){const t=Math.floor(h/
this.L),x=h-t*this.L;l(0<=x);const y=Math.ceil((x+g)/this.L),F=new Uint8Array(y*this.L);let z=0;for(let u=0;u<y;u++){var p=(t+u)*this.L;n=this.G?this.h+(t+u+"").padStart(8,"0")+this.j:this.h+p+"-"+(p+this.L)+this.j;(p=this.l(p,this.L))?(F.set(p,u*this.L),z++,z===y&&m(F.subarray(x,x+g))):Xb(n,{done:async function(w){w=new Uint8Array(w);this.D&&(w=await this.C(this.L,w),w=new Uint8Array(w));F.set(w,u*this.L);this.o((t+u)*this.L,this.L|0,w);z++;z===y&&m(F.subarray(x,x+g))}.bind(this)})}}else Xb(this.h+
h+"-"+(h+g)+this.j,{done:function(t){l(t.byteLength===g);t=new Uint8Array(t);this.o(h,g,t);m(t)}.bind(this)})};c.prototype.l=b.prototype.h;c.prototype.set=b.prototype.set;c.prototype.o=b.prototype.j;c.prototype.ea=b.prototype.ea;c.prototype.I=b.prototype.I;d.prototype.load=function(){this.g(0)};d.prototype.g=function(h){var g=new FileReader;g.onload=function(m){m=new Uint8Array(m.target.result);(new Uint8Array(this.buffer,h)).set(m);this.g(h+4194304)}.bind(this);h<this.byteLength?g.readAsArrayBuffer(this.file.slice(h,
Math.min(h+4194304,this.byteLength))):(this.file=void 0,this.onload&&this.onload({buffer:this.buffer}))};d.prototype.get=a.prototype.get;d.prototype.set=a.prototype.set;d.prototype.kc=a.prototype.kc;d.prototype.ea=a.prototype.ea;d.prototype.I=a.prototype.I;e.prototype.load=function(){this.onload&&this.onload(Object.create(null))};e.prototype.get=function(h,g,m){l(0===h%256);l(0===g%256);l(g);var n=this.h(h,g);n?m(n):(n=new FileReader,n.onload=function(p){p=new Uint8Array(p.target.result);this.j(h,
g,p);m(p)}.bind(this),n.readAsArrayBuffer(this.file.slice(h,h+g)))};e.prototype.h=b.prototype.h;e.prototype.set=b.prototype.set;e.prototype.j=b.prototype.j;e.prototype.ea=b.prototype.ea;e.prototype.I=b.prototype.I;e.prototype.kc=function(h){h()};e.prototype.Kh=function(h){for(var g=[],m=Array.from(this.g.keys()).sort(function(y,F){return y-F}),n=0,p=0;p<m.length;p++){var t=m[p],x=this.g.get(t);t*=256;l(t>=n);t!==n&&(g.push(this.file.slice(n,t)),n=t);g.push(x);n+=x.length}n!==this.file.size&&g.push(this.file.slice(n));
h=new File(g,h);l(h.size===this.file.size);return h};var f="undefined"===typeof XMLHttpRequest?function(h,g){require("fs").stat(h,(m,n)=>{m?g(m):g(null,n.size)})}:function(h,g){Xb(h,{done:(m,n)=>{m=n.getResponseHeader("Content-Range")||"";(n=m.match(/\/(\d+)\s*$/))?g(null,+n[1]):g("`Range: bytes=...` header not supported (Got `"+m+"`)")},headers:{Range:"bytes=0-0","X-Accept-Encoding":"identity"}})}})();function Yb(a,b,c,d,e,f){this.Oa=new Zb(this,a,b,d,e,f);this.Va=new Zb(this,a,c,!1,e,f);this.pa=this.Oa;this.s=a;0===e?(this.g=496,this.na=14,this.Ta=240):1===e?(this.g=368,this.na=15,this.Ta=248):l(!1,"IDE device with nr "+e+" ignored");this.i=this.g|516;this.h=46080;this.O=[134,128,16,112,5,0,160,2,0,128,1,1,0,0,0,0,this.g&255|1,this.g>>8,0,0,this.i&255|1,this.i>>8,0,0,0,0,0,0,0,0,0,0,this.h&255|1,this.h>>8,0,0,0,0,0,0,0,0,0,0,67,16,212,130,0,0,0,0,0,0,0,0,0,0,0,0,this.na,1,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.Gb=[{size:8},{size:4},void 0,void 0,{size:16}];this.name="ide"+e;this.l=2;M(a.B,this.g|7,this,function(){K("lower irq",32768);$b(this.s,this.na);return this.ri()});M(a.B,this.i|2,this,this.ri);T(a.B,this.i|2,this,this.Gl);M(a.B,this.g|0,this,function(){return ac(this.pa,1)},function(){return ac(this.pa,2)},function(){return ac(this.pa,
4)});M(a.B,this.g|1,this,function(){K("Read error: "+B(this.pa.error&255)+" slave="+(this.pa===this.Va),32768);return this.pa.error&255});M(a.B,this.g|2,this,function(){K("Read bytecount: "+B(this.pa.ja&255),32768);return this.pa.ja&255});M(a.B,this.g|3,this,function(){K("Read sector: "+B(this.pa.Ka&255),32768);return this.pa.Ka&255});M(a.B,this.g|4,this,function(){K("Read 1F4: "+B(this.pa.ya&255),32768);return this.pa.ya&255});M(a.B,this.g|5,this,function(){K("Read 1F5: "+B(this.pa.za&255),32768);
return this.pa.za&255});M(a.B,this.g|6,this,function(){K("Read 1F6",32768);return this.pa.xc&255});T(a.B,this.g|0,this,function(h){bc(this.pa,h,1)},function(h){bc(this.pa,h,2)},function(h){bc(this.pa,h,4)});T(a.B,this.g|1,this,function(h){K("1F1/lba_count: "+B(h),32768);this.Oa.we=(this.Oa.we<<8|h)&65535;this.Va.we=(this.Va.we<<8|h)&65535});T(a.B,this.g|2,this,function(h){K("1F2/bytecount: "+B(h),32768);this.Oa.ja=(this.Oa.ja<<8|h)&65535;this.Va.ja=(this.Va.ja<<8|h)&65535});T(a.B,this.g|3,this,function(h){K("1F3/sector: "+
B(h),32768);this.Oa.Ka=(this.Oa.Ka<<8|h)&65535;this.Va.Ka=(this.Va.Ka<<8|h)&65535});T(a.B,this.g|4,this,function(h){K("1F4/sector low: "+B(h),32768);this.Oa.ya=(this.Oa.ya<<8|h)&65535;this.Va.ya=(this.Va.ya<<8|h)&65535});T(a.B,this.g|5,this,function(h){K("1F5/sector high: "+B(h),32768);this.Oa.za=(this.Oa.za<<8|h)&65535;this.Va.za=(this.Va.za<<8|h)&65535});T(a.B,this.g|6,this,function(h){var g=h&16;K("1F6/drive: "+B(h,2),32768);g?(K("Slave",32768),this.pa=this.Va):this.pa=this.Oa;this.Oa.xc=h;this.Va.xc=
h;this.Oa.Bd=this.Va.Bd=h>>6&1;this.Oa.head=this.Va.head=h&15});this.j=this.Ea=this.kd=0;T(a.B,this.g|7,this,function(h){K("lower irq",32768);$b(this.s,this.na);var g=this.pa;K("ATA Command: "+B(h)+" slave="+(g.xc>>4&1),32768);if(g.buffer)switch(g.j=h,g.error=0,h){case 8:K("ATA device reset",32768);g.i=0;g.g=0;g.h=0;cc(g);g.ba();break;case 16:g.status=80;g.ya=0;g.ba();break;case 248:g.status=80;var m=g.l-1;g.Ka=m&255;g.ya=m>>8&255;g.za=m>>16&255;g.xc=g.xc&240|m>>24&15;g.ba();break;case 39:g.status=
80;m=g.l-1;g.Ka=m&255;g.ya=m>>8&255;g.za=m>>16&255;g.Ka|=m>>24<<8&65280;g.ba();break;case 32:case 36:case 41:case 196:dc(g,h);break;case 48:case 52:case 57:case 197:var n=52===h||57===h;m=ec(g,n);n=fc(g,n);h=48===h||52===h;var p=m*g.o,t=n*g.o;K("ATA write lba="+B(n)+" mode="+(g.Bd?"lba":"chs")+" lbacount="+B(m)+" bytecount="+B(p),32768);t+p>g.buffer.byteLength?(l(!1,"ATA write: Outside of disk"),g.status=255,g.ba()):(g.status=88,gc(g,p),g.g=h?512:Math.min(p,512*g.J),g.X=t);break;case 144:g.ba();g.error=
257;g.status=80;break;case 145:g.status=80;g.ba();break;case 160:g.G&&(g.status=88,hc(g,12),g.g=12,g.ja=1,g.ba());break;case 161:K("ATA identify packet device",32768);g.G?(ic(g),g.status=88,g.ya=20,g.za=235):g.status=65;g.ba();break;case 198:K("Logical sectors per DRQ Block: "+B(g.ja&255),32768);g.J=g.ja&255;g.status=80;g.ba();break;case 37:case 200:n=37===h;m=ec(g,n);n=fc(g,n);h=m*g.o;p=n*g.o;K("ATA DMA read lba="+B(n)+" lbacount="+B(m)+" bytecount="+B(h),32768);p+h>g.buffer.byteLength?(l(!1,"ATA read: Outside of disk"),
g.status=255,g.ba()):(g.status=88,g.Ba.Ea|=1);break;case 53:case 202:n=53===h;m=ec(g,n);n=fc(g,n);h=m*g.o;p=n*g.o;K("ATA DMA write lba="+B(n)+" lbacount="+B(m)+" bytecount="+B(h),32768);p+h>g.buffer.byteLength?(l(!1,"ATA DMA write: Outside of disk"),g.status=255,g.ba()):(g.status=88,g.Ba.Ea|=1);break;case 64:K("read verify sectors",32768);g.status=80;g.ba();break;case 218:K("Unimplemented: get media status",32768);g.status=65;g.error=4;g.ba();break;case 224:K("ATA standby immediate",32768);g.status=
80;g.ba();break;case 225:K("ATA idle immediate",32768);g.status=80;g.ba();break;case 231:K("ATA flush cache",32768);g.status=80;g.ba();break;case 236:K("ATA identify device",32768);if(g.G){g.status=65;g.error=4;g.ba();break}ic(g);g.status=88;g.ba();break;case 234:K("flush cache ext",32768);g.status=80;g.ba();break;case 239:K("set features: "+B(g.ja&255),32768);g.status=80;g.ba();break;case 222:g.status=80;g.ba();break;case 245:K("security freeze lock",32768);g.status=80;g.ba();break;case 249:K("Unimplemented: set max address",
32768);g.status=65;g.error=4;break;default:l(!1,"New ATA cmd on 1F7: "+B(h)),g.status=65,g.error=4}else K("abort: No buffer",32768),g.error=4,g.status=65,g.ba()});M(a.B,this.h|4,this,void 0,void 0,this.oj);T(a.B,this.h|4,this,void 0,void 0,this.qj);M(a.B,this.h,this,this.xh,void 0,this.pj);T(a.B,this.h,this,this.zh,void 0,this.rj);M(a.B,this.h|2,this,this.yh);T(a.B,this.h|2,this,this.Ah);M(a.B,this.h|8,this,function(){K("DMA read 0x8",32768);return 0});M(a.B,this.h|10,this,function(){K("DMA read 0xA",
32768);return 0});jc(a.v.kb,this);Object.seal(this)}k=Yb.prototype;k.ri=function(){if(this.pa.buffer){var a=this.pa.status;K("ATA read status: "+B(a,2),32768);return a}return 0};k.Gl=function(a){K("set device control: "+B(a,2)+" interrupts "+(a&2?"disabled":"enabled"),32768);a&4&&(K("Reset via control port",32768),$b(this.s,this.na),cc(this.Oa),cc(this.Va));this.l=a};k.oj=function(){K("dma get address: "+B(this.kd,8),32768);return this.kd};
k.qj=function(a){K("dma set address: "+B(a,8),32768);this.kd=a};k.yh=function(){K("DMA read status: "+B(this.Ea),32768);return this.Ea};k.Ah=function(a){K("DMA set status: "+B(a),32768);this.Ea&=~(a&6)};k.pj=function(){return this.xh()|this.yh()<<16};k.xh=function(){K("DMA read command: "+B(this.j),32768);return this.j};k.rj=function(a){K("DMA write command: "+B(a),32768);this.zh(a&255);this.Ah(a>>16&255)};
k.zh=function(a){K("DMA write command8: "+B(a),32768);const b=this.j;this.j=a&9;if((b&1)!==(a&1))if(0===(a&1))this.Ea&=-2;else switch(this.Ea|=1,this.pa.j){case 37:case 200:kc(this.pa);break;case 202:case 53:lc(this.pa);break;case 160:mc(this.pa);break;default:K("Spurious dma command write, current command: "+B(this.pa.j),32768),l(!1)}};k.ba=function(){0===(this.l&2)&&(K("push irq",32768),this.Ea|=4,this.s.cb(this.na))};
k.ea=function(){var a=[];a[0]=this.Oa;a[1]=this.Va;a[2]=this.g;a[3]=this.na;a[4]=this.Ta;a[5]=this.i;a[6]=this.h;a[7]=this.name;a[8]=this.l;a[9]=this.kd;a[10]=this.Ea;a[11]=this.pa===this.Oa;a[12]=this.j;return a};k.I=function(a){this.Oa.I(a[0]);this.Va.I(a[1]);this.g=a[2];this.na=a[3];this.Ta=a[4];this.i=a[5];this.h=a[6];this.name=a[7];this.l=a[8];this.kd=a[9];this.Ea=a[10];this.pa=a[11]?this.Oa:this.Va;this.j=a[12]};
function Zb(a,b,c,d,e,f){this.Ba=a;this.A=f;this.Z=e;this.s=b;this.buffer=c;this.o=d?2048:512;this.G=d;this.D=this.u=this.C=this.l=0;this.buffer&&(this.l=this.buffer.byteLength/this.o,this.l!==(this.l|0)&&(K("Warning: Disk size not aligned with sector size",32768),this.l=Math.ceil(this.l)),d?(this.C=1,this.u=0):(this.C=16,this.u=63),this.D=this.l/this.C/this.u,this.D!==(this.D|0)&&(K("Warning: Rounding up cylinder count. Choose different head number",32768),this.D=Math.floor(this.D)),a=b.v.Rd,l(!0),
nc(a,57,a.Wc[57]|1<<4*this.Z),l(!0),nc(a,18,a.Wc[18]&15|240),nc(a,27,this.D&255),nc(a,28,this.D>>8&255),nc(a,29,this.C&255),nc(a,30,255),nc(a,31,255),nc(a,32,200),nc(a,33,this.D&255),nc(a,34,this.D>>8&255),nc(a,35,this.u&255));this.buffer=c;this.xc=this.head=this.za=this.ya=this.we=this.Ka=this.ja=this.Bd=0;this.status=80;this.J=128;this.i=this.error=0;this.data=new Uint8Array(65536);this.U=new Uint16Array(this.data.buffer);this.N=new Int32Array(this.data.buffer);this.g=this.h=0;this.R=this.j=-1;
this.fa=this.X=0;this.P=new Set;this.aa=new Set;Object.seal(this)}function cc(a){a.G?(a.status=0,a.ja=1,a.error=1,a.Ka=1,a.ya=20,a.za=235):(a.status=81,a.ja=1,a.error=1,a.Ka=1,a.ya=0,a.za=0);for(const b of a.P)a.aa.add(b);a.P.clear()}k=Zb.prototype;k.ba=function(){this.Ba.ba()};k.tf=function(){this.status=80;l(this.h<=this.data.length);var a=this.data.subarray(0,this.h);l(0===this.h%512);oc(this,this.j,this.h/512);this.ba();this.buffer.set(this.X,a,function(){});pc(this,this.h)};
function qc(a,b){var c=b[2]<<24|b[3]<<16|b[4]<<8|b[5],d=b[7]<<8|b[8],e=d*a.o,f=c*a.o;K("CD read lba="+B(c)+" lbacount="+B(d)+" bytecount="+B(e)+" flags="+B(b[1]),32768);a.h=0;var h=a.za<<8&65280|a.ya&255;K(B(a.za,2)+" "+B(a.ya,2),32768);a.ya=a.za=0;65535===h&&h--;h>e&&(h=e);f>=a.buffer.byteLength?(l(!1,"CD read: Outside of disk  end="+B(f+e)+" size="+B(a.buffer.byteLength)),a.status=255,a.ba()):0===e?(a.status=80,a.i=0):(e=Math.min(e,a.buffer.byteLength-f),a.status=208,rc(a),a.ra(f,e,g=>{K("cd read: data arrived",
32768);sc(a,g);a.status=88;a.ja=a.ja&-8|2;a.ba();h&=-4;a.g=h;a.g>a.h&&(a.g=a.h);a.ya=a.g&255;a.za=a.g>>8&255;tc(a,e)}))}
function uc(a,b){var c=b[2]<<24|b[3]<<16|b[4]<<8|b[5],d=b[7]<<8|b[8],e=d*a.o,f=c*a.o;K("CD read DMA lba="+B(c)+" lbacount="+B(d)+" bytecount="+B(e)+" flags="+B(b[1]),32768);f>=a.buffer.byteLength?(l(!1,"CD read: Outside of disk  end="+B(f+e)+" size="+B(a.buffer.byteLength)),a.status=255,a.ba()):(a.status=208,rc(a),a.ra(f,e,h=>{K("atapi_read_dma: Data arrived");tc(a,e);a.status=88;a.ja=a.ja&-8|2;sc(a,h);mc(a)}))}
function mc(a){if(0===(a.Ba.Ea&1))K("do_atapi_dma: Status not set",32768);else if(0===(a.status&8))K("do_atapi_dma: DRQ not set",32768);else{K("atapi dma transfer len="+a.h,32768);var b=a.Ba.kd,c=0,d=a.data;do{var e=a.s.h(b),f=a.s.Da(b+4),h=a.s.$a(b+7)&128;f||(f=65536);K("dma read dest="+B(e)+" count="+B(f)+" datalen="+B(a.h),32768);vc(a.s,d.subarray(c,Math.min(c+f,a.h)),e);c+=f;b+=8;if(c>=a.h&&!h){K("leave early end="+ +h+" offset="+B(c)+" data_length="+B(a.h)+" cmd="+B(a.j),32768);break}}while(!h);
K("end offset="+c,32768);a.status=80;a.Ba.Ea&=-2;a.ja=a.ja&-8|3;a.ba()}}
function ac(a,b){if(a.i<a.g){l(a.i+b-1<a.g);l(0===a.i%b,B(a.i)+" "+b);var c=1===b?a.data[a.i]:2===b?a.U[a.i>>>1]:a.N[a.i>>>2];a.i+=b;0===(a.i&(0===(a.g&4095)?4095:255))&&K("Read 1F0: "+B(a.data[a.i],2)+" cur="+B(a.i)+" cnt="+B(a.h),32768);a.i>=a.g&&(K("read_end cmd="+B(a.j)+" data_pointer="+B(a.i)+" end="+B(a.g)+" length="+B(a.h),32768),160===a.j?a.g===a.h?(a.status=80,a.ja=a.ja&-8|3,a.ba()):(a.status=88,a.ja=a.ja&-8|2,a.ba(),b=a.za<<8&65280|a.ya&255,a.g+b>a.h?(a.ya=a.h-a.g&255,a.za=a.h-a.g>>8&255,
a.g=a.h):a.g+=b,K("data_end="+B(a.g),32768)):(a.error=0,a.i>=a.h?a.status=80:(196===a.j||41===a.j?(b=Math.min(a.J,(a.h-a.g)/512),l(0===b%1)):(l(32===a.j||36===a.j),b=1),oc(a,a.j,b),a.g+=512*b,a.status=88,a.ba())));return c}K("Read 1F0: empty",32768);a.i+=b;return 0}
function bc(a,b,c){l(0===a.i%c);if(a.i>=a.g)K("Redundant write to data port: "+B(b)+" count="+B(a.g)+" cur="+B(a.i),32768);else if((0===(a.i+c&(0===(a.g&4095)?4095:255))||20>a.g)&&K("Data port: "+B(b>>>0)+" count="+B(a.g)+" cur="+B(a.i),32768),1===c?a.data[a.i++]=b:2===c?(a.U[a.i>>>1]=b,a.i+=2):(a.N[a.i>>>2]=b,a.i+=4),l(a.i<=a.g),a.i===a.g)if(160===a.j){K("ATAPI Command: "+B(a.data[0])+" slave="+(a.xc>>4&1),32768);a.i=0;a.R=a.data[0];switch(a.R){case 0:K("test unit ready",32768);hc(a,0);a.g=a.h;a.status=
80;break;case 3:hc(a,a.data[4]);a.g=a.h;a.status=88;a.data[0]=240;a.data[2]=5;a.data[7]=8;break;case 18:b=a.data[4];a.status=88;K("inquiry: "+B(a.data[1],2)+" length="+b,32768);a.data.set([5,128,1,49,31,0,0,0,83,79,78,89,32,32,32,32,67,68,45,82,79,77,32,67,68,85,45,49,48,48,48,32,49,46,49,97]);a.g=a.h=Math.min(36,b);break;case 26:hc(a,a.data[4]);a.g=a.h;a.status=88;break;case 30:hc(a,0);a.g=a.h;a.status=80;break;case 37:b=a.l-1;sc(a,new Uint8Array([b>>24&255,b>>16&255,b>>8&255,b&255,0,0,a.o>>8&255,
a.o&255]));a.g=a.h;a.status=88;break;case 40:a.we&1?uc(a,a.data):qc(a,a.data);break;case 66:b=a.data[8];hc(a,Math.min(8,b));a.g=a.h;K("read q subcode: length="+b,32768);a.status=88;break;case 67:b=a.data[8]|a.data[7]<<8;c=a.data[9]>>6;hc(a,b);a.g=a.h;K("read toc: "+B(c,2)+" length="+b+" "+(a.data[1]&2)+" "+B(a.data[6]),32768);0===c?(b=a.l,a.data.set(new Uint8Array([0,18,1,1,0,20,1,0,0,0,0,0,0,22,170,0,b>>24,b>>16&255,b>>8&255,b&255]))):1===c?a.data.set(new Uint8Array([0,10,1,1,0,0,0,0,0,0,0,0])):
l(!1,"Unimplemented format: "+c);a.status=88;break;case 70:b=a.data[8]|a.data[7]<<8;b=Math.min(b,32);hc(a,b);a.g=a.h;a.data[0]=b-4>>24&255;a.data[1]=b-4>>16&255;a.data[2]=b-4>>8&255;a.data[3]=b-4&255;a.data[6]=8;a.data[10]=3;a.status=88;break;case 81:hc(a,0);a.g=a.h;a.status=80;break;case 82:K("Unimplemented ATAPI command: "+B(a.data[0]),32768);a.status=81;a.h=0;a.error=80;break;case 90:b=a.data[8]|a.data[7]<<8;c=a.data[2];K("mode sense: "+B(c)+" length="+b,32768);42===c&&hc(a,Math.min(30,b));a.g=
a.h;a.status=88;break;case 189:hc(a,a.data[9]|a.data[8]<<8);a.g=a.h;a.data[5]=1;a.status=88;break;case 74:a.status=81;a.h=0;a.error=80;K("Unimplemented ATAPI command: "+B(a.data[0]),32768);break;case 190:K("Unimplemented ATAPI command: "+B(a.data[0]),32768);hc(a,0);a.g=a.h;a.status=80;break;default:a.status=81,a.h=0,a.error=80,K("Unimplemented ATAPI command: "+B(a.data[0]),32768),l(!1)}a.ja=a.ja&-8|2;0===(a.status&128)&&a.ba();0===(a.status&128)&&0===a.h&&(a.ja|=1,a.status&=-9)}else K("write_end data_pointer="+
B(a.i)+" data_length="+B(a.h),32768),a.i>=a.h?a.tf():(l(48===a.j||52===a.j||197===a.j,"Unexpected command: "+B(a.j)),a.status=88,a.g+=512,a.ba())}
function oc(a,b,c){K("Advance sectors="+c+" old_bytecount="+a.ja,32768);a.ja-=c;36===b||41===b||52===b||57===b||37===b||53===b?(b=c+wc(a),a.Ka=b&255|b>>16&65280,a.ya=b>>8&255,a.za=b>>16&255):a.Bd?(b=c+xc(a),a.Ka=b&255,a.ya=b>>8&255,a.za=b>>16&255,a.head=a.head&-16|b&15):(b=c+yc(a),c=b/(a.C*a.u)|0,a.ya=c&255,a.za=c>>8&255,a.head=(b/a.u|0)%a.C&15,a.Ka=b%a.u+1&255,l(b===yc(a)))}
function dc(a,b){var c=36===b||41===b,d=ec(a,c);c=fc(a,c);var e=32===b||36===b,f=d*a.o,h=c*a.o;K("ATA read cmd="+B(b)+" mode="+(a.Bd?"lba":"chs")+" lba="+B(c)+" lbacount="+B(d)+" bytecount="+B(f),32768);h+f>a.buffer.byteLength?(l(!1,"ATA read: Outside of disk"),a.status=255,a.ba()):(a.status=192,rc(a),a.ra(h,f,g=>{K("ata_read: Data arrived",32768);sc(a,g);a.status=88;a.g=e?512:Math.min(f,512*a.J);oc(a,b,e?1:Math.min(d,a.u));a.ba();tc(a,f)}))}
function kc(a){var b=37===a.j,c=ec(a,b);b=fc(a,b);var d=c*a.o,e=b*a.o;l(b<a.buffer.byteLength);rc(a);var f=a.Ba.kd;a.ra(e,d,h=>{K("do_ata_read_sectors_dma: Data arrived",32768);var g=a.Ba.kd,m=0;l(f===g);do{var n=a.s.h(g),p=a.s.Da(g+4),t=a.s.$a(g+7)&128;p||(p=65536,K("dma: prd count was 0",32768));K("dma read transfer dest="+B(n)+" prd_count="+B(p),32768);vc(a.s,h.subarray(m,m+p),n);m+=p;g+=8}while(!t);l(m===d);oc(a,a.j,c);a.status=80;a.Ba.Ea&=-2;a.j=-1;a.ba();tc(a,d)})}
function lc(a){var b=53===a.j,c=ec(a,b),d=fc(a,b);b=c*a.o;d*=a.o;var e=a.Ba.kd,f=0;K("prdt addr: "+B(e,8),32768);const h=new Uint8Array(b);do{var g=a.s.h(e),m=a.s.Da(e+4),n=a.s.$a(e+7)&128;m||(m=65536,K("dma: prd count was 0",32768));K("dma write transfer dest="+B(g)+" prd_count="+B(m),32768);g=a.s.fb.subarray(g,g+m);l(g.length===m);h.set(g,f);f+=m;e+=8}while(!n);l(f===h.length);a.buffer.set(d,h,()=>{K("dma write completed",32768);oc(a,a.j,c);a.status=80;a.ba();a.Ba.Ea&=-2;a.j=-1});pc(a,b)}
function yc(a){var b=a.ya&255|a.za<<8&65280,c=a.head,d=a.Ka&255;K("get_chs: c="+b+" h="+c+" s="+d,32768);return(b*a.C+c)*a.u+d-1}function xc(a){return a.Ka&255|a.ya<<8&65280|a.za<<16&16711680|(a.head&15)<<24}function wc(a){return(a.Ka&255|a.ya<<8&65280|a.za<<16&16711680|a.Ka>>8<<24&4278190080)>>>0}function fc(a,b){return b?wc(a):a.Bd?xc(a):yc(a)}function ec(a,b){b?(a=a.ja,0===a&&(a=65536)):(a=a.ja&255,0===a&&(a=256));return a}
function ic(a){if(a.xc&16)hc(a,0);else{for(var b=0;512>b;b++)a.data[b]=0;b=Math.min(16383,a.D);sc(a,[64,a.G?133:0,b,b>>8,0,0,a.C,a.C>>8,a.u/512,a.u/512>>8,0,2,a.u,a.u>>8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,2,4,0,0,0,0,0,0,0,0,0,56,118,32,54,68,72,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,128,0,1,0,0,2,0,0,0,2,0,2,7,0,b,b>>8,a.C,a.C>>8,a.u,0,a.l&255,a.l>>8&255,a.l>>16&255,a.l>>24&255,0,0,a.l&255,a.l>>8&255,a.l>>16&255,
a.l>>24&255,0,0,160===a.j?0:7,160===a.j?0:4,0,0,30,0,30,0,30,0,30,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,126,0,0,0,0,0,0,116,0,64,0,64,0,116,0,64,0,0,0,0,0,0,0,0,0,0,1,96,0,0,0,0,0,0,0,0,0,0,0,0,a.l&255,a.l>>8&255,a.l>>16&255,a.l>>24&255]);a.h=512;a.g=512}}function hc(a,b){gc(a,b);for(var c=0;c<b+3>>2;c++)a.N[c]=0}function gc(a,b){a.data.length<b&&(a.data=new Uint8Array(b+3&-4),a.U=new Uint16Array(a.data.buffer),a.N=new Int32Array(a.data.buffer));a.h=b;a.i=0}
function sc(a,b){gc(a,b.length);a.data.set(b)}function rc(a){a.A.send("ide-read-start")}function tc(a,b){a.A.send("ide-read-end",[a.Z,b,b/a.o|0])}function pc(a,b){a.A.send("ide-write-end",[a.Z,b,b/a.o|0])}k.ra=function(a,b,c){const d=this.fa++;this.P.add(d);this.buffer.get(a,b,e=>{if(this.aa.delete(d))l(!this.P.has(d));else{var f=this.P.delete(d);l(f);c(e)}})};
k.ea=function(){var a=[];a[0]=this.ja;a[1]=this.D;a[2]=this.za;a[3]=this.ya;a[4]=this.i;a[5]=0;a[6]=0;a[7]=0;a[8]=0;a[9]=this.xc;a[10]=this.error;a[11]=this.head;a[12]=this.C;a[13]=this.G;a[14]=this.Bd;a[15]=this.we;a[16]=this.data;a[17]=this.h;a[18]=this.Ka;a[19]=this.l;a[20]=this.o;a[21]=this.J;a[22]=this.u;a[23]=this.status;a[24]=this.X;a[25]=this.j;a[26]=this.g;a[27]=this.R;a[28]=this.buffer;return a};
k.I=function(a){this.ja=a[0];this.D=a[1];this.za=a[2];this.ya=a[3];this.i=a[4];this.xc=a[9];this.error=a[10];this.head=a[11];this.C=a[12];this.G=a[13];this.Bd=a[14];this.we=a[15];this.data=a[16];this.h=a[17];this.Ka=a[18];this.l=a[19];this.o=a[20];this.J=a[21];this.u=a[22];this.status=a[23];this.X=a[24];this.j=a[25];this.g=a[26];this.R=a[27];this.U=new Uint16Array(this.data.buffer);this.N=new Int32Array(this.data.buffer);this.buffer&&this.buffer.I(a[28])};function zc(a){this.Wb=new Uint8Array(4);this.g=new Uint8Array(4);this.Be=new Uint8Array(4);this.Ce=new Uint8Array(4);this.Hd=new Int32Array(this.Wb.buffer);new Int32Array(this.g.buffer);this.Vg=new Int32Array(this.Be.buffer);this.Wh=new Int32Array(this.Ce.buffer);this.sc=[];this.v=[];this.s=a;for(var b=0;256>b;b++)this.sc[b]=void 0,this.v[b]=void 0;this.B=a.B;T(a.B,3324,this,function(c){Ac(this,this.Hd[0],c)},function(c){Bc(this,this.Hd[0],c)},function(c){var d=this.Hd[0];l(0===(d&3));var e=d>>8&
65535;d&=255;var f=this.sc[e],h=this.v[e];if(f)if(16<=d&&40>d){var g=d-16>>2,m=h.Gb[g];K("BAR"+g+" exists="+(m?"y":"n")+" changed to "+B(c>>>0)+" dev="+B(e>>3,2)+" ("+h.name+") ",2048);m?(l(!(m.size&m.size-1),"bar size should be power of 2"),e=d>>2,h=f[e]&1,-1===(c|3|m.size-1)?(c=~(m.size-1)|h,0===h&&(f[e]=c)):0===h&&(g=m.Uh,(c&-16)!==(g&-16)&&K("Warning: Changing memory bar not supported, ignored",2048),f[e]=g),1===h&&(l(1===h),h=f[e]&65534,g=c&65534,K("io bar changed from "+B(h>>>0,8)+" to "+B(g>>>
0,8)+" size="+m.size,2048),Cc(this,m,h,g),f[e]=c|1)):f[d>>2]=0;K("BAR effective value: "+B(f[d>>2]>>>0),2048)}else 48===d?(K("PCI write rom address dev="+B(e>>3,2)+" ("+h.name+") value="+B(c>>>0,8),2048),f[d>>2]=h.Vh?-1===(c|2047)?-h.Vh|0:h.Tj|0:0):4===d?K("PCI write dev="+B(e>>3,2)+" ("+h.name+") addr="+B(d,4)+" value="+B(c>>>0,8),2048):(K("PCI write dev="+B(e>>3,2)+" ("+h.name+") addr="+B(d,4)+" value="+B(c>>>0,8),2048),f[d>>>2]=c)});T(a.B,3325,this,function(c){Ac(this,this.Hd[0]+1|0,c)});T(a.B,
3326,this,function(c){Ac(this,this.Hd[0]+2|0,c)},function(c){Bc(this,this.Hd[0]+2|0,c)});T(a.B,3327,this,function(c){Ac(this,this.Hd[0]+3|0,c)});a.B.Ie(3324,this,function(){return this.Be[0]},function(){return this.Be[1]},function(){return this.Be[2]},function(){return this.Be[3]});a.B.Ie(3320,this,function(){return this.Ce[0]},function(){return this.Ce[1]},function(){return this.Ce[2]},function(){return this.Ce[3]});a.B.nd(3320,this,function(c){this.Wb[0]=c&252},function(c){2===(this.Wb[1]&6)&&6===
(c&6)?(K("CPU reboot via PCI"),Dc(a)):this.Wb[1]=c},function(c){this.Wb[2]=c},function(c){this.Wb[3]=c;var d=this.Wb[2]<<8|this.Wb[1],e=this.Wb[0]&252;c="query enabled="+(this.Wb[3]>>7);c+=" bdf="+B(d,4);c+=" dev="+B(d>>3&31,2);c+=" addr="+B(e,2);var f=this.sc[d];void 0!==f?(this.Wh[0]=-2147483648,this.Vg[0]=e<f.byteLength?f[e>>2]:0,c+=" "+B(this.Hd[0]>>>0,8)+" -> "+B(this.Vg[0]>>>0,8),e>=f.byteLength&&(c+=" (undef)"),c+=" ("+this.v[d].name+")",K(c,2048)):(this.Vg[0]=-1,this.Wh[0]=0)});jc(this,{Ta:0,
O:[134,128,55,18,0,0,0,0,2,0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,0,0,0,0,0,0],Gb:[],name:"82441FX PMC"});this.i={Ta:8,O:[134,128,0,112,7,0,0,2,0,0,1,6,0,0,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Gb:[],name:"82371SB PIIX3 ISA"};this.j=jc(this,this.i);this.h=new Uint8Array(this.j.buffer)}
zc.prototype.ea=function(){for(var a=[],b=0;256>b;b++)a[b]=this.sc[b];a[256]=this.Wb;a[257]=this.g;a[258]=this.Be;a[259]=this.Ce;return a};
zc.prototype.I=function(a){for(var b=0;256>b;b++){var c=this.v[b],d=a[b];if(c&&d){for(var e=0;e<c.Gb.length;e++){var f=d[4+e];if(f&1){var h=c.Gb[e];Cc(this,h,h.Uh&65534,f&65534)}}this.sc[b].set(d)}else c&&K("Warning: While restoring PCI device: Device exists in current configuration but not in snapshot ("+c.name+")"),d&&K("Warning: While restoring PCI device: Device doesn't exist in current configuration but does in snapshot (device "+B(b,2)+")")}this.Wb.set(a[256]);this.g.set(a[257]);this.Be.set(a[258]);
this.Ce.set(a[259])};function Ac(a,b,c){var d=b>>8&65535;b&=255;var e=new Uint8Array(a.sc[d].buffer);a=a.v[d];e&&(l(!(16<=b&&44>b||48<=b&&52>b),"PCI: Expected 32-bit write, got 8-bit (addr: "+B(b)+")"),K("PCI write8 dev="+B(d>>3,2)+" ("+a.name+") addr="+B(b,4)+" value="+B(c,2),2048),e[b]=c)}
function Bc(a,b,c){l(0===(b&1));var d=b>>8&65535;b&=255;var e=new Uint16Array(a.sc[d].buffer);a=a.v[d];e&&(16<=b&&44>b?K("Warning: PCI: Expected 32-bit write, got 16-bit (addr: "+B(b)+")"):(l(!(48<=b&&52>b),"PCI: Expected 32-bit write, got 16-bit (addr: "+B(b)+")"),K("PCI writ16 dev="+B(d>>3,2)+" ("+a.name+") addr="+B(b,4)+" value="+B(c,4),2048),e[b>>>1]=c))}
function jc(a,b){l(void 0!==b.Ta);l(void 0!==b.O);l(void 0!==b.Gb);var c=b.Ta;K("PCI register bdf="+B(c)+" ("+b.name+")",2048);l(!a.v[c]);l(64<=b.O.length);l(c<a.v.length);var d=new Int32Array(64);d.set(new Int32Array((new Uint8Array(b.O)).buffer));a.sc[c]=d;a.v[c]=b;c=d.slice(4,10);for(var e=0;e<b.Gb.length;e++){var f=b.Gb[e];if(f){var h=c[e],g=h&1;f.Uh=h;f.entries=[];if(0!==g)for(l(1===g),h&=-2,g=0;g<f.size;g++)f.entries[g]=a.B.ports[h+g]}}return d}
function Cc(a,b,c,d){var e=b.size;K("Move io bars: from="+B(c)+" to="+B(d)+" count="+e,2048);for(var f=a.B.ports,h=0;h<e;h++){var g=f[c+h];4096<=c+h&&(f[c+h]=yb(a.B));g.$a===a.B.ig&&g.Da===a.B.gg&&g.Pd===a.B.hg&&g.Ne===a.B.Rb&&g.Xd===a.B.Rb&&g.wa===a.B.Rb&&K("Warning: Bad IO bar: Source not mapped, port="+B(c+h,4),2048);g=b.entries[h];var m=f[d+h];l(g&&m);4096<=d+h&&(f[d+h]=g);m.$a!==a.B.ig&&m.Da!==a.B.gg&&m.Pd!==a.B.hg&&m.Ne!==a.B.Rb&&m.Xd!==a.B.Rb&&m.wa!==a.B.Rb||K("Warning: Bad IO bar: Target already mapped, port="+
B(d+h,4),2048)}}zc.prototype.Za=function(a){var b=this.sc[a];l(b);this.s.cb(this.h[96+((b[15]>>8&255)-1+((a>>3)-1&255)&3)])};function Ec(a,b){var c=a.sc[b];l(c);$b(a.s,a.h[96+((c[15]>>8&255)+(b>>3&255)-2&3)])};function Fc(a,b,c){this.B=a.B;this.s=a;this.Pb=a.v.Pb;this.h=0;this.P=new Uint8Array(10);this.R=0;this.j=null;this.g=new Uint8Array(10);this.U=this.D=this.aa=this.fa=this.G=this.o=this.l=this.i=0;this.X=1;this.J=this.C=0;this.zd=null;b?this.Nf(b):(this.fg(),nc(this.s.v.Rd,16,64));l(!c,"FDB not supported");M(this.B,1008,this,this.Uk);M(this.B,1010,this,this.Vk);M(this.B,1012,this,this.Xk);M(this.B,1013,this,this.Zk);M(this.B,1015,this,this.al);T(this.B,1010,this,this.Wk);T(this.B,1012,this,this.Yk);
T(this.B,1013,this,this.$k)}k=Fc.prototype;k.fg=function(){this.zd=null;this.Z=this.N=this.u=0;this.J=128};
k.Nf=function(a){var b={[163840]:{type:1,Zb:40,Xb:8,Sb:1},[184320]:{type:1,Zb:40,Xb:9,Sb:1},[204800]:{type:1,Zb:40,Xb:10,Sb:1},[327680]:{type:1,Zb:40,Xb:8,Sb:2},[368640]:{type:1,Zb:40,Xb:9,Sb:2},[409600]:{type:1,Zb:40,Xb:10,Sb:2},[737280]:{type:3,Zb:80,Xb:9,Sb:2},[1228800]:{type:2,Zb:80,Xb:15,Sb:2},[1474560]:{type:4,Zb:80,Xb:18,Sb:2},[1763328]:{type:5,Zb:82,Xb:21,Sb:2},[2949120]:{type:5,Zb:80,Xb:36,Sb:2},512:{type:1,Zb:1,Xb:1,Sb:1}};let c=a.byteLength,d=b[c];d||(c=1474560<a.byteLength?2949120:1474560,
d=b[c],l(a.buffer&&a.buffer instanceof ArrayBuffer),b=new Uint8Array(c),b.set(new Uint8Array(a.buffer)),a=new Lb(b.buffer),K("Warning: Unkown floppy size: "+a.byteLength+", assuming "+c));this.u=d.Xb;this.N=d.Sb;this.Z=d.Zb;this.zd=a;this.J=128;nc(this.s.v.Rd,16,d.type<<4)};
k.ea=function(){var a=[];a[0]=this.h;a[1]=this.P;a[2]=this.R;a[4]=this.g;a[5]=this.i;a[6]=this.l;a[8]=this.o;a[9]=this.G;a[10]=this.fa;a[11]=this.aa;a[12]=this.D;a[13]=this.U;a[14]=this.X;a[15]=this.C;a[16]=this.u;a[17]=this.N;a[18]=this.Z;return a};k.I=function(a){this.h=a[0];this.P=a[1];this.R=a[2];this.j=a[3];this.g=a[4];this.i=a[5];this.l=a[6];this.o=a[8];this.G=a[9];this.fa=a[10];this.aa=a[11];this.D=a[12];this.U=a[13];this.X=a[14];this.C=a[15];this.u=a[16];this.N=a[17];this.Z=a[18]};
k.Uk=function(){K("3F0 read",8192);return 0};k.Xk=function(){K("3F4 read",8192);var a=128;this.i<this.l&&(a|=80);0===(this.C&8)&&(a|=32);return a};k.al=function(){K("3F7 read",8192);return this.J};k.Zk=function(){if(this.i<this.l)return K("3F5 read: "+this.g[this.i],8192),$b(this.s,6),this.g[this.i++];K("3F5 read, empty",8192);return 255};k.Yk=function(a){K("3F4/data rate write: "+B(a),8192);a&128&&(K("dsr reset",8192),this.o=192,this.s.cb(6))};
k.$k=function(a){K("3F5 write "+B(a),8192);if(0<this.h){if(this.P[this.R++]=a,this.h--,0===this.h){a="3F5 command received: ";for(var b=0;b<this.R;b++)a+=B(this.P[b])+" ";K(a,8192);this.j.call(this,this.P)}}else{switch(a){case 3:this.j=this.Cj;this.h=2;break;case 19:this.j=this.ej;this.h=3;break;case 4:this.j=this.bj;this.h=1;break;case 5:case 69:case 197:this.j=function(c){Gc(this,!0,c)};this.h=8;break;case 6:case 70:case 198:case 230:this.j=function(c){Gc(this,!1,c)};this.h=8;break;case 7:this.j=
this.$i;this.h=1;break;case 8:K("floppy check interrupt status",8192);this.i=0;this.l=2;this.g[0]=this.o;this.g[1]=this.D;break;case 74:this.j=this.ll;this.h=1;break;case 15:this.h=2;this.j=this.oh;break;case 14:case 16:K(14===a?"dump registers":"determine controller version",8192);this.o=128;this.g[0]=this.o;this.i=0;this.l=1;this.h=0;break;default:l(!1,"Unimplemented floppy command call "+B(a))}this.R=0}};k.Vk=function(){K("read 3F2: DOR",8192);return this.C};
k.Wk=function(a){4===(a&4)&&0===(this.C&4)&&(this.o=192,this.s.cb(6));K("start motors: "+B(a>>4),8192);K("enable dma/irq: "+!!(a&8),8192);K("reset fdc: "+!!(a&4),8192);K("drive select: "+(a&3),8192);0!==(a&3)&&K("guest: fdb not implemented",8192);K("DOR = "+B(a),8192);this.C=a};k.bj=function(){K("check drive status",8192);this.G=this.zd?0:5;this.i=0;this.l=1;this.g[0]=0};
k.oh=function(a){K("seek",8192);if(0!==(a[0]&3))K("seek on fdb",8192);else{var b=a[1];a=a[0]>>2&1;b!==this.D&&(this.J=0);this.G=this.zd?0:5;this.o=32;this.D=b;this.U=a}this.Za()};k.$i=function(a){K("floppy calibrate",8192);this.oh([a[0],0])};
function Gc(a,b,c){var d=c[2],e=c[1],f=c[3],h=128<<c[4],g=c[5]-c[3]+1,m=((d+a.N*e)*a.u+f-1)*h;K("Floppy "+(b?"Write":"Read"),8192);K("from "+B(m)+" length "+B(g*h),8192);K(e+" / "+d+" / "+f,8192);c[4]||K("FDC: sector count is zero, use data length instead",8192);a.zd?(a.G=0,b?a.Pb.tf(a.zd,m,g*h,2,a.done.bind(a,c,e,d,f)):Hc(a.Pb,a.zd,m,g*h,a.done.bind(a,c,e,d,f))):a.G=5}
k.done=function(a,b,c,d,e){e?K("XXX: Unhandled floppy error",8192):(d++,d>this.u&&(d=1,c++,c>=this.N&&(c=0,b++)),b!==this.D&&(this.J=0),this.o=32,this.D=b,this.U=c,this.X=d,this.i=0,this.l=7,this.g[0]=c<<2|32,this.g[1]=0,this.g[2]=0,this.g[3]=b,this.g[4]=c,this.g[5]=d,this.g[6]=a[4],this.Za())};k.Cj=function(a){K("floppy fix drive data "+a.slice(0,this.h),8192)};k.ej=function(a){K("floppy configure "+a.slice(0,this.h),8192)};
k.ll=function(a){K("floppy read sector id "+a,8192);this.i=0;this.l=7;this.g[0]=0;this.g[1]=0;this.g[2]=0;this.g[3]=0;this.g[4]=0;this.g[5]=0;this.g[6]=0;this.Za()};k.Za=function(){this.C&8&&this.s.cb(6)};function vc(a,b,c){l(b&&0<=b.length);b.length&&(l(!a.og(c)),l(!a.og(c+b.length-1)),a.Mj(c,c+b.length),a.fb.set(b,c))};function Ic(a){this.s=a;this.o=new Uint8Array(8);this.u=new Uint8Array(8);this.g=new Uint16Array(8);this.j=new Uint16Array(8);this.h=new Uint16Array(8);this.l=new Uint16Array(8);this.Vc=new Uint8Array(8);this.C=new Uint8Array(8);this.Ig=[];this.i=0;a=a.B;T(a,0,this,this.Jd.bind(this,0));T(a,2,this,this.Jd.bind(this,1));T(a,4,this,this.Jd.bind(this,2));T(a,6,this,this.Jd.bind(this,3));T(a,1,this,this.Ld.bind(this,0));T(a,3,this,this.Ld.bind(this,1));T(a,5,this,this.Ld.bind(this,2));T(a,7,this,this.Ld.bind(this,
3));M(a,0,this,this.Id.bind(this,0));M(a,2,this,this.Id.bind(this,1));M(a,4,this,this.Id.bind(this,2));M(a,6,this,this.Id.bind(this,3));M(a,1,this,this.Kd.bind(this,0));M(a,3,this,this.Kd.bind(this,1));M(a,5,this,this.Kd.bind(this,2));M(a,7,this,this.Kd.bind(this,3));T(a,192,this,this.Jd.bind(this,4));T(a,196,this,this.Jd.bind(this,5));T(a,200,this,this.Jd.bind(this,6));T(a,204,this,this.Jd.bind(this,7));T(a,194,this,this.Ld.bind(this,4));T(a,198,this,this.Ld.bind(this,5));T(a,202,this,this.Ld.bind(this,
6));T(a,206,this,this.Ld.bind(this,7));M(a,192,this,this.Id.bind(this,4));M(a,196,this,this.Id.bind(this,5));M(a,200,this,this.Id.bind(this,6));M(a,204,this,this.Id.bind(this,7));M(a,194,this,this.Kd.bind(this,4));M(a,198,this,this.Kd.bind(this,5));M(a,202,this,this.Kd.bind(this,6));M(a,206,this,this.Kd.bind(this,7));T(a,135,this,this.Nd.bind(this,0));T(a,131,this,this.Nd.bind(this,1));T(a,129,this,this.Nd.bind(this,2));T(a,130,this,this.Nd.bind(this,3));T(a,143,this,this.Nd.bind(this,4));T(a,139,
this,this.Nd.bind(this,5));T(a,137,this,this.Nd.bind(this,6));T(a,138,this,this.Nd.bind(this,7));M(a,135,this,this.Md.bind(this,0));M(a,131,this,this.Md.bind(this,1));M(a,129,this,this.Md.bind(this,2));M(a,130,this,this.Md.bind(this,3));M(a,143,this,this.Md.bind(this,4));M(a,139,this,this.Md.bind(this,5));M(a,137,this,this.Md.bind(this,6));M(a,138,this,this.Md.bind(this,7));T(a,1159,this,this.Fe.bind(this,0));T(a,1155,this,this.Fe.bind(this,1));T(a,1153,this,this.Fe.bind(this,2));T(a,1154,this,this.Fe.bind(this,
3));T(a,1163,this,this.Fe.bind(this,5));T(a,1161,this,this.Fe.bind(this,6));T(a,1162,this,this.Fe.bind(this,7));M(a,1159,this,this.Ee.bind(this,0));M(a,1155,this,this.Ee.bind(this,1));M(a,1153,this,this.Ee.bind(this,2));M(a,1154,this,this.Ee.bind(this,3));M(a,1163,this,this.Ee.bind(this,5));M(a,1161,this,this.Ee.bind(this,6));M(a,1162,this,this.Ee.bind(this,7));T(a,10,this,this.oi.bind(this,0));T(a,212,this,this.oi.bind(this,4));T(a,15,this,this.ni.bind(this,0));T(a,222,this,this.ni.bind(this,4));
M(a,15,this,this.mi.bind(this,0));M(a,222,this,this.mi.bind(this,4));T(a,11,this,this.li.bind(this,0));T(a,214,this,this.li.bind(this,4));T(a,12,this,this.ki);T(a,216,this,this.ki)}k=Ic.prototype;k.ea=function(){return[this.o,this.u,this.g,this.j,this.h,this.l,this.Vc,this.C,this.i]};k.I=function(a){this.o=a[0];this.u=a[1];this.g=a[2];this.j=a[3];this.h=a[4];this.l=a[5];this.Vc=a[6];this.C=a[7];this.i=a[8]};
k.Ld=function(a,b){K("count write ["+a+"] = "+B(b),16);this.h[a]=Jc(this,this.h[a],b,!1);this.l[a]=Jc(this,this.l[a],b,!0)};k.Kd=function(a){K("count read ["+a+"] -> "+B(this.h[a]),16);return Kc(this,this.h[a])};k.Jd=function(a,b){K("addr write ["+a+"] = "+B(b),16);this.g[a]=Jc(this,this.g[a],b,!1);this.j[a]=Jc(this,this.j[a],b,!0)};k.Id=function(a){K("addr read ["+a+"] -> "+B(this.g[a]),16);return Kc(this,this.g[a])};k.Fe=function(a,b){K("pagehi write ["+a+"] = "+B(b),16);this.u[a]=b};
k.Ee=function(a){K("pagehi read ["+a+"]",16);return this.u[a]};k.Nd=function(a,b){K("page write ["+a+"] = "+B(b),16);this.o[a]=b};k.Md=function(a){K("page read ["+a+"]",16);return this.o[a]};k.oi=function(a,b){a=(b&3)+a;b=b&4?1:0;K("singlechannel mask write ["+a+"] = "+b,16);Lc(this,a,b)};k.ni=function(a,b){K("multichannel mask write: "+B(b),16);for(var c=0;4>c;c++)Lc(this,a+c,b&1<<c)};
k.mi=function(a){var b=0|this.Vc[a+0];b|=this.Vc[a+1]<<1;b|=this.Vc[a+2]<<2;b|=this.Vc[a+3]<<3;K("multichannel mask read: "+B(b),16);return b};k.li=function(a,b){a=(b&3)+a;K("mode write ["+a+"] = "+B(b),16);this.C[a]=b};k.ki=function(){K("flipflop reset",16);this.i=0};function Lc(a,b,c){if(a.Vc[b]!==c&&(a.Vc[b]=c,!c))for(K("firing on_unmask("+b+")",16),c=0;c<a.Ig.length;c++)a.Ig[c].mg.call(a.Ig[c].hh,b)}
function Hc(a,b,c,d,e){var f=a.h[2]+1,h=Mc(a,2);K("DMA write channel 2",16);K("to "+B(h)+" len "+B(f),16);d<f&&K("DMA should read more than provided: "+B(d)+" "+B(f),16);if(c+f>b.byteLength)K("DMA read outside of buffer",16),e(!0);else{var g=a.s;a.g[2]+=f;b.get(c,f,function(m){vc(g,m,h);e(!1)})}}
k.tf=function(a,b,c,d,e){var f=this.h[d]+1&65535,h=5<=d?2:1,g=f*h,m=Mc(this,d),n=!1,p=!1,t=this.C[d]&16;K("DMA write channel "+d,16);K("to "+B(m)+" len "+B(g),16);c<g?(K("DMA should read more than provided",16),f=Math.floor(c/h),g=f*h,n=!0):c>g&&(K("DMA attempted to read more than provided",16),p=!0);b+g>a.byteLength?(K("DMA write outside of buffer",16),e(!0)):(this.g[d]+=f,this.h[d]-=f,!n&&t&&(K("DMA autoinit",16),this.g[d]=this.j[d],this.h[d]=this.l[d]),a.set(b,this.s.fb.subarray(m,m+g),()=>{p&&
t?(K("DMA continuing from start",16),this.tf(a,b+g,c-g,d,e)):e(!1)}))};function Mc(a,b){var c=a.g[b];5<=b&&(c<<=1);c=c&65535|a.o[b]<<16;return c|=a.u[b]<<24}function Jc(a,b,c,d){d||(a.i^=1);return a.i?b&-256|c:b&-65281|c<<8}function Kc(a,b){a.i^=1;return a.i?b&255:b>>8&255};function Nc(a,b){this.s=a;this.A=b;this.j=new Float64Array(3);this.h=new Uint16Array(3);this.g=new Uint8Array(4);this.i=new Uint8Array(4);this.pe=new Uint8Array(4);this.u=new Uint8Array(4);this.l=new Uint8Array(4);this.o=new Uint16Array(3);this.tb=new Uint16Array(3);M(a.B,97,this,function(){var c=Jb(),d=66.66666666666667*c&1;c=Oc(this,2,c);return d<<4|c<<5});T(a.B,97,this,function(c){c&1?this.A.send("pcspeaker-enable"):this.A.send("pcspeaker-disable")});M(a.B,64,this,function(){return Pc(this,0)});
M(a.B,65,this,function(){return Pc(this,1)});M(a.B,66,this,function(){return Pc(this,2)});T(a.B,64,this,function(c){Qc(this,0,c)});T(a.B,65,this,function(c){Qc(this,1,c)});T(a.B,66,this,function(c){Qc(this,2,c);this.A.send("pcspeaker-update",[this.pe[2],this.tb[2]])});T(a.B,67,this,this.C)}Nc.prototype.ea=function(){var a=[];a[0]=this.g;a[1]=this.i;a[2]=this.pe;a[3]=this.u;a[4]=this.l;a[5]=this.o;a[6]=this.tb;a[7]=this.j;a[8]=this.h;return a};
Nc.prototype.I=function(a){this.g=a[0];this.i=a[1];this.pe=a[2];this.u=a[3];this.l=a[4];this.o=a[5];this.tb=a[6];this.j=a[7];this.h=a[8]};Nc.prototype.Sc=function(a,b){var c=100;b||(this.i[0]&&Oc(this,0,a)?(this.h[0]=Rc(this,0,a),this.j[0]=a,K("pit interrupt. new value: "+this.h[0],512),$b(this.s,0),this.s.cb(0),0===this.pe[0]&&(this.i[0]=0)):$b(this.s,0),this.i[0]&&(c=(this.h[0]-Math.floor(1193.1816666*(a-this.j[0])))/1193.1816666));return c};
function Rc(a,b,c){if(!a.i[b])return 0;var d=c-a.j[b],e=Math.floor(1193.1816666*d);c=a.h[b]-e;K("diff="+d+" dticks="+e+" value="+c+" reload="+a.tb[b],512);a=a.tb[b];c>=a?(K("Warning: Counter"+b+" value "+c+" is larger than reload "+a,512),c%=a):0>c&&(c=c%a+a);return c}function Oc(a,b,c){c-=a.j[b];return 0>c?(K("Warning: PIT timer difference is negative, resetting (timer "+b+")"),!0):a.h[b]<Math.floor(1193.1816666*c)}
function Pc(a,b){var c=a.l[b];if(c)return a.l[b]--,2===c?a.o[b]&255:a.o[b]>>8;c=a.g[b];3===a.pe[b]&&(a.g[b]^=1);a=Rc(a,b,Jb());return c?a&255:a>>8}function Qc(a,b,c){a.tb[b]=a.g[b]?a.tb[b]&-256|c:a.tb[b]&255|c<<8;3===a.u[b]&&a.g[b]||(a.tb[b]||(a.tb[b]=65535),a.h[b]=a.tb[b],a.i[b]=!0,a.j[b]=Jb(),K("counter"+b+" reload="+B(a.tb[b])+" tick="+(a.tb[b]||65536)/1193.1816666+"ms",512));3===a.u[b]&&(a.g[b]^=1)}
Nc.prototype.C=function(a){var b=a>>1&7,c=a&1,d=a>>6&3;a=a>>4&3;1===d&&K("Unimplemented timer1",512);3===d?K("Unimplemented read back",512):0===a?(this.l[d]=2,b=Rc(this,d,Jb()),K("latch: "+b,512),this.o[d]=b?b-1:0):(6<=b&&(b&=-5),K("Control: mode="+b+" ctr="+d+" read_mode="+a+" bcd="+c,512),this.g[d]=1===a?0:1,0===d&&$b(this.s,0),0!==b&&3!==b&&2!==b&&K("Unimplemented counter mode: "+B(b),512),this.pe[d]=b,this.u[d]=a,2===d&&this.A.send("pcspeaker-update",[this.pe[2],this.tb[2]]))};const Sc=Uint32Array.from([655360,655360,720896,753664]),Tc=Uint32Array.from([131072,65536,32768,32768]);
function Uc(a,b,c,d){this.s=a;this.A=b;this.screen=c;this.la=d;this.X=0;this.fd=14;this.ae=15;this.zb=80;this.od=25;this.ke=this.C=this.Yd=this.Jb=0;this.md=[];this.je=this.g=0;this.bd=new Uint8Array(25);this.R=this.qa=this.ie=this.Kb=this.J=this.P=this.jd=this.ld=this.D=0;this.h=!1;this.aa=new Int32Array(256);this.N=0;this.Uf=45253;this.G=this.i=0;this.o=!1;this.l=32;this.td=this.$d=this.fc=this.Lc=0;void 0===this.la||262144>this.la?this.la=262144:268435456<this.la?this.la=268435456:this.la=gb(this.la);
K("effective vga memory size: "+this.la,256);this.O=[52,18,17,17,3,1,0,0,0,0,0,3,0,0,0,0,8,14680064,57344,224,0,0,0,0,0,0,191,254,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,244,26,0,17,0,0,190,254,0,0,0,0,0,0,0,0,0,0,0,0];this.Ta=144;this.Gb=[{size:this.la}];this.Vh=65536;this.Tj=4272947200;this.name="vga";this.Cc=this.gd=this.zc=this.Z=0;this.mb=255;this.bb=new Uint8Array(16);this.j=-1;this.rd=32;this.cc=this.Fc=this.yc=this.u=0;this.ec=-1;this.Bb=15;this.ac=this.Zd=0;this.dc=-1;this.Kc=this.Ab=this.he=this.lb=
0;this.fe=255;this.fa=this.$b=this.bc=this.Jc=this.ge=this.Td=0;this.U=this.Oe=255;this.Ec=!1;b=a.B;T(b,960,this,this.Bk);M(b,960,this,this.di,this.Ak);M(b,961,this,this.ei);T(b,962,this,this.Ck);b.nd(964,this,this.Ek,this.Gk);M(b,964,this,this.Dk);M(b,965,this,this.Fk);b.nd(974,this,this.Rk,this.Tk);M(b,974,this,this.Qk);M(b,975,this,this.Sk);M(b,966,this,this.Hk);T(b,966,this,this.Ik);T(b,967,this,this.Kk);M(b,967,this,this.Jk);T(b,968,this,this.Mk);M(b,968,this,this.Lk);T(b,969,this,this.Ok);M(b,
969,this,this.Nk);M(b,972,this,this.Pk);T(b,980,this,this.Wg,this.gi);T(b,981,this,this.xg,this.ii);M(b,980,this,this.fi);M(b,981,this,this.Xg,this.hi);T(b,948,this,this.Wg,this.gi);T(b,949,this,this.xg,this.ii);M(b,948,this,this.fi);M(b,949,this,this.Xg,this.hi);M(b,970,this,function(){K("3CA read",256);return 0});M(b,986,this,this.ji);M(b,954,this,this.ji);this.yb=-1;this.xb=0;T(b,462,this,void 0,this.Vj);T(b,463,this,void 0,this.Xj);M(b,463,this,void 0,this.Wj);c=a.Qi(this.la)>>>0;this.Se=W(Uint8Array,
a.Ma,c,this.la);this.ce=this.la;this.be=0;this.ee=this.la;this.de=0;this.Hc=null;this.Qa=new Uint8Array(262144);this.Pe=new Uint8Array(this.Qa.buffer,0,65536);this.Qe=new Uint8Array(this.Qa.buffer,65536,65536);this.Wd=new Uint8Array(this.Qa.buffer,131072,65536);this.Re=new Uint8Array(this.Qa.buffer,196608,65536);this.sd=new Uint8Array(524288);zb(b,655360,131072,e=>Vc(this,e),(e,f)=>{if(this.o)this.s.Ne((e-655360|this.Lc)+3758096384|0,f);else{var h=this.Jc>>2&3;e-=Sc[h];if(0>e||e>=Tc[h])K("vga write outside memory space: addr:"+
B(e)+", value:"+B(f),256);else if(this.h){var g=f;f=Wc(this.fe);var m=Xc(this.Td);h=Xc(this.ge);switch(this.Ab&3){case 0:g=(g|g<<8)>>>(this.Kc&7)&255;var n=Wc(g);g=Xc(this.Td);n=Yc(this,(n|h&g)&(~h|g),this.N);n=f&n|~f&this.N;break;case 1:n=this.N;break;case 2:n=Xc(g);n=Yc(this,n,this.N);n=f&n|~f&this.N;break;case 3:g=(g|g<<8)>>>(this.Kc&7)&255,f&=Wc(g),n=f&m|~f&this.N}f=15;switch(this.Zd&12){case 0:f=5<<(e&1);e&=-2;break;case 8:case 12:f=1<<(e&3),e&=-4}f&=this.Bb;f&1&&(this.Pe[e]=n>>0&255);f&2&&(this.Qe[e]=
n>>8&255);f&4&&(this.Wd[e]=n>>16&255);f&8&&(this.Re[e]=n>>24&255);n=Zc(this,e);f=n+7;n<this.ee&&(this.ee=n);f>this.de&&(this.de=f);n<this.ce&&(this.ce=n);f>this.be&&(this.be=f)}else if(this.Bb&3){if(h=e,this.Qa[h]=f,e=Math.max(this.zb,2*this.qa),h>>1>=this.g?(g=(h>>1)-this.g,n=g/e|0,e=g%e):(g=h>>1,n=(g/e|0)+$c(this,this.R),e=g%e),l(0<=n&&0<=e),!(e>=this.zb||n>=this.od)){h&1?(g=f,f=this.Qa[h&-2]):g=this.Qa[h|1];var p=this.u&8;h=(p&&g&128?this.screen.o:0)|(!this.Ec||g&8?0:this.screen.u);m=this.Ec?7:
15;p=p?7:15;this.A.send("screen-put-char",[n,e,f]);this.screen.j(n,e,f,h,this.aa[this.mb&this.bb[g>>4&p]],this.aa[this.mb&this.bb[g&m]])}}else this.Bb&4&&(this.Wd[e]=f)}});jc(a.v.kb,this)}k=Uc.prototype;
k.ea=function(){var a=[];a[0]=this.la;a[1]=this.X;a[2]=this.fd;a[3]=this.ae;a[4]=this.zb;a[5]=this.od;a[6]=this.Qa;a[7]=this.Cc;a[8]=this.g;a[9]=this.h;a[10]=this.aa;a[11]=this.N;a[12]=this.bc;a[13]=this.$b;a[14]=this.Jc;a[15]=this.i;a[16]=this.G;a[17]=this.D;a[18]=this.o;a[19]=this.l;a[20]=this.Lc;a[21]=this.fc;a[22]=this.Z;a[23]=this.zc;a[24]=this.gd;a[25]=this.bb;a[26]=this.ec;a[27]=this.Bb;a[28]=this.Zd;a[29]=this.dc;a[30]=this.he;a[31]=this.Ab;a[32]=this.Kc;a[33]=this.fe;a[34]=this.fa;a[35]=
this.Oe;a[36]=this.U;a[37]=this.yb;a[38]=this.xb;a[39]=this.Se;a[41]=this.j;a[42]=this.qa;a[43]=this.Td;a[44]=this.ge;a[45]=this.je;a[46]=this.bd;a[47]=this.ld;a[48]=this.jd;a[49]=this.P;a[50]=this.J;a[51]=this.Kb;a[52]=this.ie;a[53]=this.qa;a[54]=this.rd;a[55]=this.u;a[56]=this.yc;a[57]=this.Fc;a[58]=this.cc;a[59]=this.ac;a[60]=this.R;a[61]=this.sd;a[62]=this.mb;a[63]=this.lb;a[64]=this.Ec;return a};
k.I=function(a){this.la=a[0];this.X=a[1];this.fd=a[2];this.ae=a[3];this.zb=a[4];this.od=a[5];a[6]&&this.Qa.set(a[6]);this.Cc=a[7];this.g=a[8];this.h=a[9];this.aa=a[10];this.N=a[11];this.bc=a[12];this.$b=a[13];this.Jc=a[14];this.i=a[15];this.G=a[16];this.D=a[17];this.o=a[18];this.l=a[19];this.Lc=a[20];this.fc=a[21];this.Z=a[22];this.zc=a[23];this.gd=a[24];this.bb=a[25];this.ec=a[26];this.Bb=a[27];this.Zd=a[28];this.dc=a[29];this.he=a[30];this.Ab=a[31];this.Kc=a[32];this.fe=a[33];this.fa=a[34];this.Oe=
a[35];this.U=a[36];this.yb=a[37];this.xb=a[38];this.Se.set(a[39]);this.j=a[41];this.qa=a[42];this.Td=a[43];this.ge=a[44];this.je=a[45];this.bd.set(a[46]);this.ld=a[47];this.jd=a[48];this.P=a[49];this.J=a[50];this.Kb=a[51];this.ie=a[52];this.qa=a[53];this.rd=a[54];this.u=a[55];this.yc=a[56];this.Fc=a[57];this.cc=a[58];this.ac=a[59];this.R=a[60];a[61]&&this.sd.set(a[61]);this.mb=void 0===a[62]?255:a[62];this.lb=void 0===a[63]?0:a[63];this.Ec=void 0===a[64]?0:a[64];this.screen.g(this.h);this.h?(this.Yd=
this.Jb=0,this.o?(ad(this,this.i,this.G,this.i,this.G,this.l),bd(this)):(cd(this),bd(this),dd(this))):(ed(this,!0),fd(this,this.zb,this.od),gd(this),hd(this),id(this));jd(this)};
function Vc(a,b){if(a.o)return a.s.$a((b-655360|a.Lc)+3758096384|0);var c=a.Jc>>2&3;b-=Sc[c];if(0>b||b>=Tc[c])return K("vga read outside memory space: addr:"+B(b),256),0;a.N=a.Pe[b];a.N|=a.Qe[b]<<8;a.N|=a.Wd[b]<<16;a.N|=a.Re[b]<<24;if(a.Ab&8)return c=255,a.$b&1&&(c&=a.Pe[b]^~(a.bc&1?255:0)),a.$b&2&&(c&=a.Qe[b]^~(a.bc&2?255:0)),a.$b&4&&(c&=a.Wd[b]^~(a.bc&4?255:0)),a.$b&8&&(c&=a.Re[b]^~(a.bc&8?255:0)),c;c=a.he;a.h?a.Zd&8?(c=b&3,b&=-4):a.Ab&16&&(c=b&1,b&=-2):c&=3;return a.Qa[c<<16|b]}
function Wc(a){return a|a<<8|a<<16|a<<24}function Xc(a){return(a&1?255:0)|(a&2?255:0)<<8|(a&4?255:0)<<16|(a&8?255:0)<<24}function Yc(a,b,c){switch(a.Kc&24){case 8:return b&c;case 16:return b|c;case 24:return b^c}return b}
function kd(a){const b=$c(a,a.R),c=Math.max(0,2*(2*a.qa-a.zb)),d=a.u&8,e=a.Ec?7:15,f=d?7:15,h=a.screen.o,g=a.screen.u;let m=a.g<<1;for(let n=0;n<a.od;n++){n===b&&(m=0);for(let p=0;p<a.zb;p++){const t=a.Qa[m],x=a.Qa[m|1],y=(d&&x&128?h:0)|(!a.Ec||x&8?0:g);a.A.send("screen-put-char",[n,p,t]);a.screen.j(n,p,t,y,a.aa[a.mb&a.bb[x>>4&f]],a.aa[a.mb&a.bb[x&e]]);m+=2}m+=c}}
function id(a){var b=Math.max(a.zb,2*a.qa);let c;a.X>=a.g?(c=(a.X-a.g)/b|0,b=(a.X-a.g)%b):(c=(a.X/b|0)+$c(a,a.R),b=a.X%b);l(0<=c&&0<=b);a.screen.G(c,b)}function jd(a){K("complete redraw",256);a.h?a.o?a.s.jd():(a.ce=0,a.be=524288):kd(a)}function dd(a){K("complete replot",256);a.h&&!a.o&&(a.ee=0,a.de=524288,jd(a))}k.Aa=function(){};function ld(a){var b=128+(~a.Kb&a.D&64);b-=a.Kb&64;b-=a.u&64;return b>>>6}
function Zc(a,b){var c=ld(a);if(~a.D&3){var d=b-a.g;d&=a.D<<13|-24577;d<<=c;var e=d/a.C|0;d%=a.C;switch(a.D&3){case 2:e=e<<1|b>>13&1;break;case 1:e=e<<1|b>>14&1;break;case 0:e=e<<2|b>>13&3}return e*a.C+d+(a.g<<c)}return b<<c}function $c(a,b){a.fa&128&&(b>>>=1);b=Math.ceil(b/(1+(a.fa&31)));a.D&1||(b<<=1);a.D&2||(b<<=1);return b}function fd(a,b,c){l(!a.h);a.zb=b;a.od=c;a.screen.i(b,c);a.A.send("screen-set-size",[b,c,0])}
function ad(a,b,c,d,e,f){l(a.h);d=Math.max(d,1);e=Math.max(e,1);if(a.Jb!==b||a.Yd!==c||a.C!==d||a.ke!==e){a.Jb=b;a.Yd=c;a.C=d;a.ke=e;if("undefined"!==typeof ImageData){const h=d*e,g=a.s.Pi(h)>>>0;a.nf=g;a.Hc=new ImageData(new Uint8ClampedArray(a.s.Ma.buffer,g,4*h),d,e);a.s.jd()}a.screen.h(b,c);a.A.send("screen-set-size",[b,c,f])}}
function cd(a){if(!a.o){var b=Math.min(1+a.ld,a.jd),c=Math.min(1+a.P,a.J);if(b&&c)if(a.h){b<<=3;var d=a.qa<<4;a.u&64&&(b>>>=1,d>>>=1);c=$c(a,c);var e=Tc[0];var f=a.qa<<2;a.Kb&64?f<<=1:a.D&64&&(f>>>=1);ad(a,b,c,d,f?Math.ceil(e/f):c,8);md(a);bd(a)}else a.fa&128&&(c>>>=1),d=c/(1+(a.fa&31))|0,b&&d&&fd(a,b,d)}}
function bd(a){a.h||kd(a);if(a.o)a.md=[];else if(a.C&&a.Jb)if(!a.rd||a.ac&32)a.md=[],a.screen.N();else{var b=a.je,c=a.Fc;a.u&64&&(c>>>=1);var d=a.ie>>5&3,e=Zc(a,b+d);b=e/a.C|0;var f=e%a.C+c;e=$c(a,1+a.R);e=Math.min(e,a.Yd);var h=a.Yd-e;a.md=[];f=-f;for(var g=0;f<a.Jb;f+=a.C,g++)a.md.push({Hc:a.Hc,dh:f,eh:0,Yf:0,Zf:b+g,Lg:a.C,Kg:e});b=0;a.u&32||(b=Zc(a,d)+c);f=-b;for(g=0;f<a.Jb;f+=a.C,g++)a.md.push({Hc:a.Hc,dh:f,eh:e,Yf:0,Zf:g,Lg:a.C,Kg:h})}}function md(a){a.U|=8;a.je!==a.g&&(a.je=a.g,bd(a))}
function hd(a){var b=a.fa&31;const c=Math.min(b,a.fd&31);b=Math.min(b,a.ae&31);a.screen.J(c,b,!(a.fd&32)&&c<b)}
k.Bk=function(a){if(-1===this.j)K("attribute controller index register: "+B(a),256),this.j=a&31,K("attribute actual index: "+B(this.j),256),this.rd!==(a&32)&&(this.rd=a&32,bd(this));else{if(16>this.j)K("internal palette: "+B(this.j)+" -> "+B(a),256),this.bb[this.j]=a,this.u&64||jd(this);else switch(this.j){case 16:K("3C0 / attribute mode control: "+B(a),256);if(this.u!==a){var b=this.u;this.u=a;const c=0!==(a&1);this.o||this.h===c||(this.h=c,this.screen.g(this.h));(b^a)&64&&dd(this);cd(this);jd(this);
ed(this,!1)}break;case 18:K("3C0 / color plane enable: "+B(a),256);this.yc!==a&&(this.yc=a,jd(this));break;case 19:K("3C0 / horizontal panning: "+B(a),256);this.Fc!==a&&(this.Fc=a&15,bd(this));break;case 20:K("3C0 / color select: "+B(a),256);this.cc!==a&&(this.cc=a,jd(this));break;default:K("3C0 / attribute controller write "+B(this.j)+": "+B(a),256)}this.j=-1}};k.di=function(){K("3C0 read",256);return(this.j|this.rd)&255};k.Ak=function(){K("3C0 read16",256);return this.di()|this.ei()<<8&65280};
k.ei=function(){if(16>this.j)return K("3C1 / internal palette read: "+B(this.j)+" -> "+B(this.bb[this.j]),256),this.bb[this.j]&255;switch(this.j){case 16:return K("3C1 / attribute mode read: "+B(this.u),256),this.u;case 18:return K("3C1 / color plane enable read: "+B(this.yc),256),this.yc;case 19:return K("3C1 / horizontal panning read: "+B(this.Fc),256),this.Fc;case 20:return K("3C1 / color select read: "+B(this.cc),256),this.cc;default:K("3C1 / attribute controller read "+B(this.j),256)}return 255};
k.Ck=function(a){K("3C2 / miscellaneous output register = "+B(a),256);this.Oe=a};k.Ek=function(a){this.ec=a};k.Dk=function(){return this.ec};
k.Gk=function(a){switch(this.ec){case 1:K("clocking mode: "+B(a),256);var b=this.ac;this.ac=a;(b^a)&32&&bd(this);ed(this,!1);break;case 2:K("plane write mask: "+B(a),256);b=this.Bb;this.Bb=a;this.h||!(b&4)||this.Bb&4||ed(this,!0);break;case 3:K("character map select: "+B(a),256);b=this.lb;this.lb=a;this.h||b===a||gd(this);break;case 4:K("sequencer memory mode: "+B(a),256);this.Zd=a;break;default:K("3C5 / sequencer write "+B(this.ec)+": "+B(a),256)}};
k.Fk=function(){K("3C5 / sequencer read "+B(this.ec),256);switch(this.ec){case 1:return this.ac;case 2:return this.Bb;case 3:return this.lb;case 4:return this.Zd;case 6:return 18}return 0};k.Ik=function(a){this.mb!==a&&(this.mb=a,jd(this))};k.Hk=function(){return this.mb};k.Kk=function(a){K("3C7 write: "+B(a),256);this.gd=3*a;this.Cc&=0};k.Jk=function(){return this.Cc};k.Mk=function(a){this.zc=3*a;this.Cc|=3};k.Lk=function(){return this.zc/3&255};
k.Ok=function(a){var b=this.zc/3|0,c=this.zc%3,d=this.aa[b];if(0===(this.xb&32)){a&=63;const e=a&1;a=a<<2|e<<1|e}0===c?d=d&-16711681|a<<16:1===c?d=d&-65281|a<<8:(d=d&-256|a,K("dac set color, index="+B(b)+" value="+B(d),256));this.aa[b]!==d&&(this.aa[b]=d,jd(this));this.zc++};k.Nk=function(){K("3C9 read",256);var a=this.aa[this.gd/3|0]>>8*(2-this.gd%3)&255;this.gd++;return this.xb&32?a:a>>2};k.Pk=function(){K("3CC read",256);return this.Oe};k.Rk=function(a){this.dc=a};k.Qk=function(){return this.dc};
k.Tk=function(a){switch(this.dc){case 0:this.Td=a;K("plane set/reset: "+B(a),256);break;case 1:this.ge=a;K("plane set/reset enable: "+B(a),256);break;case 2:this.bc=a;K("color compare: "+B(a),256);break;case 3:this.Kc=a;K("plane rotate: "+B(a),256);break;case 4:this.he=a;K("plane read: "+B(a),256);break;case 5:var b=this.Ab;this.Ab=a;K("planar mode: "+B(a),256);(b^a)&96&&dd(this);break;case 6:K("miscellaneous graphics register: "+B(a),256);this.Jc!==a&&(this.Jc=a,cd(this));break;case 7:this.$b=a;
K("color don't care: "+B(a),256);break;case 8:this.fe=a;K("planar bitmap: "+B(a),256);break;default:K("3CF / graphics write "+B(this.dc)+": "+B(a),256)}};k.Sk=function(){K("3CF / graphics read "+B(this.dc),256);switch(this.dc){case 0:return this.Td;case 1:return this.ge;case 2:return this.bc;case 3:return this.Kc;case 4:return this.he;case 5:return this.Ab;case 6:return this.Jc;case 7:return this.$b;case 8:return this.fe}return 0};k.Wg=function(a){K("3D4 / crtc index: "+a,256);this.Z=a};
k.gi=function(a){this.Wg(a&255);this.xg(a>>8&255)};k.fi=function(){K("3D4 read / crtc index: "+this.Z,256);return this.Z};
k.xg=function(a){switch(this.Z){case 1:K("3D5 / hdisp enable end write: "+B(a),256);this.ld!==a&&(this.ld=a,cd(this));break;case 2:this.jd!==a&&(this.jd=a,cd(this));break;case 7:K("3D5 / overflow register write: "+B(a),256);var b=this.P;this.P&=255;this.P=this.P|a<<3&512|a<<7&256;b!==this.P&&cd(this);this.R=this.R&767|a<<4&256;b=this.J;this.J=this.J&767|a<<5&256;b!==this.J&&cd(this);bd(this);break;case 8:K("3D5 / preset row scan write: "+B(a),256);this.ie=a;bd(this);break;case 9:K("3D5 / max scan line write: "+
B(a),256);var c=this.fa;this.fa=a;this.R=this.R&511|a<<3&512;b=this.J;this.J=this.J&511|a<<4&512;((c^this.fa)&159||b!==this.J)&&cd(this);hd(this);bd(this);ed(this,!1);break;case 10:K("3D5 / cursor scanline start write: "+B(a),256);this.fd=a;hd(this);break;case 11:K("3D5 / cursor scanline end write: "+B(a),256);this.ae=a;hd(this);break;case 12:(this.g>>8&255)!==a&&(this.g=this.g&255|a<<8,bd(this),~this.D&3&&dd(this));K("3D5 / start addr hi write: "+B(a)+" -> "+B(this.g,4),256);break;case 13:(this.g&
255)!==a&&(this.g=this.g&65280|a,bd(this),~this.D&3&&dd(this));K("3D5 / start addr lo write: "+B(a)+" -> "+B(this.g,4),256);break;case 14:K("3D5 / cursor address hi write: "+B(a),256);this.X=this.X&255|a<<8;id(this);break;case 15:K("3D5 / cursor address lo write: "+B(a),256);this.X=this.X&65280|a;id(this);break;case 18:K("3D5 / vdisp enable end write: "+B(a),256);(this.P&255)!==a&&(this.P=this.P&768|a,cd(this));break;case 19:K("3D5 / offset register write: "+B(a),256);this.qa!==a&&(this.qa=a,cd(this),
~this.D&3&&dd(this));break;case 20:K("3D5 / underline location write: "+B(a),256);this.Kb!==a&&(b=this.Kb,this.Kb=a,cd(this),(b^a)&64&&dd(this));break;case 21:K("3D5 / vertical blank start write: "+B(a),256);(this.J&255)!==a&&(this.J=this.J&768|a,cd(this));break;case 23:K("3D5 / crtc mode write: "+B(a),256);this.D!==a&&(b=this.D,this.D=a,cd(this),(b^a)&67&&dd(this));break;case 24:K("3D5 / line compare write: "+B(a),256);this.R=this.R&768|a;bd(this);break;default:this.Z<this.bd.length&&(this.bd[this.Z]=
a),K("3D5 / CRTC write "+B(this.Z)+": "+B(a),256)}};k.ii=function(a){K("16-bit write to 3D5: "+B(a,4),256);this.xg(a&255)};
k.Xg=function(){K("3D5 read "+B(this.Z),256);switch(this.Z){case 1:return this.ld;case 2:return this.jd;case 7:return this.P>>7&2|this.J>>5&8|this.R>>4&16|this.P>>3&64;case 8:return this.ie;case 9:return this.fa;case 10:return this.fd;case 11:return this.ae;case 12:return this.g&255;case 13:return this.g>>8;case 14:return this.X>>8;case 15:return this.X&255;case 18:return this.P&255;case 19:return this.qa;case 20:return this.Kb;case 21:return this.J&255;case 23:return this.D;case 24:return this.R&
255}return this.Z<this.bd.length?this.bd[this.Z]:0};k.hi=function(){K("Warning: 16-bit read from 3D5",256);return this.Xg()};k.ji=function(){K("3DA read - status 1 and clear attr index",256);var a=this.U;this.h?(this.U^=1,this.U&=1):(this.U&1&&(this.U^=8),this.U^=1);this.j=-1;return a};k.Vj=function(a){this.yb=a};
k.Xj=function(a){K("1CF / dispi write "+B(this.yb)+": "+B(a),256);const b=this.o;switch(this.yb){case 0:45248<=a&&45253>=a?this.Uf=a:K("Invalid version value: "+B(a),256);break;case 1:this.i=a;2560<this.i&&(K("svga_width reduced from "+this.i+" to 2560",256),this.i=2560);break;case 2:this.G=a;1600<this.G&&(K("svga_height reduced from "+this.G+" to 1600",256),this.G=1600);break;case 3:this.l=a;break;case 4:(this.o=1===(a&1))&&0===(a&128)&&this.Se.fill(0);this.xb=a;break;case 5:K("SVGA bank offset: "+
B(a<<16),256);this.Lc=a<<16;break;case 8:K("SVGA X offset: "+B(a),256);this.$d!==a&&(this.$d=a,this.fc=this.td*this.i+this.$d,jd(this));break;case 9:K("SVGA Y offset: "+B(a*this.i)+" y="+B(a),256);this.td!==a&&(this.td=a,this.fc=this.td*this.i+this.$d,jd(this));break;default:K("Unimplemented dispi write index: "+B(this.yb),256)}!this.o||this.i&&this.G||(K("SVGA: disabled because of invalid width/height: "+this.i+"x"+this.G,256),this.o=!1);l(4!==this.l,"unimplemented svga bpp: 4");l(4===this.l||8===
this.l||15===this.l||16===this.l||24===this.l||32===this.l,"unexpected svga bpp: "+this.l);this.o?K("SVGA: enabled, "+this.i+"x"+this.G+"x"+this.l,256):K("SVGA: disabled");this.o&&!b&&(this.td=this.$d=this.fc=0,this.h=!0,this.screen.g(this.h),ad(this,this.i,this.G,this.i,this.G,this.l));this.o||(this.Lc=0);bd(this)};k.Wj=function(){K("1CF / dispi read "+B(this.yb),256);return nd(this,this.yb)};
function nd(a,b){switch(b){case 0:return a.Uf;case 1:return a.xb&2?2560:a.i;case 2:return a.xb&2?1600:a.G;case 3:return a.xb&2?32:a.l;case 4:return a.xb;case 5:return a.Lc>>>16;case 6:return a.Jb?a.Jb:1;case 8:return a.$d;case 9:return a.td;case 10:return a.la/65536|0;default:K("Unimplemented dispi read index: "+B(a.yb),256)}return 255}
k.bh=function(){if(this.h){if(0===this.Hc.data.byteLength){var a=new Uint8ClampedArray(this.s.Ma.buffer,this.nf,4*this.C*this.ke);this.Hc=new ImageData(a,this.C,this.ke);bd(this)}if(this.o){a=0;var b=this.G;if(8===this.l)for(var c=new Int32Array(this.s.Ma.buffer,this.nf,this.Jb*this.Yd),d=new Uint8Array(this.s.Ma.buffer,this.Se.byteOffset,this.la),e=0;e<c.length;e++){var f=this.aa[d[e]];c[e]=f&65280|f<<16|f>>16|4278190080}else this.s.Xi(this.l,this.fc),e=15===this.l?2:this.l/8,a=((this.s.Ri[0]/e|
0)-this.fc)/this.i|0,b=(((this.s.Ji[0]/e|0)-this.fc)/this.i|0)+1;a<b&&(a=Math.max(a,0),b=Math.min(b,this.G),this.screen.l([{Hc:this.Hc,dh:0,eh:a,Yf:0,Zf:a,Lg:this.i,Kg:b-a}]))}else{a=Math.min(this.de|15,524287);e=ld(this);f=~this.D&3;b=this.Ab&96;c=this.u&64;for(d=this.ee&-16;d<=a;){var h=d>>>e;if(f){var g=d/this.C|0,m=d-this.C*g;switch(f){case 1:h=(g&1)<<13;g>>>=1;break;case 2:h=(g&1)<<14;g>>>=1;break;case 3:h=(g&3)<<13,g>>>=2}h|=(g*this.C+m>>>e)+this.g}g=this.Pe[h];m=this.Qe[h];var n=this.Wd[h],
p=this.Re[h];h=new Uint8Array(8);switch(b){case 0:g<<=0;m<<=1;n<<=2;p<<=3;for(var t=7;0<=t;t--)h[7-t]=g>>t&1|m>>t&2|n>>t&4|p>>t&8;break;case 32:h[0]=g>>6&3|n>>4&12;h[1]=g>>4&3|n>>2&12;h[2]=g>>2&3|n>>0&12;h[3]=g>>0&3|n<<2&12;h[4]=m>>6&3|p>>4&12;h[5]=m>>4&3|p>>2&12;h[6]=m>>2&3|p>>0&12;h[7]=m>>0&3|p<<2&12;break;case 64:case 96:h[0]=g>>4&15,h[1]=g>>0&15,h[2]=m>>4&15,h[3]=m>>0&15,h[4]=n>>4&15,h[5]=n>>0&15,h[6]=p>>4&15,h[7]=p>>0&15}if(c)for(g=t=0;4>t;t++,d++,g+=2)this.sd[d]=h[g]<<4|h[g+1];else for(t=0;8>
t;t++,d++)this.sd[d]=h[t]}c=this.ce;a=Math.min(this.be,524287);b=new Int32Array(this.s.Ma.buffer,this.nf,this.C*this.ke);e=255;f=0;this.u&128&&(e&=207,f|=this.cc<<4&48);if(this.u&64)for(;c<=a;c++)d=this.sd[c]&e|f,d=this.aa[d],b[c]=d&65280|d<<16|d>>16|4278190080;else for(e&=63,f|=this.cc<<4&192;c<=a;c++)d=this.bb[this.sd[c]&this.yc]&e|f,d=this.aa[d],b[c]=d&65280|d<<16|d>>16|4278190080;this.screen.l(this.md)}this.ce=this.la;this.be=0;this.ee=this.la;this.de=0}md(this)};
function ed(a,b){const c=a.fa&31;if(c&&!a.h){const d=!!(a.ac&8);a.screen.C(c+1,!d&&!(a.ac&1),d,!!(a.u&4),a.Wd,b)}}function gd(a){const b=[0,2,4,6,1,3,5,7],c=(a.lb&12)>>2|(a.lb&32)>>3,d=a.lb&3|(a.lb&16)>>2;a.Ec=c!==d;a.screen.D(b[c],b[d]);jd(a)};function od(a,b){this.s=a;this.A=b;this.Le=this.yd=!1;this.Af=!0;this.Ae=this.Nc=this.Mc=0;this.qa=!0;this.R=this.P=this.G=this.N=this.U=this.J=this.uf=!1;this.va=new Rb(1024);this.l=0;this.Sd=100;this.i=this.j=0;this.C=!1;this.Tc=0;this.Qd=4;this.u=!1;this.g=new Rb(1024);this.D=this.o=!1;this.A.register("keyboard-code",function(c){this.uf&&(K("adding kbd code: "+B(c),64),this.va.push(c),this.Za())},this);this.A.register("mouse-click",function(c){this.Af&&this.Le&&(this.Ae=c[0]|c[2]<<1|c[1]<<2,this.yd&&
pd(this,0,0))},this);this.A.register("mouse-delta",function(c){var d=c[1];if(this.Af&&this.Le){var e=this.Qd*this.Sd/80;this.Mc+=c[0]*e;this.Nc+=d*e;this.yd&&(c=this.Mc|0,d=this.Nc|0,c||d)&&(this.Mc-=c,this.Nc-=d,pd(this,c,d))}},this);this.A.register("mouse-wheel",function(c){this.Tc-=c[0];this.Tc-=2*c[1];this.Tc=Math.min(7,Math.max(-8,this.Tc));pd(this,0,0)},this);this.h=5;this.fa=0;this.Z=this.X=this.aa=!1;M(a.B,96,this,this.fl);M(a.B,100,this,this.hl);T(a.B,96,this,this.gl);T(a.B,100,this,this.il)}
k=od.prototype;k.ea=function(){var a=[];a[0]=this.yd;a[1]=this.Le;a[2]=this.Af;a[3]=this.Mc;a[4]=this.Nc;a[5]=this.Ae;a[6]=this.qa;a[7]=this.uf;a[8]=this.J;a[9]=this.U;a[10]=this.N;a[11]=this.G;a[12]=this.P;a[13]=this.R;a[15]=this.l;a[16]=this.Sd;a[17]=this.Qd;a[18]=this.u;a[20]=this.h;a[21]=this.aa;a[22]=this.X;a[23]=this.fa;a[24]=this.Z;a[25]=this.i;a[26]=this.j;a[27]=this.C;return a};
k.I=function(a){this.yd=a[0];this.Le=a[1];this.Af=a[2];this.Mc=a[3];this.Nc=a[4];this.Ae=a[5];this.qa=a[6];this.uf=a[7];this.J=a[8];this.U=a[9];this.N=a[10];this.G=a[11];this.P=a[12];this.R=a[13];this.l=a[15];this.Sd=a[16];this.Qd=a[17];this.u=a[18];this.h=a[20];this.aa=a[21];this.X=a[22];this.fa=a[23];this.Z=a[24];this.i=a[25]||0;this.j=a[26]||0;this.C=a[27]||!1;this.D=this.o=!1;this.va.clear();this.g.clear();this.A.send("mouse-enable",this.Le)};
k.Za=function(){this.o||(this.va.length?qd(this):this.g.length&&rd(this))};function rd(a){a.o=!0;a.D=!0;a.h&2&&(K("Mouse irq",64),$b(a.s,12),a.s.cb(12))}function qd(a){a.o=!0;a.D=!1;a.h&1&&(K("Keyboard irq",64),$b(a.s,1),a.s.cb(1))}function pd(a,b,c){a.g.push((0>c)<<5|(0>b)<<4|8|a.Ae);a.g.push(b);a.g.push(c);4===a.i?(a.g.push(0|a.Tc&15),a.Tc=0):3===a.i&&(a.g.push(a.Tc&255),a.Tc=0);a.Za()}
k.fl=function(){this.o=!1;if(!this.va.length&&!this.g.length)return K("Port 60 read: Empty",64),this.l;this.D?($b(this.s,12),this.l=this.g.shift(),K("Port 60 read (mouse): "+B(this.l),64)):($b(this.s,1),this.l=this.va.shift(),K("Port 60 read (kbd)  : "+B(this.l),64));(this.va.length||this.g.length)&&this.Za();return this.l};k.hl=function(){var a=16;this.o&&(a|=1);this.D&&(a|=32);K("port 64 read: "+B(a),64);return a};
k.gl=function(a){K("port 60 write: "+B(a),64);if(this.X)this.h=a,this.X=!1,K("Keyboard command register = "+B(this.h),64);else if(this.aa)this.aa=!1,this.g.clear(),this.g.push(a),rd(this);else if(this.U){this.U=!1;this.g.clear();this.g.push(250);this.Sd=a;switch(this.j){case -1:60===a?(this.C=!0,this.j=0):(this.C=!1,this.j=200===a?1:0);break;case 0:200===a&&(this.j=1);break;case 1:this.j=100===a?2:200===a?3:0;break;case 2:80===a&&(this.i=3);this.j=-1;break;case 3:80===a&&(this.i=4),this.j=-1}K("mouse sample rate: "+
B(a)+", mouse id: "+B(this.i),64);this.Sd||(K("invalid sample rate, reset to 100",64),this.Sd=100);rd(this)}else if(this.R)this.R=!1,this.g.clear(),this.g.push(250),3<a?(this.Qd=4,K("invalid resolution, resetting to 4",64)):(this.Qd=1<<a,K("resolution: "+this.Qd,64)),rd(this);else if(this.N)this.N=!1,this.va.push(250),qd(this);else if(this.G)this.G=!1,this.va.push(250),qd(this),a||this.va.push(1);else if(this.P)this.P=!1,this.va.push(250),qd(this);else if(this.J){if(this.J=!1,K("Port 60 data register write: "+
B(a),64),this.Af){this.va.clear();this.g.clear();this.g.push(250);switch(a){case 230:K("Scaling 1:1",64);this.u=!1;break;case 231:K("Scaling 2:1",64);this.u=!0;break;case 232:this.R=!0;break;case 233:pd(this,0,0);break;case 235:K("unimplemented request single packet",64);pd(this,0,0);break;case 242:K("required id: "+B(this.i),64);this.g.push(this.i);this.Ae=this.Mc=this.Nc=0;this.Za();break;case 243:this.U=!0;break;case 244:this.Le=this.yd=!0;this.A.send("mouse-enable",!0);this.Ae=this.Mc=this.Nc=
0;break;case 245:this.yd=!1;break;case 246:this.yd=!1;this.Sd=100;this.u=!1;this.Qd=4;break;case 255:K("Mouse reset",64);this.g.push(170);this.g.push(0);this.Le=!0;this.A.send("mouse-enable",!0);this.yd=!1;this.Sd=100;this.u=!1;this.Qd=4;this.C||(this.i=0);this.Ae=this.Mc=this.Nc=0;break;default:K("Unimplemented mouse command: "+B(a),64)}rd(this)}}else if(this.Z)this.Z=!1,this.fa=a;else{K("Port 60 data register write: "+B(a),64);this.g.clear();this.va.clear();this.va.push(250);switch(a){case 237:this.N=
!0;break;case 240:this.G=!0;break;case 242:this.va.push(171);this.va.push(131);break;case 243:this.P=!0;break;case 244:K("kbd enable scanning",64);this.uf=!0;break;case 245:K("kbd disable scanning",64);this.uf=!1;break;case 246:break;case 255:this.va.clear();this.va.push(250);this.va.push(170);this.va.push(0);break;default:K("Unimplemented keyboard command: "+B(a),64)}qd(this)}};
k.il=function(a){K("port 64 write: "+B(a),64);switch(a){case 32:this.va.clear();this.g.clear();this.va.push(this.h);qd(this);break;case 96:this.X=!0;break;case 209:this.Z=!0;break;case 211:this.aa=!0;break;case 212:this.J=!0;break;case 167:K("Disable second port",64);this.h|=32;break;case 168:K("Enable second port",64);this.h&=-33;break;case 169:this.va.clear();this.g.clear();this.va.push(0);qd(this);break;case 170:this.va.clear();this.g.clear();this.va.push(85);qd(this);break;case 171:this.va.clear();
this.g.clear();this.va.push(0);qd(this);break;case 173:K("Disable Keyboard",64);this.h|=16;break;case 174:K("Enable Keyboard",64);this.h&=-17;break;case 254:K("CPU reboot via PS2");Dc(this.s);break;default:K("port 64: Unimplemented command byte: "+B(a),64)}};function sd(a){this.s=a;this.wd=0;this.Wc=new Uint8Array(128);this.D=this.g=Date.now();this.o=this.j=0;this.C=!1;this.u=.9765625;this.l=38;this.h=2;this.Tg=this.i=0;T(a.B,112,this,function(b){this.wd=b&127;this.Tg=b>>7});T(a.B,113,this,this.dj);M(a.B,113,this,this.cj)}k=sd.prototype;k.ea=function(){var a=[];a[0]=this.wd;a[1]=this.Wc;a[2]=this.g;a[3]=this.D;a[4]=this.j;a[5]=this.o;a[6]=this.C;a[7]=this.u;a[8]=this.l;a[9]=this.h;a[10]=this.i;a[11]=this.Tg;return a};
k.I=function(a){this.wd=a[0];this.Wc=a[1];this.g=a[2];this.D=a[3];this.j=a[4];this.o=a[5];this.C=a[6];this.u=a[7];this.l=a[8];this.h=a[9];this.i=a[10];this.Tg=a[11]};k.Sc=function(a){a=Date.now();this.g+=a-this.D;this.D=a;this.C&&this.j<a?(this.s.cb(8),this.i|=192,this.j+=this.u*Math.ceil((a-this.j)/this.u)):this.o&&this.o<a&&(this.s.cb(8),this.i|=160,this.o=0);let b=100;this.C&&this.j&&(b=Math.min(b,Math.max(0,this.j-a)));this.o&&(b=Math.min(b,Math.max(0,this.o-a)));return b};
function td(a,b){if(a.h&4)a=b;else{a=b;for(var c=b=0,d;a;)d=a%10,c|=d<<4*b,b++,a=(a-d)/10;a=c}return a}function ud(a,b){if(!(a.h&4)){a=b&15;const c=b>>4&15;l(256>b);l(10>a);l(10>c);b=a+10*c}return b}
k.cj=function(){var a=this.wd;switch(a){case 0:return K("read second: "+B(td(this,(new Date(this.g)).getUTCSeconds())),65536),td(this,(new Date(this.g)).getUTCSeconds());case 2:return K("read minute: "+B(td(this,(new Date(this.g)).getUTCMinutes())),65536),td(this,(new Date(this.g)).getUTCMinutes());case 4:return K("read hour: "+B(td(this,(new Date(this.g)).getUTCHours())),65536),td(this,(new Date(this.g)).getUTCHours());case 6:return K("read day: "+B(td(this,(new Date(this.g)).getUTCDay()+1)),65536),
td(this,(new Date(this.g)).getUTCDay()+1);case 7:return K("read day of month: "+B(td(this,(new Date(this.g)).getUTCDate())),65536),td(this,(new Date(this.g)).getUTCDate());case 8:return K("read month: "+B(td(this,(new Date(this.g)).getUTCMonth()+1)),65536),td(this,(new Date(this.g)).getUTCMonth()+1);case 9:return K("read year: "+B(td(this,(new Date(this.g)).getUTCFullYear()%100)),65536),td(this,(new Date(this.g)).getUTCFullYear()%100);case 10:return 999<=Jb()%1E3?this.l|128:this.l;case 11:return this.h;
case 12:return $b(this.s,8),K("cmos reg C read",65536),a=this.i,this.i&=-241,a;case 13:return 0;case 50:case 55:return K("read century: "+B(td(this,(new Date(this.g)).getUTCFullYear()/100|0)),65536),td(this,(new Date(this.g)).getUTCFullYear()/100|0);default:return K("cmos read from index "+B(a),65536),this.Wc[this.wd]}};
k.dj=function(a){switch(this.wd){case 10:this.l=a&127;this.u=1E3/(32768>>(this.l&15)-1);K("Periodic interrupt, a="+B(this.l,2)+" t="+this.u,65536);break;case 11:this.h=a;this.h&64&&(this.j=Date.now());if(this.h&32){a=new Date;const b=ud(this,this.Wc[1]),c=ud(this,this.Wc[3]),d=ud(this,this.Wc[5]),e=new Date(Date.UTC(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),d,c,b));K("RTC alarm scheduled for "+e+" hh:mm:ss="+d+":"+c+":"+b+" ms_from_now="+(e-a),65536);this.o=+e}this.h&16&&K("Unimplemented: updated interrupt",
65536);K("cmos b="+B(this.h,2),65536);break;case 1:case 3:case 5:nc(this,this.wd,a);break;default:K("cmos write index "+B(this.wd)+": "+B(a),65536)}this.C=64===(this.h&64)&&0<(this.l&15)};function nc(a,b,c){K("cmos "+B(b)+" <- "+B(c),65536);l(128>b);a.Wc[b]=c};function vd(a,b,c){this.A=c;this.s=a;this.h=4;this.ad=this.Uc=0;this.Dd=96;this.$c=this.wf=0;this.Gc=1;this.na=this.Ag=this.Sa=this.sg=0;this.input=[];this.i="";switch(b){case 1016:this.g=0;this.na=4;break;case 760:this.g=1;this.na=3;break;case 1E3:this.g=2;this.na=4;break;case 744:this.na=this.g=3;break;default:K("Invalid serial port: "+B(b),16384),this.g=0,this.na=4}this.A.register("serial"+this.g+"-input",function(d){K("input: "+B(d),16384);this.input.push(d);this.Dd|=1;this.wf&1?wd(this,12):wd(this,
4)},this);this.A.register("serial"+this.g+"-modem-status-input",function(d){xd(this,d)},this);this.A.register("serial"+this.g+"-carrier-detect-input",function(d){xd(this,d?this.Sa|136:this.Sa&-137)},this);this.A.register("serial"+this.g+"-ring-indicator-input",function(d){xd(this,d?this.Sa|68:this.Sa&-69)},this);this.A.register("serial"+this.g+"-data-set-ready-input",function(d){xd(this,d?this.Sa|34:this.Sa&-35)},this);this.A.register("serial"+this.g+"-clear-to-send-input",function(d){xd(this,d?this.Sa|
17:this.Sa&-18)},this);a=a.B;T(a,b,this,function(d){yd(this,d)},function(d){yd(this,d&255);yd(this,d>>8)});T(a,b|1,this,function(d){this.ad&128?(this.Uc=this.Uc&255|d<<8,K("baud rate: "+B(this.Uc),16384)):(0===(this.$c&2)&&d&2&&wd(this,2),this.$c=d&15,K("interrupt enable: "+B(d),16384),zd(this))});M(a,b,this,function(){if(this.ad&128)return this.Uc&255;let d=0;0===this.input.length?K("Read input empty",16384):(d=this.input.shift(),K("Read input: "+B(d),16384));0===this.input.length&&(this.Dd&=-2,
Ad(this,12),Ad(this,4));return d});M(a,b|1,this,function(){return this.ad&128?this.Uc>>8:this.$c&15});M(a,b|2,this,function(){var d=this.Gc&15;K("read interrupt identification: "+B(this.Gc),16384);2===this.Gc&&Ad(this,2);this.wf&1&&(d|=192);return d});T(a,b|2,this,function(d){K("fifo control: "+B(d),16384);this.wf=d});M(a,b|3,this,function(){K("read line control: "+B(this.ad),16384);return this.ad});T(a,b|3,this,function(d){K("line control: "+B(d),16384);this.ad=d});M(a,b|4,this,function(){return this.sg});
T(a,b|4,this,function(d){K("modem control: "+B(d),16384);this.sg=d});M(a,b|5,this,function(){K("read line status: "+B(this.Dd),16384);return this.Dd});T(a,b|5,this,function(){K("Factory test write",16384)});M(a,b|6,this,function(){K("read modem status: "+B(this.Sa),16384);return this.Sa&=240});T(a,b|6,this,function(d){K("write modem status: "+B(d),16384);xd(this,d)});M(a,b|7,this,function(){return this.Ag});T(a,b|7,this,function(d){this.Ag=d})}
vd.prototype.ea=function(){var a=[];a[0]=this.h;a[1]=this.Uc;a[2]=this.ad;a[3]=this.Dd;a[4]=this.wf;a[5]=this.$c;a[6]=this.Gc;a[7]=this.sg;a[8]=this.Sa;a[9]=this.Ag;a[10]=this.na;return a};vd.prototype.I=function(a){this.h=a[0];this.Uc=a[1];this.ad=a[2];this.Dd=a[3];this.wf=a[4];this.$c=a[5];this.Gc=a[6];this.sg=a[7];this.Sa=a[8];this.Ag=a[9];this.na=a[10]};
function zd(a){a.h&4096&&a.$c&1?(a.Gc=12,a.s.cb(a.na)):a.h&16&&a.$c&1?(a.Gc=4,a.s.cb(a.na)):a.h&4&&a.$c&2?(a.Gc=2,a.s.cb(a.na)):a.h&1&&a.$c&8?(a.Gc=0,a.s.cb(a.na)):(a.Gc=1,$b(a.s,a.na))}function wd(a,b){a.h|=1<<b;zd(a)}function Ad(a,b){a.h&=~(1<<b);zd(a)}
function yd(a,b){a.ad&128?a.Uc=a.Uc&-256|b:(K("data: "+B(b),16384),wd(a,2),a.A.send("serial"+a.g+"-output-byte",b),b=String.fromCharCode(b),a.i+=b,"\n"===b&&(K("SERIAL: "+a.i.trimRight().replace(/[\x00-\x08\x0b-\x1f\x7f\x80-\xff]/g,"")),a.i=""))}function xd(a,b){K("modem status: "+B(b),16384);let c=(a.Sa^b)>>4;c|=a.Sa&15;a.Sa=b;a.Sa|=c};function Bd(a){this.s=a;var b=a.B;jc(a.v.kb,{Ta:56,O:[134,128,19,113,7,0,128,2,8,0,128,6,0,0,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,1,0,0],Gb:[],name:"acpi"});this.g=this.h=0;this.status=1;this.Hf=this.De=0;this.i=Cd(this,Jb());this.Dc=new Uint8Array(4);M(b,45056,this,void 0,function(){K("ACPI pm1_status read",262144);return this.De});T(b,45056,this,void 0,function(c){K("ACPI pm1_status write: "+B(c,4),262144);this.De&=~c});M(b,45058,this,void 0,
function(){K("ACPI pm1_enable read",262144);return this.Hf});T(b,45058,this,void 0,function(c){K("ACPI pm1_enable write: "+B(c),262144);this.Hf=c});M(b,45060,this,void 0,function(){K("ACPI status read",262144);return this.status});T(b,45060,this,void 0,function(c){K("ACPI status write: "+B(c),262144);this.status=c});M(b,45064,this,void 0,void 0,function(){return Cd(this,Jb())&16777215});M(b,45024,this,function(){K("Read gpe#0",262144);return this.Dc[0]});M(b,45025,this,function(){K("Read gpe#1",262144);
return this.Dc[1]});M(b,45026,this,function(){K("Read gpe#2",262144);return this.Dc[2]});M(b,45027,this,function(){K("Read gpe#3",262144);return this.Dc[3]});T(b,45024,this,function(c){K("Write gpe#0: "+B(c),262144);this.Dc[0]=c});T(b,45025,this,function(c){K("Write gpe#1: "+B(c),262144);this.Dc[1]=c});T(b,45026,this,function(c){K("Write gpe#2: "+B(c),262144);this.Dc[2]=c});T(b,45027,this,function(c){K("Write gpe#3: "+B(c),262144);this.Dc[3]=c})}
Bd.prototype.Sc=function(a){a=Cd(this,a);var b=0!==((a^this.i)&8388608);this.Hf&1&&b?(K("ACPI raise irq",262144),this.De|=1,this.s.cb(9)):$b(this.s,9);this.i=a;return 100};function Cd(a,b){b=Math.round(3579.545*b);b===a.h?3579.545>a.g&&a.g++:(l(b>a.h),a.h+a.g<=b?(a.g=0,a.h=b):K("Warning: Overshot pmtimer, waiting; current="+b+" last="+a.h+" offset="+a.g,262144));return a.h+a.g}Bd.prototype.ea=function(){var a=[];a[0]=this.status;a[1]=this.De;a[2]=this.Hf;a[3]=this.Dc;return a};
Bd.prototype.I=function(a){this.status=a[0];this.De=a[1];this.Hf=a[2];this.Dc=a[3]};var Dd="Fixed (0);Lowest Prio (1);SMI (2);Reserved (3);NMI (4);INIT (5);Reserved (6);ExtINT (7)".split(";"),Ed=["physical","logical"];
function Fd(a){this.s=a;this.fa=this.D=0;this.qa=1;this.g=this.o=0;this.l=Jb();this.R=this.X=this.U=this.Z=this.h=65536;this.N=this.J=this.u=0;this.i=new Int32Array(8);this.Xa=new Int32Array(8);this.j=new Int32Array(8);this.aa=254;this.G=-1;this.C=this.error=this.P=0;zb(a.B,4276092928,1048576,b=>{K("Unsupported read8 from apic: "+B(b>>>0),524288);var c=b&3;return this.Pd(b&-4)>>8*c&255},(b,c)=>{K("Unsupported write8 from apic: "+B(b)+" <- "+B(c),524288);K(Error().stack,void 0);l(!1)},b=>this.Pd(b),
(b,c)=>this.wa(b,c))}k=Fd.prototype;
k.Pd=function(a){a=a-4276092928|0;switch(a){case 32:return K("APIC read id",524288),this.D;case 48:return K("APIC read version",524288),327700;case 128:return this.u;case 208:return K("Read local destination",524288),this.P;case 224:return K("Read destination format",524288),this.G;case 240:return this.aa;case 256:case 272:case 288:case 304:case 320:case 336:case 352:case 368:return a=a-256>>4,K("Read isr "+a+": "+B(this.Xa[a]>>>0,8),524288),this.Xa[a];case 384:case 400:case 416:case 432:case 448:case 464:case 480:case 496:return a=a-
384>>4,K("Read tmr "+a+": "+B(this.j[a]>>>0,8),524288),this.j[a];case 512:case 528:case 544:case 560:case 576:case 592:case 608:case 624:return a=a-512>>4,K("Read irr "+a+": "+B(this.i[a]>>>0,8),524288),this.i[a];case 640:return K("Read error: "+B(this.C>>>0,8),524288),this.C;case 768:return this.J;case 784:return K("APIC read icr1",524288),this.N;case 800:return K("read timer lvt",524288),this.h;case 832:return K("read lvt perf counter",524288),this.Z;case 848:return K("read lvt int0",524288),this.U;
case 864:return K("read lvt int1",524288),this.X;case 880:return K("read lvt error",524288),this.R;case 992:return K("read timer divider",524288),this.fa;case 896:return K("read timer initial count",524288),this.o;case 912:return K("read timer current count: "+B(this.g>>>0,8),524288),this.g;default:return K("APIC read "+B(a),524288),l(!1),0}};
k.wa=function(a,b){a=a-4276092928|0;switch(a){case 32:K("APIC write id: "+B(b>>>8,8),524288);this.D=b;break;case 48:K("APIC write version: "+B(b>>>0,8)+", ignored",524288);break;case 128:this.u=b&255;Gd(this);break;case 176:b=Hd(this);if(-1!==b){Id(this.Xa,b);if(Jd(this.j,b)){a=this.s.v.Ad;for(var c=0;24>c;c++){var d=a.g[c];(d&255)===b&&d&16384&&(K("Clear remote IRR for irq="+B(c),524288),a.g[c]&=-16385,Kd(a,c))}}Gd(this)}else K("Bad eoi: No isr set",524288);break;case 208:K("Set local destination: "+
B(b>>>0,8),524288);this.P=b&4278190080;break;case 224:K("Set destination format: "+B(b>>>0,8),524288);this.G=b|16777215;break;case 240:K("Set spurious vector: "+B(b>>>0,8),524288);this.aa=b;break;case 640:K("Write error: "+B(b>>>0,8),524288);this.C=this.error;this.error=0;break;case 768:a=b&255;c=b>>8&7;d=b>>15&1;var e=b>>18&3;K("APIC write icr0: "+B(b,8)+" vector="+B(a,2)+" destination_mode="+Ed[b>>11&1]+" delivery_mode="+Dd[c]+" destination_shorthand="+["no","self","all with self","all without self"][e],
524288);this.J=b&-4097;0===e?Ld(this,a,c,d):1===e?Ld(this,a,0,d):2===e?Ld(this,a,c,d):3!==e&&l(!1);break;case 784:K("APIC write icr1: "+B(b>>>0,8),524288);this.N=b;break;case 800:K("timer lvt: "+B(b>>>0,8),524288);this.h=b;break;case 832:K("lvt perf counter: "+B(b>>>0,8),524288);this.Z=b;break;case 848:K("lvt int0: "+B(b>>>0,8),524288);this.U=b;break;case 864:K("lvt int1: "+B(b>>>0,8),524288);this.X=b;break;case 880:K("lvt error: "+B(b>>>0,8),524288);this.R=b;break;case 992:K("timer divider: "+B(b>>>
0,8),524288);this.fa=b;b=b&3|(b&8)>>1;this.qa=7===b?0:b+1;break;case 896:K("timer initial: "+B(b>>>0,8),524288);this.o=b>>>0;this.g=b>>>0;this.l=Jb();break;case 912:K("timer current: "+B(b>>>0,8),524288);l(!1,"read-only register");break;default:K("APIC write32 "+B(a)+" <- "+B(b>>>0,8),524288),l(!1)}};
k.Sc=function(a){if(0===this.g)return 100;const b=1E6/(1<<this.qa);a=(a-this.l)*b>>>0;this.l+=a/b;this.g-=a;0>=this.g&&(a=this.h&393216,131072===a?(this.g%=this.o,0>=this.g&&(this.g+=this.o),l(0!==this.g),0===(this.h&65536)&&Ld(this,this.h&255,0,!1)):0===a&&(this.g=0,K("APIC timer one shot end",524288),0===(this.h&65536)&&Ld(this,this.h&255,0,!1)));return Math.max(0,this.g/b)};
function Ld(a,b,c,d){5!==c&&4!==c&&((16>b||255===b)&&l(!1,"TODO: Invalid vector"),Jd(a.i,b)?K("Not delivered: irr already set, vector="+B(b,2),524288):(Md(a.i,b),d?Md(a.j,b):Id(a.j,b),Gd(a)))}function Nd(a){a=Od(a.i);l(255!==a);l(16<=a||-1===a);return a}function Hd(a){a=Od(a.Xa);l(255!==a);l(16<=a||-1===a);return a}function Gd(a){var b=Nd(a);-1!==b&&(Hd(a)>=b||(b&240)<=(a.u&240)||a.s.be())}
k.ea=function(){var a=[];a[0]=this.D;a[1]=this.fa;a[2]=this.qa;a[3]=this.o;a[4]=this.g;a[5]=this.l;a[6]=this.h;a[7]=this.Z;a[8]=this.U;a[9]=this.X;a[10]=this.R;a[11]=this.u;a[12]=this.J;a[13]=this.N;a[14]=this.i;a[15]=this.Xa;a[16]=this.j;a[17]=this.aa;a[18]=this.G;a[19]=this.P;a[20]=this.error;a[21]=this.C;return a};
k.I=function(a){this.D=a[0];this.fa=a[1];this.qa=a[2];this.o=a[3];this.g=a[4];this.l=a[5];this.h=a[6];this.Z=a[7];this.U=a[8];this.X=a[9];this.R=a[10];this.u=a[11];this.J=a[12];this.N=a[13];this.i=a[14];this.Xa=a[15];this.j=a[16];this.aa=a[17];this.G=a[18];this.P=a[19];this.error=a[20];this.C=a[21]};function Jd(a,b){l(0<=b&&256>b);return a[b>>5]>>(b&31)&1}function Md(a,b){l(0<=b&&256>b);a[b>>5]|=1<<(b&31)}function Id(a,b){l(0<=b&&256>b);a[b>>5]&=~(1<<(b&31))}
function Od(a){for(var b=7;0<=b;b--){var c=a[b];if(c)return Kb(c>>>0)|b<<5}return-1};function Pd(a){this.s=a;this.g=new Int32Array(24);this.o=new Int32Array(24);for(var b=0;b<this.g.length;b++)this.g[b]=65536;this.j=this.h=this.l=this.i=0;l(!0);zb(a.B,4273995776,131072,c=>{c=c-4273995776|0;if(16<=c&&20>c)return c-=16,K("ioapic read8 byte "+c+" "+B(this.i),524288),this.read(this.i)>>8*c&255;K("Unexpected IOAPIC register read: "+B(c>>>0),524288);l(!1);return 0},c=>{l(!1,"unsupported write8 from ioapic: "+B(c>>>0))},c=>{c=c-4273995776|0;if(0===c)return this.i;if(16===c)return this.read(this.i);
K("Unexpected IOAPIC register read: "+B(c>>>0),524288);l(!1);return 0},(c,d)=>{c=c-4273995776|0;0===c?this.i=d:16===c?this.write(this.i,d):(K("Unexpected IOAPIC register write: "+B(c>>>0)+" <- "+B(d>>>0,8),524288),l(!1))})}
function Kd(a,b){var c=1<<b;if(0!==(a.h&c)){var d=a.g[b];if(0===(d&65536)){var e=d>>8&7,f=d&255,h=32768===(d&32768);if(0===(d&32768))a.h&=~c;else if(a.g[b]|=16384,d&16384){K("No route: level interrupt and remote IRR still set",524288);return}0===e||1===e?Ld(a.s.v.Te,f,e,h):l(!1,"TODO");a.g[b]&=-4097}}}
Pd.prototype.read=function(a){if(0===a)return K("IOAPIC Read id",524288),this.l<<24;if(1===a)return K("IOAPIC Read version",524288),1507345;if(2===a)return K("IOAPIC Read arbitration id",524288),this.l<<24;if(16<=a&&64>a){var b=a-16>>1;a&1?(a=this.o[b],K("IOAPIC Read destination irq="+B(b)+" -> "+B(a,8),524288)):(a=this.g[b],K("IOAPIC Read config irq="+B(b)+" -> "+B(a,8),524288));return a}K("IOAPIC register read outside of range "+B(a),524288);l(!1);return 0};
Pd.prototype.write=function(a,b){if(0===a)this.l=b>>>24&15;else if(1===a||2===a)K("Invalid write: "+a,524288);else if(16<=a&&64>a){var c=a-16>>1;a&1?(this.o[c]=b&4278190080,K("Write destination "+B(b>>>0,8)+" irq="+B(c)+" dest="+B(b>>>24,2),524288)):(this.g[c]=b&110591|this.g[c]&-110592,K("Write config "+B(b>>>0,8)+" irq="+B(c)+" vector="+B(b&255,2)+" deliverymode="+Dd[b>>8&7]+" destmode="+Ed[b>>11&1]+" is_level="+(b>>15&1)+" disabled="+(b>>16&1),524288),Kd(this,c))}else K("IOAPIC register write outside of range "+
B(a)+": "+B(b>>>0,8),524288),l(!1)};Pd.prototype.ea=function(){var a=[];a[0]=this.g;a[1]=this.o;a[2]=this.i;a[3]=this.l;a[4]=this.h;a[5]=this.j;return a};Pd.prototype.I=function(a){this.g=a[0];this.o=a[1];this.i=a[2];this.l=a[3];this.h=a[4];this.j=a[5]};function Qd(a){this.message=a}Qd.prototype=Error();const Rd={Uint8Array,Int8Array,Uint16Array,Int16Array,Uint32Array,Int32Array,Float32Array,Float64Array};
function Sd(a,b){if("object"!==typeof a||null===a)return l("function"!==typeof a),a;if(a instanceof Array)return a.map(f=>Sd(f,b));a.constructor===Object&&(console.log(a),l(a.constructor!==Object,"Expected non-object"));if(a.BYTES_PER_ELEMENT){var c=new Uint8Array(a.buffer,a.byteOffset,a.length*a.BYTES_PER_ELEMENT);a=a.constructor.name.replace("bound ","");l(Rd[a]);return{__state_type__:a,buffer_id:b.push(c)-1}}a.ea||console.log("Object without get_state: ",a);c=a.ea();a=[];for(var d=0;d<c.length;d++){var e=
c[d];l("function"!==typeof e);a[d]=Sd(e,b)}return a}function Td(a,b){if("object"!==typeof a||null===a)return l("function"!==typeof a),a;if(a instanceof Array){for(var c=0;c<a.length;c++)a[c]=Td(a[c],b);return a}c=a.__state_type__;l(void 0!==c);const d=Rd[c];l(d,"Unkown type: "+c);return new d(b[a.buffer_id])}
Eb.prototype.Mf=function(){for(var a=[],b=Sd(this,a),c=[],d=0,e=0;e<a.length;e++){var f=a[e].byteLength;c[e]={offset:d,length:f};d+=f;d=d+3&-4}b=JSON.stringify({buffer_infos:c,state:b});b=(new TextEncoder).encode(b);e=16+b.length;e=e+3&-4;var h=e+d;d=new ArrayBuffer(h);var g=new Int32Array(d,0,4);(new Uint8Array(d,16,b.length)).set(b);f=new Uint8Array(d,e);g[0]=-2039052682;g[1]=6;g[2]=h;g[3]=b.length;for(e=0;e<a.length;e++)h=a[e],l(h.constructor===Uint8Array),f.set(h,c[e].offset);K("State: json size "+
(b.byteLength>>10)+"k");K("State: Total buffers size "+(f.byteLength>>10)+"k");return d};
Eb.prototype.ef=function(a){function b(x,y){const F=x.length;if(16>F)throw new Qd("Invalid length: "+F);x=new Int32Array(x.buffer,x.byteOffset,4);if(-2039052682!==x[0])throw new Qd("Invalid header: "+B(x[0]>>>0));if(6!==x[1])throw new Qd("Version mismatch: dump="+x[1]+" we=6");if(y&&x[2]!==F)throw new Qd("Length doesn't match header: real="+F+" header="+x[2]);return x[3]}function c(x){x=(new TextDecoder).decode(x);return JSON.parse(x)}a=new Uint8Array(a);if(4247762216===(new Uint32Array(a.buffer,
0,1))[0]){var d=this.Fi(a.length);(new Uint8Array(this.Ma.buffer,this.Ii(d),a.length)).set(a);var e=this.lf(d,16),f=new Uint8Array(this.Ma.buffer,e,16),h=b(f,!1);this.mf(e,16);e=this.lf(d,h);f=new Uint8Array(this.Ma.buffer,e,h);f=c(f);this.mf(e,h);e=f.state;var g=f.buffer_infos;f=[];h=16+h;for(var m of g){g=(h+3&-4)-h;if(1048576<m.length){var n=this.lf(d,g);this.mf(n,g);n=new Uint8Array(m.length);f.push(n.buffer);for(var p=0;p<m.length;){var t=m.length-p;l(0<=t);t=Math.min(t,1048576);const x=this.lf(d,
t);n.set(new Uint8Array(this.Ma.buffer,x,t),p);this.mf(x,t);p+=t}}else n=this.lf(d,g+m.length),p=n+g,f.push(this.Ma.buffer.slice(p,p+m.length)),this.mf(n,g+m.length);h+=g+m.length}e=Td(e,f);this.I(e);this.Hi(d)}else{m=b(a,!0);if(0>m||m+12>=a.length)throw new Qd("Invalid info block length: "+m);e=c(a.subarray(16,16+m));d=e.state;e=e.buffer_infos;let x=16+m;x=x+3&-4;m=e.map(y=>{const F=x+y.offset;return a.buffer.slice(F,F+y.length)});d=Td(d,m);this.I(d)}};function Ud(a,b,c){a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&(K("Replace mac in eth destination field",1048576),a[0]=c[0],a[1]=c[1],a[2]=c[2],a[3]=c[3],a[4]=c[4],a[5]=c[5]);a[6]===b[0]&&a[7]===b[1]&&a[8]===b[2]&&a[9]===b[3]&&a[10]===b[4]&&a[11]===b[5]&&(K("Replace mac in eth source field",1048576),a[6]=c[0],a[7]=c[1],a[8]=c[2],a[9]=c[3],a[10]=c[4],a[11]=c[5]);var d=a[12]<<8|a[13];if(2048===d)if(a=a.subarray(14),d=a[0]>>4,4!==d)K("Expected ipv4.version==4 but got: "+
d,1048576);else{if(l(5===(a[0]&15),"TODO: ihl!=5"),17===a[9]){a=a.subarray(20);d=a[0]<<8|a[1];var e=a[2]<<8|a[3];K("udp srcport="+d+" dstport="+e+" checksum="+B(a[6]<<8|a[7],4),1048576);if(67===d||67===e)if(d=a.subarray(8),e=d[236]<<24|d[237]<<16|d[238]<<8|d[239],1669485411!==e)K("dhcp packet didn't match magic: "+B(e,8));else for(d[28]===b[0]&&d[29]===b[1]&&d[30]===b[2]&&d[31]===b[3]&&d[32]===b[4]&&d[33]===b[5]&&(K("Replace mac in dhcp.chaddr",1048576),d[28]=c[0],d[29]=c[1],d[30]=c[2],d[31]=c[3],
d[32]=c[4],d[33]=c[5],a[6]=a[7]=0),e=240;e<d.length;){const f=d[e++];if(255===f)break;const h=d[e++];61===f&&1===d[e+0]&&d[e+1]===b[0]&&d[e+2]===b[1]&&d[e+3]===b[2]&&d[e+4]===b[3]&&d[e+5]===b[4]&&d[e+6]===b[5]&&(K("Replace mac in dhcp.clientidentifier",1048576),d[e+1]=c[0],d[e+2]=c[1],d[e+3]=c[2],d[e+4]=c[3],d[e+5]=c[4],d[e+6]=c[5],a[6]=a[7]=0);e+=h}}}else 2054===d&&(a=a.subarray(14),K("arp oper="+a[7]+" "+Vd(a.subarray(8,14))+" "+Vd(a.subarray(18,24)),1048576),a[8]===b[0]&&a[9]===b[1]&&a[10]===b[2]&&
a[11]===b[3]&&a[12]===b[4]&&a[13]===b[5]&&(K("Replace mac in arp.sha",1048576),a[8]=c[0],a[9]=c[1],a[10]=c[2],a[11]=c[3],a[12]=c[4],a[13]=c[5]))}function Vd(a){return[a[0].toString(16).padStart(2,"0"),a[1].toString(16).padStart(2,"0"),a[2].toString(16).padStart(2,"0"),a[3].toString(16).padStart(2,"0"),a[4].toString(16).padStart(2,"0"),a[5].toString(16).padStart(2,"0")].join(":")}
function Wd(a,b,c,d){this.s=a;this.kb=a.v.kb;this.id=0;this.Ge=c;this.Vb=d;this.A=b;this.A.register("net"+this.id+"-receive",function(e){this.Pa(e)},this);this.port=768+256*this.id;this.name="ne2k";this.O=[236,16,41,128,3,1,0,0,0,0,0,2,0,0,0,0,this.port&255|1,this.port>>8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,244,26,0,17,0,0,184,254,0,0,0,0,0,0,0,0,0,1,0,0];this.Ta=(0===this.id?5:7+this.id)<<3;this.Gb=[{size:32}];this.ng=this.Xa=0;this.Ra=1;this.Fg=this.Ke=this.nc=this.rf=0;this.memory=
new Uint8Array(32768);this.Hg=this.ff=0;this.kh=1;this.ia=new Uint8Array([0,34,21,255*Math.random()|0,255*Math.random()|0,255*Math.random()|0]);this.A.send("net"+this.id+"-mac",Vd(this.ia));this.Ed=Uint8Array.of(255,255,255,255,255,255,255,255);this.af=null;for(b=0;6>b;b++)this.memory[b<<1]=this.memory[b<<1|1]=this.ia[b];this.memory[28]=this.memory[29]=87;this.memory[30]=this.memory[31]=87;K("Mac: "+Vd(this.ia),1048576);this.Ha=0;this.mc=64;this.qb=128;this.qc=this.Ob=76;b=a.B;M(b,this.port|0,this,
function(){K("Read cmd",1048576);return this.Ra});T(b,this.port|0,this,function(e){this.Ra=e;K("Write command: "+B(e,2)+" newpg="+(this.Ra>>6)+" txcr="+B(this.Hg,2),1048576);this.Ra&1||(e&24&&0===this.nc&&Xd(this,64),e&4&&(e=this.Fg<<8,e=this.memory.subarray(e,e+this.Ke),this.af&&(e=new Uint8Array(e),Ud(e,this.af,this.ia)),this.A.send("net"+this.id+"-send",e),this.A.send("eth-transmit-end",[e.length]),this.Ra&=-5,Xd(this,2),K("Command: Transfer. length="+B(e.byteLength),1048576)))});M(b,this.port|
13,this,function(){var e=Y(this);if(1===e)return K("Read mar5",1048576),this.Ed[5];K("Read counter0 pg="+e,1048576);return 0});M(b,this.port|14,this,function(){var e=Y(this);if(1===e)return K("Read mar6",1048576),this.Ed[6];K("Read8 counter1 pg="+e,1048576);return 0},function(){K("Read16 counter1 pg="+Y(this),1048576);return 0});M(b,this.port|15,this,function(){var e=Y(this);if(1===e)return K("Read mar7",1048576),this.Ed[7];K("Read counter2 pg="+e,1048576);return 0});M(b,this.port|31,this,function(){K("Read reset",
1048576);Xd(this,128);return 0});T(b,this.port|31,this,function(e){K("Write reset: "+B(e,2),1048576)});M(b,this.port|1,this,function(){var e=Y(this);if(0===e)return this.mc;if(1===e)return K("Read pg1/01 (mac[0])",1048576),this.ia[0];if(2===e)return this.mc;K("Read pg"+e+"/01");l(!1);return 0});T(b,this.port|1,this,function(e){var f=Y(this);0===f?(K("start page: "+B(e,2),1048576),this.mc=e):1===f?(K("mac[0] = "+B(e),1048576),this.ia[0]=e):3===f?K("Unimplemented: Write pg3/01 (9346CR): "+B(e),1048576):
(K("Write pg"+f+"/01: "+B(e),1048576),l(!1))});M(b,this.port|2,this,function(){var e=Y(this);if(0===e)return this.qb;if(1===e)return K("Read pg1/02 (mac[1])",1048576),this.ia[1];if(2===e)return this.qb;K("Read pg"+e+"/02",1048576);l(!1);return 0});T(b,this.port|2,this,function(e){var f=Y(this);0===f?(K("stop page: "+B(e,2),1048576),e>this.memory.length>>8&&(e=this.memory.length>>8,K("XXX: Adjusting stop page to "+B(e),1048576)),this.qb=e):1===f?(K("mac[1] = "+B(e),1048576),this.ia[1]=e):(K("Write pg"+
f+"/02: "+B(e),1048576),l(!1))});M(b,this.port|7,this,function(){var e=Y(this);if(0===e)return K("Read isr: "+B(this.Xa,2),1048576),this.Xa;if(1===e)return K("Read curpg: "+B(this.Ob,2),1048576),this.Ob;l(!1);return 0});T(b,this.port|7,this,function(e){var f=Y(this);0===f?(K("Write isr: "+B(e,2),1048576),this.Xa&=~e,Yd(this)):1===f?(K("Write curpg: "+B(e,2),1048576),this.Ob=e):l(!1)});T(b,this.port|13,this,function(e){var f=Y(this);0===f?(this.Hg=e,K("Write tx config: "+B(e,2),1048576)):K("Unimplemented: Write pg"+
f+"/0d "+B(e,2),1048576)});T(b,this.port|14,this,function(e){var f=Y(this);0===f?(K("Write data configuration: "+B(e,2),1048576),this.rf=e):K("Unimplemented: Write pg"+f+"/0e "+B(e,2),1048576)});M(b,this.port|10,this,function(){var e=Y(this);if(0===e)return K("Read pg0/0a",1048576),80;if(1===e)return K("Read mar2",1048576),this.Ed[2];l(!1,"TODO");return 0});T(b,this.port|10,this,function(e){var f=Y(this);0===f?(K("Write remote byte count low: "+B(e,2),1048576),this.nc=this.nc&65280|e&255):K("Unimplemented: Write pg"+
f+"/0a "+B(e,2),1048576)});M(b,this.port|11,this,function(){var e=Y(this);if(0===e)return K("Read pg0/0b",1048576),67;if(1===e)return K("Read mar3",1048576),this.Ed[3];l(!1,"TODO");return 0});T(b,this.port|11,this,function(e){var f=Y(this);0===f?(K("Write remote byte count high: "+B(e,2),1048576),this.nc=this.nc&255|e<<8&65280):K("Unimplemented: Write pg"+f+"/0b "+B(e,2),1048576)});M(b,this.port|8,this,function(){var e=Y(this);if(0===e)return K("Read remote start address low",1048576),this.Ha&255;
if(1===e)return K("Read mar0",1048576),this.Ed[0];K("Unimplemented: Read pg"+e+"/08",1048576);l(!1);return 0});T(b,this.port|8,this,function(e){var f=Y(this);0===f?(K("Write remote start address low: "+B(e,2),1048576),this.Ha=this.Ha&65280|e&255):K("Unimplemented: Write pg"+f+"/08 "+B(e,2),1048576)});M(b,this.port|9,this,function(){var e=Y(this);if(0===e)return K("Read remote start address high",1048576),this.Ha>>8&255;if(1===e)return K("Read mar1",1048576),this.Ed[1];K("Unimplemented: Read pg"+e+
"/09",1048576);l(!1);return 0});T(b,this.port|9,this,function(e){var f=Y(this);0===f?(K("Write remote start address low: "+B(e,2),1048576),this.Ha=this.Ha&255|e<<8&65280):K("Unimplemented: Write pg"+f+"/09 "+B(e,2),1048576)});T(b,this.port|15,this,function(e){var f=Y(this);0===f?(K("Write interrupt mask register: "+B(e,2)+" isr="+B(this.Xa,2),1048576),this.ng=e,Yd(this)):K("Unimplemented: Write pg"+f+"/0f "+B(e,2),1048576)});M(b,this.port|3,this,function(){var e=Y(this);if(0===e)return K("Read boundary: "+
B(this.qc,2),1048576),this.qc;if(1===e)return K("Read pg1/03 (mac[2])",1048576),this.ia[2];3===e?K("Unimplemented: Read pg3/03 (CONFIG0)",1048576):(K("Read pg"+e+"/03",1048576),l(!1));return 0});T(b,this.port|3,this,function(e){var f=Y(this);0===f?(K("Write boundary: "+B(e,2),1048576),this.qc=e):1===f?(K("mac[2] = "+B(e),1048576),this.ia[2]=e):(K("Write pg"+f+"/03: "+B(e),1048576),l(!1))});M(b,this.port|4,this,function(){var e=Y(this);if(0===e)return this.kh;if(1===e)return K("Read pg1/04 (mac[3])",
1048576),this.ia[3];K("Read pg"+e+"/04",1048576);l(!1);return 0});T(b,this.port|4,this,function(e){var f=Y(this);0===f?(K("Write tpsr: "+B(e,2),1048576),this.Fg=e):1===f?(K("mac[3] = "+B(e),1048576),this.ia[3]=e):(K("Write pg"+f+"/04: "+B(e),1048576),l(!1))});M(b,this.port|5,this,function(){var e=Y(this);if(0===e)return K("Unimplemented: Read pg0/05 (NCR: Number of Collisions Register)",1048576),0;if(1===e)return K("Read pg1/05 (mac[4])",1048576),this.ia[4];3===e?K("Unimplemented: Read pg3/05 (CONFIG2)",
1048576):(K("Read pg"+e+"/05",1048576),l(!1));return 0});T(b,this.port|5,this,function(e){var f=Y(this);0===f?(K("Write tcnt low: "+B(e,2),1048576),this.Ke=this.Ke&-256|e):1===f?(K("mac[4] = "+B(e),1048576),this.ia[4]=e):3===f?K("Unimplemented: Write pg3/05 (CONFIG2): "+B(e),1048576):(K("Write pg"+f+"/05: "+B(e),1048576),l(!1))});M(b,this.port|6,this,function(){var e=Y(this);if(0===e)return l(!1,"TODO"),0;if(1===e)return K("Read pg1/06 (mac[5])",1048576),this.ia[5];3===e?K("Unimplemented: Read pg3/06 (CONFIG3)",
1048576):(K("Read pg"+e+"/06",1048576),l(!1));return 0});T(b,this.port|6,this,function(e){var f=Y(this);0===f?(K("Write tcnt high: "+B(e,2),1048576),this.Ke=this.Ke&255|e<<8):1===f?(K("mac[5] = "+B(e),1048576),this.ia[5]=e):3===f?K("Unimplemented: Write pg3/06 (CONFIG3): "+B(e),1048576):(K("Write pg"+f+"/06: "+B(e),1048576),l(!1))});M(b,this.port|12,this,function(){var e=Y(this);if(0===e)return 9;if(1===e)return K("Read mar4",1048576),this.Ed[4];K("Unimplemented: Read pg"+e+"/0c",1048576);l(!1);return 0});
T(b,this.port|12,this,function(e){var f=Y(this);0===f?(K("RX configuration reg write: "+B(e,2),1048576),this.ff=e):K("Unimplemented: Write pg"+f+"/0c: "+B(e),1048576)});M(b,this.port|16,this,this.ij,this.vh,this.hj);T(b,this.port|16,this,this.wh,this.wh,this.jj);jc(a.v.kb,this)}k=Wd.prototype;
k.ea=function(){var a=[];a[0]=this.Xa;a[1]=this.ng;a[2]=this.Ra;a[3]=this.rf;a[4]=this.nc;a[5]=this.Ke;a[6]=this.Fg;a[7]=this.Ha;a[8]=this.mc;a[9]=this.Ob;a[10]=this.qc;a[11]=this.qb;a[12]=this.ff;a[13]=this.Hg;a[14]=this.kh;a[15]=this.ia;a[16]=this.memory;return a};
k.I=function(a){this.Xa=a[0];this.ng=a[1];this.Ra=a[2];this.rf=a[3];this.nc=a[4];this.Ke=a[5];this.Fg=a[6];this.Ha=a[7];this.mc=a[8];this.Ob=a[9];this.qc=a[10];this.qb=a[11];this.ff=a[12];this.Hg=a[13];this.kh=a[14];this.Ge?(this.ia=a[15],this.memory=a[16]):this.Vb&&(this.af=a[15],this.memory=a[16],K("Using mac address translation guest_os_mac="+Vd(this.af)+" real_mac="+Vd(this.ia),1048576));this.A.send("net"+this.id+"-mac",Vd(this.ia))};
function Xd(a,b){K("Do interrupt "+B(b,2),1048576);a.Xa|=b;Yd(a)}function Yd(a){a.ng&a.Xa?a.kb.Za(a.Ta):Ec(a.kb,a.Ta)}function Zd(a,b){if(16>=a.Ha||16384<=a.Ha&&32768>a.Ha)a.memory[a.Ha]=b;a.Ha++;a.nc--;a.Ha>=a.qb<<8&&(a.Ha+=a.mc-a.qb<<8);0===a.nc&&Xd(a,64)}k.wh=function(a){Zd(this,a);this.rf&1&&Zd(this,a>>8)};k.jj=function(a){Zd(this,a);Zd(this,a>>8);Zd(this,a>>16);Zd(this,a>>24)};
function $d(a){let b=0;32768>a.Ha&&(b=a.memory[a.Ha]);a.Ha++;a.nc--;a.Ha>=a.qb<<8&&(a.Ha+=a.mc-a.qb<<8);0===a.nc&&Xd(a,64);return b}k.ij=function(){return this.vh()&255};k.vh=function(){return this.rf&1?$d(this)|$d(this)<<8:$d(this)};k.hj=function(){return $d(this)|$d(this)<<8|$d(this)<<16|$d(this)<<24};
k.Pa=function(a){if(!(this.Ra&1)&&(this.A.send("eth-receive-end",[a.length]),this.ff&16||this.ff&4&&255===a[0]&&255===a[1]&&255===a[2]&&255===a[3]&&255===a[4]&&255===a[5]||!(this.ff&8&&1===(a[0]&1)||a[0]!==this.ia[0]||a[1]!==this.ia[1]||a[2]!==this.ia[2]||a[3]!==this.ia[3]||a[4]!==this.ia[4]||a[5]!==this.ia[5]))){this.af&&(a=new Uint8Array(a),Ud(a,this.ia,this.af));var b=this.Ob<<8,c=Math.max(60,a.length)+4,d=b+4,e=this.Ob+1+(c>>8),f=b+c,h=1+(c>>8),g=this.qc>this.Ob?this.qc-this.Ob:this.qb-this.Ob+
this.qc-this.mc;g<h&&0!==this.qc?K("Buffer full, dropping packet pstart="+B(this.mc)+" pstop="+B(this.qb)+" curpg="+B(this.Ob)+" needed="+B(h)+" boundary="+B(this.qc)+" available="+B(g),1048576):(f>this.qb<<8?(l(60<=a.length),f=(this.qb<<8)-d,l(0<=f),this.memory.set(a.subarray(0,f),d),this.memory.set(a.subarray(f),this.mc<<8),K("rcv cut="+B(f),1048576)):(this.memory.set(a,d),60>a.length&&this.memory.fill(0,d+a.length,d+60)),e>=this.qb&&(e+=this.mc-this.qb),this.memory[b]=1,this.memory[b+1]=e,this.memory[b+
2]=c,this.memory[b+3]=c>>8,this.Ob=e,K("rcv offset="+B(b)+" len="+B(c)+" next="+B(e),1048576),Xd(this,1))}};function Y(a){return a.Ra>>6&3};var ee=new Uint8Array(256),fe=[],ge=[],he=[],ie=new Uint8Array(256),je=[];
function ke(a,b){this.s=a;this.A=b;this.Wa=new Rb(64);this.ra=new Rb(64);this.h=this.u=this.Nb=this.o=0;this.T=new Uint8Array(256);le(this);this.Ye=!1;this.Of=0;this.ic=this.hc=this.re=this.Yc=!1;this.rc=[new Sb,new Sb];this.Pb=a.v.Pb;this.Qb=this.Xc=this.j=this.uc=this.l=this.G=0;this.vc=1;this.qe=5;this.tc=!1;this.g=new ArrayBuffer(65536);this.aa=new Int8Array(this.g);this.D=new Uint8Array(this.g);this.Z=new Int16Array(this.g);this.fa=new Uint16Array(this.g);this.Qa=new Lb(this.g);this.wc=this.C=
!1;this.Ib=22050;b.send("dac-tell-sampling-rate",this.Ib);this.i=1;this.P=170;this.N=0;this.me=new Uint8Array(256);this.J=new Rb(64);this.U=this.R=this.X=0;this.Dj=!1;this.na=5;this.ve=new Uint8Array(16);a.B.Ie(544,this,this.$h,this.bi,this.Yj,this.$j);a.B.Ie(904,this,this.$h,this.bi);a.B.Ie(548,this,this.bk,this.dk);M(a.B,550,this,this.fk);M(a.B,551,this,this.hk);M(a.B,552,this,this.jk);M(a.B,553,this,this.lk);M(a.B,554,this,this.nk);M(a.B,555,this,this.qk);M(a.B,556,this,this.sk);M(a.B,557,this,
this.uk);a.B.Ie(558,this,this.wk,this.yk);a.B.nd(544,this,this.ai,this.ci,this.Zj,this.ak);a.B.nd(904,this,this.ai,this.ci);a.B.nd(548,this,this.ck,this.ek);T(a.B,550,this,this.gk);T(a.B,551,this,this.ik);a.B.nd(552,this,this.kk,this.mk);T(a.B,554,this,this.pk);T(a.B,555,this,this.rk);T(a.B,556,this,this.tk);T(a.B,557,this,this.vk);T(a.B,558,this,this.xk);T(a.B,559,this,this.zk);a.B.Ie(816,this,this.bl,this.dl);a.B.nd(816,this,this.cl,this.el);this.Pb.Ig.push({mg:this.qa,hh:this});b.register("dac-request-data",
function(){!this.uc||this.wc?me(this):ne(this)},this);b.register("speaker-has-initialized",function(){le(this)},this);b.send("speaker-confirm-initialized");oe(this)}function oe(a){a.Wa.clear();a.ra.clear();a.Nb=0;a.u=0;a.Ye=!1;a.Of=0;a.Yc=!1;a.re=!1;a.hc=!1;a.ic=!1;a.rc[0].clear();a.rc[1].clear();a.G=0;a.l=0;a.uc=0;a.j=0;a.Xc=0;a.Qb=0;a.tc=!1;a.D.fill(0);a.C=!1;a.wc=!1;a.P=170;a.N=0;a.Ib=22050;a.i=1;pe(a,1);a.ve.fill(0);a.me.fill(0);a.me[5]=1;a.me[9]=248}k=ke.prototype;
k.ea=function(){var a=[];a[2]=this.o;a[3]=this.Nb;a[4]=this.u;a[5]=this.h;a[6]=this.T;a[7]=this.Ye;a[8]=this.Of;a[9]=this.Yc;a[10]=this.re;a[11]=this.hc;a[12]=this.ic;a[15]=this.G;a[16]=this.l;a[17]=this.uc;a[18]=this.j;a[19]=this.Xc;a[20]=this.Qb;a[21]=this.vc;a[22]=this.qe;a[23]=this.tc;a[24]=this.D;a[25]=this.C;a[26]=this.wc;a[27]=this.Ib;a[28]=this.i;a[29]=this.P;a[30]=this.N;a[31]=this.me;a[33]=this.mb;a[34]=this.na;a[35]=this.ve;return a};
k.I=function(a){this.o=a[2];this.Nb=a[3];this.u=a[4];this.h=a[5];this.T=a[6];qe(this);this.Ye=a[7];this.Of=a[8];this.Yc=a[9];this.re=a[10];this.hc=a[11];this.ic=a[12];this.G=a[15];this.l=a[16];this.uc=a[17];this.j=a[18];this.Xc=a[19];this.Qb=a[20];this.vc=a[21];this.qe=a[22];this.tc=a[23];this.D=a[24];this.C=a[25];this.wc=a[26];this.Ib=a[27];this.i=a[28];this.P=a[29];this.N=a[30];this.me=a[31];this.mb=a[33];this.na=a[34];this.ve=a[35];this.g=this.D.buffer;this.aa=new Int8Array(this.g);this.Z=new Int16Array(this.g);
this.fa=new Uint16Array(this.g);this.Qa=new Lb(this.g);this.wc?this.A.send("dac-disable"):this.A.send("dac-enable")};k.$h=function(){K("220 read: fm music status port (unimplemented)",8388608);return 255};k.bi=function(){K("221 read: fm music data port (write only)",8388608);return 255};k.Yj=function(){K("222 read: advanced fm music status port (unimplemented)",8388608);return 255};k.$j=function(){K("223 read: advanced music data port (write only)",8388608);return 255};
k.bk=function(){K("224 read: mixer address port",8388608);return this.h};k.dk=function(){K("225 read: mixer data port",8388608);var a=this.h,b=ge[a];b?b=b.call(this):(b=this.T[a],K("unhandled mixer register read. addr:"+B(a)+" data:"+B(b),8388608));return b};k.fk=function(){K("226 read: (write only)",8388608);return 255};k.hk=function(){K("227 read: undocumented",8388608);return 255};k.jk=function(){K("228 read: fm music status port (unimplemented)",8388608);return 255};
k.lk=function(){K("229 read: fm music data port (write only)",8388608);return 255};k.nk=function(){K("22A read: read data",8388608);this.ra.length&&(this.o=this.ra.shift());K(" <- "+this.o+" "+B(this.o)+" '"+String.fromCharCode(this.o)+"'",8388608);return this.o};k.qk=function(){K("22B read: undocumented",8388608);return 255};k.sk=function(){K("22C read: write-buffer status",8388608);return 127};k.uk=function(){K("22D read: undocumented",8388608);return 255};
k.wk=function(){K("22E read: read-buffer status / irq 8bit ack.",8388608);this.ve[1]&&pe(this,1);return(this.ra.length&&!this.Yc)<<7|127};k.yk=function(){K("22F read: irq 16bit ack",8388608);pe(this,2);return 0};k.ai=function(a){K("220 write: (unimplemented) fm register 0 address = "+B(a),8388608);this.R=0};k.ci=function(a){K("221 write: (unimplemented) fm register 0 data = "+B(a),8388608);var b=je[this.R];b||(b=this.lg);b.call(this,a,0,this.R)};
k.Zj=function(a){K("222 write: (unimplemented) fm register 1 address = "+B(a),8388608);this.U=0};k.ak=function(a){K("223 write: (unimplemented) fm register 1 data ="+B(a),8388608);var b=je[this.U];b||(b=this.lg);b.call(this,a,1,this.U)};k.ck=function(a){K("224 write: mixer address = "+B(a),8388608);this.h=a};k.ek=function(a){K("225 write: mixer data = "+B(a),8388608);re(this,this.h,a)};
k.gk=function(a){K("226 write: reset = "+B(a),8388608);this.Yc?(K(" -> exit highspeed",8388608),this.Yc=!1):a&&(K(" -> reset",8388608),oe(this));this.ra.clear();this.ra.push(170)};k.ik=function(){K("227 write: undocumented",8388608)};k.kk=function(){K("228 write: fm music register port (unimplemented)",8388608)};k.mk=function(){K("229 write: fm music data port (unimplemented)",8388608)};k.pk=function(){K("22A write: dsp read data port (read only)",8388608)};
k.rk=function(){K("22B write: undocumented",8388608)};k.tk=function(a){K("22C write: write command/data",8388608);0===this.Nb?(K("22C write: command = "+B(a),8388608),this.Nb=a,this.Wa.clear(),this.u=ee[a]):(K("22C write: data: "+B(a),8388608),this.Wa.push(a));this.Wa.length>=this.u&&(a=fe[this.Nb],a||(a=this.eg),a.call(this),this.u=this.Nb=0,this.Wa.clear())};k.vk=function(){K("22D write: undocumented",8388608)};k.xk=function(){K("22E write: dsp read buffer status (read only)",8388608)};
k.zk=function(){K("22F write: undocumented",8388608)};k.bl=function(){K("330 read: mpu data",8388608);this.J.length&&(this.X=this.J.shift());K(" <- "+B(this.X),8388608);return this.X};k.cl=function(a){K("330 write: mpu data (unimplemented) : "+B(a),8388608)};k.dl=function(){K("331 read: mpu status",8388608);return 0|128*!this.J.length};k.el=function(a){K("331 write: mpu command: "+B(a),8388608);255===a&&(this.J.clear(),this.J.push(254))};k.eg=function(){K("Unhandled command: "+B(this.Nb),8388608)};
function Z(a,b,c){c||(c=ke.prototype.eg);for(var d=0;d<a.length;d++)ee[a[d]]=b,fe[a[d]]=c}function se(a){for(var b=[],c=0;16>c;c++)b.push(a+c);return b}Z([14],2,function(){this.me[this.Wa.shift()]=this.Wa.shift()});Z([15],1,function(){this.ra.clear();this.ra.push(this.me[this.Wa.shift()])});Z([16],1,function(){var a=this.Wa.shift();a=te(a/127.5+-1);this.rc[0].push(a);this.rc[1].push(a);this.A.send("dac-enable")});
Z([20,21],2,function(){this.Xc=1;this.Qb=this.vc;this.Yc=this.hc=this.ic=this.tc=!1;ue(this);ve(this)});Z([22],2);Z([23],2);Z([28],0,function(){this.Xc=1;this.Qb=this.vc;this.tc=!0;this.Yc=this.hc=this.ic=!1;ve(this)});Z([31],0);Z([32],0,function(){this.ra.clear();this.ra.push(127)});Z([36],2);Z([44],0);Z([48],0);Z([49],0);Z([52],0);Z([53],0);Z([54],0);Z([55],0);Z([56],0);Z([64],1,function(){we(this,1E6/(256-this.Wa.shift())/(this.re?2:1))});Z([65,66],2,function(){we(this,this.Wa.shift()<<8|this.Wa.shift())});
Z([72],2,function(){ue(this)});Z([116],2);Z([117],2);Z([118],2);Z([119],2);Z([125],0);Z([127],0);Z([128],2);Z([144],0,function(){this.Xc=1;this.Qb=this.vc;this.tc=!0;this.ic=!1;this.Yc=!0;this.hc=!1;ve(this)});Z([145],0);Z([152],0);Z([153],0);Z([160],0);Z([168],0);Z(se(176),3,function(){if(this.Nb&8)this.eg();else{var a=this.Wa.shift();this.Xc=2;this.Qb=this.qe;this.tc=!!(this.Nb&4);this.ic=!!(a&16);this.re=!!(a&32);this.hc=!0;ue(this);ve(this)}});
Z(se(192),3,function(){if(this.Nb&8)this.eg();else{var a=this.Wa.shift();this.Xc=1;this.Qb=this.vc;this.tc=!!(this.Nb&4);this.ic=!!(a&16);this.re=!!(a&32);this.hc=!1;ue(this);ve(this)}});Z([208],0,function(){this.wc=!0;this.A.send("dac-disable")});Z([209],0,function(){this.Ye=!0});Z([211],0,function(){this.Ye=!1});Z([212],0,function(){this.wc=!1;this.A.send("dac-enable")});Z([213],0,function(){this.wc=!0;this.A.send("dac-disable")});Z([214],0,function(){this.wc=!1;this.A.send("dac-enable")});
Z([216],0,function(){this.ra.clear();this.ra.push(255*this.Ye)});Z([217,218],0,function(){this.tc=!1});Z([224],1,function(){this.ra.clear();this.ra.push(~this.Wa.shift())});Z([225],0,function(){this.ra.clear();this.ra.push(4);this.ra.push(5)});Z([226],1);Z([227],0,function(){this.ra.clear();for(var a=0;44>a;a++)this.ra.push("COPYRIGHT (C) CREATIVE TECHNOLOGY LTD, 1992.".charCodeAt(a));this.ra.push(0)});Z([228],1,function(){this.Of=this.Wa.shift()});Z([232],0,function(){this.ra.clear();this.ra.push(this.Of)});
Z([242,243],0,function(){this.Za()});var xe=new Uint8Array(256);xe[14]=255;xe[15]=7;xe[55]=56;Z([249],1,function(){var a=this.Wa.shift();K("dsp 0xf9: unknown function. input: "+a,8388608);this.ra.clear();this.ra.push(xe[a])});function re(a,b,c){var d=he[b];d?d.call(a,c):K("unhandled mixer register write. addr:"+B(b)+" data:"+B(c),8388608)}ke.prototype.bb=function(){K("mixer register read. addr:"+B(this.h),8388608);return this.T[this.h]};
ke.prototype.lb=function(a){K("mixer register write. addr:"+B(this.h)+" data:"+B(a),8388608);this.T[this.h]=a};function le(a){a.T[4]=204;a.T[34]=204;a.T[38]=204;a.T[40]=0;a.T[46]=0;a.T[10]=0;a.T[48]=192;a.T[49]=192;a.T[50]=192;a.T[51]=192;a.T[52]=192;a.T[53]=192;a.T[54]=0;a.T[55]=0;a.T[56]=0;a.T[57]=0;a.T[59]=0;a.T[60]=31;a.T[61]=21;a.T[62]=11;a.T[63]=0;a.T[64]=0;a.T[65]=0;a.T[66]=0;a.T[67]=0;a.T[68]=128;a.T[69]=128;a.T[70]=128;a.T[71]=128;qe(a)}
function qe(a){for(var b=1;b<a.T.length;b++)ie[b]||re(a,b,a.T[b])}function ye(a,b){b||(b=ke.prototype.bb);ge[a]=b}function ze(a,b){b||(b=ke.prototype.lb);he[a]=b}function Ae(a,b,c){ie[a]=1;ge[a]=function(){return this.T[b]&240|this.T[c]>>>4};he[a]=function(d){this.T[a]=d;var e=d<<4&240|this.T[c]&15;re(this,b,d&240|this.T[b]&15);re(this,c,e)}}function Be(a,b,c){ge[a]=ke.prototype.bb;he[a]=function(d){this.T[a]=d;this.A.send("mixer-volume",[b,c,(d>>>2)-62])}}ye(0,function(){le(this);return 0});ze(0);
Ae(4,50,51);Ae(34,48,49);Ae(38,52,53);Ae(40,54,55);Ae(46,56,57);Be(48,0,0);Be(49,0,1);Be(50,2,0);Be(51,2,1);ye(59);ze(59,function(a){this.T[59]=a;this.A.send("mixer-volume",[1,2,6*(a>>>6)-18])});ye(65);ze(65,function(a){this.T[65]=a;this.A.send("mixer-gain-left",6*(a>>>6))});ye(66);ze(66,function(a){this.T[66]=a;this.A.send("mixer-gain-right",6*(a>>>6))});ye(68);ze(68,function(a){this.T[68]=a;a>>>=3;this.A.send("mixer-treble-left",a-(16>a?14:16))});ye(69);
ze(69,function(a){this.T[69]=a;a>>>=3;this.A.send("mixer-treble-right",a-(16>a?14:16))});ye(70);ze(70,function(a){this.T[70]=a;a>>>=3;this.A.send("mixer-bass-right",a-(16>a?14:16))});ye(71);ze(71,function(a){this.T[71]=a;a>>>=3;this.A.send("mixer-bass-right",a-(16>a?14:16))});ye(128,function(){switch(this.na){case 2:return 1;case 5:return 2;case 7:return 4;case 10:return 8;default:return 0}});ze(128,function(a){a&1&&(this.na=2);a&2&&(this.na=5);a&4&&(this.na=7);a&8&&(this.na=10)});
ye(129,function(){var a=0;switch(this.vc){case 0:a|=1;break;case 1:a|=2;break;case 3:a|=8}switch(this.qe){case 5:a|=32;break;case 6:a|=64;break;case 7:a|=128}return a});ze(129,function(a){a&1&&(this.vc=0);a&2&&(this.vc=1);a&8&&(this.vc=3);a&32&&(this.qe=5);a&64&&(this.qe=6);a&128&&(this.qe=7)});ye(130,function(){for(var a=32,b=0;16>b;b++)a|=b*this.ve[b];return a});ke.prototype.lg=function(a,b,c){K("unhandled fm register write. addr:"+b+"|"+B(c)+" data:"+B(a),8388608)};
function Ce(a,b){b||(b=ke.prototype.lg);for(var c=0;c<a.length;c++)je[a[c]]=b}function De(a,b){for(var c=[];a<=b;a++)c.push(a);return c}var Ee=new Uint8Array(32);Ee[0]=0;Ee[1]=1;Ee[2]=2;Ee[3]=3;Ee[4]=4;Ee[5]=5;Ee[8]=6;Ee[9]=7;Ee[10]=8;Ee[11]=9;Ee[12]=10;Ee[13]=11;Ee[16]=12;Ee[17]=13;Ee[18]=14;Ee[19]=15;Ee[20]=16;Ee[21]=17;Ce([1],function(a,b){this.Dj[b]=a&1});Ce([2]);Ce([3]);Ce([4],function(){});Ce([5],function(a,b,c){0===b&&this.lg(a,b,c)});Ce([8],function(){});Ce(De(32,53),function(){});
Ce(De(64,85),function(){});Ce(De(96,117),function(){});Ce(De(128,149),function(){});Ce(De(160,168),function(){});Ce(De(176,184),function(){});Ce([189],function(){});Ce(De(192,200),function(){});Ce(De(224,245),function(){});function we(a,b){a.Ib=b;a.A.send("dac-tell-sampling-rate",b)}function ue(a){a.G=1+(a.Wa.shift()<<0)+(a.Wa.shift()<<8)}
function ve(a){K("begin dma transfer",8388608);a.i=1;a.hc&&(a.i*=2);a.l=a.G*a.i;a.j=1024*a.i;a.j=Math.min(Math.max(a.l>>2&-4,32),a.j);a.C=!0;a.Pb.Vc[a.Qb]||a.qa(a.Qb)}ke.prototype.qa=function(a){a===this.Qb&&this.C&&(this.C=!1,this.uc=this.l,this.wc=!1,this.A.send("dac-enable"))};
function ne(a){K("dma transfering next block",8388608);var b=Math.min(a.uc,a.j),c=Math.floor(b/a.i);a.Pb.tf(a.Qa,0,b,a.Qb,d=>{K("dma block transfer "+(d?"unsuccessful":"successful"),8388608);if(!d){d=a.hc?32767.5:127.5;var e=a.ic?0:-1,f=a.re?1:2,h;a.hc?h=a.ic?a.Z:a.fa:h=a.ic?a.aa:a.D;for(var g=0,m=0;m<c;m++)for(var n=te(h[m]/d+e),p=0;p<f;p++)a.rc[g].push(n),g^=1;me(a);a.uc-=b;a.uc||(a.Za(a.Xc),a.tc&&(a.uc=a.l))}})}
function me(a){if(a.rc[0].length){var b=Tb(a.rc[0],a.rc[0].length),c=Tb(a.rc[1],a.rc[1].length);a.A.send("dac-send-data",[b,c],[b.buffer,c.buffer])}}ke.prototype.Za=function(a){K("raise irq",8388608);this.ve[a]=1;this.s.cb(this.na)};function pe(a,b){K("lower irq",8388608);a.ve[b]=0;$b(a.s,a.na)}function te(a){return-1*(-1>a)+1*(1<a)+(-1<=a&&1>=a)*a};function ha(a,b){this.s=a;this.kb=a.v.kb;this.Xe=b.Xe;this.O=[244,26,b.Xe&255,b.Xe>>8,7,5,16,0,1,0,2,0,0,0,0,0,1,168,0,0,0,16,191,254,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,244,26,b.Eg&255,b.Eg>>8,0,0,0,0,64,0,0,0,0,0,0,0,0,1,0,0];this.O=this.O.concat(Array(256-this.O.length).fill(0));this.Ta=b.Ta;this.Gb=[];this.name=b.name;this.i=this.u=0;this.o=new Uint32Array(4);this.h=new Uint32Array(4);for(var c of b.Ve.features)l(0<=c,"VirtIO device<"+this.name+"> feature bit numbers must be non-negative"),
l(128>c,"VirtIO device<"+this.name+"> feature bit numbers assumed less than 128 in implementation"),this.o[c>>>5]|=1<<(c&31),this.h[c>>>5]|=1<<(c&31);l(b.Ve.features.includes(32),"VirtIO device<"+this.name+"> only non-transitional devices are supported");this.C=!0;this.j=0;this.G=!1;this.D=0;this.$=[];for(var d of b.Ve.$)this.$.push(new Fe(a,this,d));this.l=0;this.g=this.$[0];this.Ic=0;c=new Set;for(var e of this.$.map(f=>f.pb))d=b.notification.Cg?0:e,c.add(d),l(b.notification.$e[d],"VirtIO device<"+
this.name+"> every queue's notifier must exist");for(const [f,h]of b.notification.$e.entries())l(!h||c.has(f),"VirtIO device<"+this.name+"> no defined notify handler should be unused");e=[];e.push(Ge(this,b.Ve));e.push(He(this,b.notification));e.push(Ie(this,b.Ic));b.cg&&e.push(Je(this,b.cg));Ke(this,e);jc(a.v.kb,this);this.reset()}
function Ge(a,b){return{type:1,vd:0,port:b.ob,Qf:!1,offset:0,vf:new Uint8Array(0),qd:[{bytes:4,name:"device_feature_select",read:()=>a.u,write:c=>{a.u=c}},{bytes:4,name:"device_feature",read:()=>a.o[a.u]||0,write:()=>{}},{bytes:4,name:"driver_feature_select",read:()=>a.i,write:c=>{a.i=c}},{bytes:4,name:"driver_feature",read:()=>a.h[a.i]||0,write:c=>{const d=a.o[a.i];a.i<a.h.length&&(a.h[a.i]=c&d);a.C=a.C&&!(c&~d)}},{bytes:2,name:"msix_config",read:()=>{K("No msi-x capability supported.",2097152);
return 65535},write:()=>{K("No msi-x capability supported.",2097152)}},{bytes:2,name:"num_queues",read:()=>a.$.length,write:()=>{}},{bytes:1,name:"device_status",read:()=>a.j,write:c=>{0===c?(K("Reset device<"+a.name+">",2097152),a.reset()):c&128?K("Warning: Device<"+a.name+"> status failed",2097152):K("Device<"+a.name+"> status: "+(c&1?"ACKNOWLEDGE ":"")+(c&2?"DRIVER ":"")+(c&4?"DRIVER_OK":"")+(c&8?"FEATURES_OK ":"")+(c&64?"DEVICE_NEEDS_RESET":""),2097152);c&~a.j&4&&a.j&64&&(a.G=!0,a.j&4?a.Za(2):
l(!1,"VirtIO device<"+a.name+"> attempted to notify driver before DRIVER_OK"));a.C||(c&8&&K("Removing FEATURES_OK",2097152),c&=-9);a.j=c}},{bytes:1,name:"config_generation",read:()=>a.D,write:()=>{}},{bytes:2,name:"queue_select",read:()=>a.l,write:c=>{a.l=c;a.l<a.$.length?a.g=a.$[a.l]:a.g=null}},{bytes:2,name:"queue_size",read:()=>a.g?a.g.size:0,write:c=>{a.g&&(c&c-1&&(K("Warning: dev<"+a.name+"> Given queue size was not a power of 2. Rounding up to next power of 2.",2097152),c=1<<Kb(c-1)+1),c>a.g.ab&&
(K("Warning: dev<"+a.name+"> Trying to set queue size greater than supported. Clamping to supported size.",2097152),c=a.g.ab),Le(a.g,c))}},{bytes:2,name:"queue_msix_vector",read:()=>{K("No msi-x capability supported.",2097152);return 65535},write:()=>{K("No msi-x capability supported.",2097152)}},{bytes:2,name:"queue_enable",read:()=>a.g?a.g.enabled|0:0,write:c=>{a.g&&(1===c?Me(a.g)?(c=a.g,l(Me(c),"VirtQueue must be configured before enabled"),c.enabled=!0):K("Driver bug: tried enabling unconfigured queue",
2097152):0===c&&K("Driver bug: tried writing 0 to queue_enable",2097152))}},{bytes:2,name:"queue_notify_off",read:()=>a.g?a.g.pb:0,write:()=>{}},{bytes:4,name:"queue_desc (low dword)",read:()=>a.g?a.g.l:0,write:c=>{a.g&&(a.g.l=c)}},{bytes:4,name:"queue_desc (high dword)",read:()=>0,write:c=>{0!==c&&K("Warning: High dword of 64 bit queue_desc ignored:"+c,2097152)}},{bytes:4,name:"queue_avail (low dword)",read:()=>a.g?a.g.g:0,write:c=>{a.g&&(a.g.g=c)}},{bytes:4,name:"queue_avail (high dword)",read:()=>
0,write:c=>{0!==c&&K("Warning: High dword of 64 bit queue_avail ignored:"+c,2097152)}},{bytes:4,name:"queue_used (low dword)",read:()=>a.g?a.g.h:0,write:c=>{a.g&&(a.g.h=c)}},{bytes:4,name:"queue_used (high dword)",read:()=>0,write:c=>{0!==c&&K("Warning: High dword of 64 bit queue_used ignored:"+c,2097152)}}]}}
function He(a,b){const c=[];b.Cg?(l(1===b.$e.length,"VirtIO device<"+a.name+"> too many notify handlers specified: expected single handler"),a=0):a=2;for(const [d,e]of b.$e.entries())c.push({bytes:2,name:"notify"+d,read:()=>65535,write:e||(()=>{})});return{type:2,vd:1,port:b.ob,Qf:!1,offset:0,vf:new Uint8Array([a&255,a>>8&255,a>>16&255,a>>24]),qd:c}}
function Ie(a,b){return{type:3,vd:2,port:b.ob,Qf:!1,offset:0,vf:new Uint8Array(0),qd:[{bytes:1,name:"isr_status",read:()=>{const c=a.Ic;Ne(a);return c},write:()=>{}}]}}function Je(a,b){l(~b.offset&3,"VirtIO device<"+a.name+"> device specific cap offset must be 4-byte aligned");return{type:4,vd:3,port:b.ob,Qf:!1,offset:0,vf:new Uint8Array(0),qd:b.qd}}
function Ke(a,b){let c=a.O[52]=64;var d=c;for(const f of b){b=16+f.vf.length;d=c;c=d+b;l(256>=c,"VirtIO device<"+a.name+"> can't fit all capabilities into 256byte configspace");l(0<=f.vd&&6>f.vd,"VirtIO device<"+a.name+"> capability invalid bar number");var e=f.qd.reduce((h,g)=>h+g.bytes,0);e+=f.offset;e=16>e?16:1<<Kb(e-1)+1;l(0===(f.port&e-1),"VirtIO device<"+a.name+"> capability port should be aligned to pci bar size");a.Gb[f.vd]={size:e};a.O[d]=9;a.O[d+1]=c;a.O[d+2]=b;a.O[d+3]=f.type;a.O[d+4]=
f.vd;a.O[d+5]=0;a.O[d+6]=0;a.O[d+7]=0;a.O[d+8]=f.offset&255;a.O[d+9]=f.offset>>>8&255;a.O[d+10]=f.offset>>>16&255;a.O[d+11]=f.offset>>>24;a.O[d+12]=e&255;a.O[d+13]=e>>>8&255;a.O[d+14]=e>>>16&255;a.O[d+15]=e>>>24;for(const [h,g]of f.vf.entries())a.O[d+16+h]=g;d=16+4*f.vd;a.O[d]=f.port&254|!f.Qf;a.O[d+1]=f.port>>>8&255;a.O[d+2]=f.port>>>16&255;a.O[d+3]=f.port>>>24&255;d=f.port+f.offset;for(const h of f.qd){let g=h.read;b=h.write;g=()=>{const m=h.read();K("Device<"+a.name+"> cap["+f.type+"] read["+h.name+
"] => "+B(m,8*h.bytes),2097152);return m};b=m=>{K("Device<"+a.name+"> cap["+f.type+"] write["+h.name+"] <= "+B(m,8*h.bytes),2097152);h.write(m)};if(f.Qf)l(!1,"VirtIO device <"+a.name+"> mmio capability not implemented.");else{e=function(n){K("Warning: 8-bit read from 16-bit virtio port",2097152);return g(n&-2)>>((n&1)<<3)&255};const m=function(n){K("Warning: 8-bit read from 32-bit virtio port",2097152);return g(n&-4)>>((n&3)<<3)&255};switch(h.bytes){case 4:M(a.s.B,d,a,m,void 0,g);T(a.s.B,d,a,void 0,
void 0,b);break;case 2:M(a.s.B,d,a,e,g);T(a.s.B,d,a,void 0,b);break;case 1:M(a.s.B,d,a,g);T(a.s.B,d,a,b);break;default:l(!1,"VirtIO device <"+a.name+"> invalid capability field width of "+h.bytes+" bytes")}}d+=h.bytes}}l(256>=c+20,"VirtIO device<"+a.name+"> can't fit all capabilities into 256byte configspace");a.O[c]=9;a.O[c+1]=0;a.O[c+2]=20;a.O[c+3]=5;a.O[c+4]=0;a.O[c+5]=0;a.O[c+6]=0;a.O[c+7]=0;a.O[c+8]=0;a.O[c+9]=0;a.O[c+10]=0;a.O[c+11]=0;a.O[c+12]=0;a.O[c+13]=0;a.O[c+14]=0;a.O[c+15]=0;a.O[c+16]=
0;a.O[c+17]=0;a.O[c+18]=0;a.O[c+19]=0}ha.prototype.ea=function(){let a=[];a[0]=this.u;a[1]=this.i;a[2]=this.o;a[3]=this.h;a[4]=this.C;a[5]=this.j;a[6]=this.G;a[7]=this.D;a[8]=this.Ic;a[9]=this.l;return a=a.concat(this.$)};ha.prototype.I=function(a){this.u=a[0];this.i=a[1];this.o=a[2];this.h=a[3];this.C=a[4];this.j=a[5];this.G=a[6];this.D=a[7];this.Ic=a[8];this.l=a[9];let b=0;for(const c of a.slice(10))this.$[b].I(c),b++;this.g=this.$[this.l]||null};
ha.prototype.reset=function(){this.i=this.u=0;this.h.set(this.o);this.C=!0;this.l=this.j=0;this.g=this.$[0];for(const a of this.$)a.reset();this.G=!1;this.D=0;Ne(this)};ha.prototype.Za=function(a){K("Raise irq "+B(a),2097152);this.Ic|=a;this.kb.Za(this.Ta)};function Ne(a){K("Lower irq ",2097152);a.Ic=0;Ec(a.kb,a.Ta)}function Fe(a,b,c){this.s=a;this.V=b;this.ab=this.size=c.ab;this.dd=this.size-1;this.enabled=!1;this.pb=c.pb;this.j=this.h=this.i=this.g=this.l=0;this.reset()}
Fe.prototype.ea=function(){const a=[];a[0]=this.size;a[1]=this.ab;a[2]=this.enabled;a[3]=this.pb;a[4]=this.l;a[5]=this.g;a[6]=this.i;a[7]=this.h;a[8]=this.j;return a};Fe.prototype.I=function(a){this.size=a[0];this.ab=a[1];this.enabled=a[2];this.pb=a[3];this.l=a[4];this.g=a[5];this.i=a[6];this.h=a[7];this.j=a[8];this.dd=this.size-1};Fe.prototype.reset=function(){this.enabled=!1;this.j=this.h=this.i=this.g=this.l=0;Le(this,this.ab)};function Me(a){return a.l&&a.g&&a.h}
function Le(a,b){l(0===(b&b-1),"VirtQueue size must be power of 2 or zero");l(b<=a.ab,"VirtQueue size must be within supported size");a.size=b;a.dd=b-1}function Oe(a){l(a.g,"VirtQueue addresses must be configured before use");return a.s.Da(a.g+2)-a.i&a.dd}function ia(a){l(a.g,"VirtQueue addresses must be configured before use");return(a.s.Da(a.g+2)&a.dd)!==a.i}
function ja(a){l(a.g,"VirtQueue addresses must be configured before use");l(ia(a),"VirtQueue must not pop nonexistent request");var b=a.s.Da(a.g+4+2*a.i);K("Pop request: avail_last_idx="+a.i+" desc_idx="+b,2097152);b=new Pe(a,b);a.i=a.i+1&a.dd;return b}
function ra(a,b){l(a.h,"VirtQueue addresses must be configured before use");l(a.j<a.size,"VirtQueue replies must not exceed queue size");const c=a.s.Da(a.h+2)+a.j&a.dd;K("Push reply: used_idx="+c+" desc_idx="+b.C,2097152);var d=b.i;a.s.wa(a.h+4+8*c,b.C);a.s.wa(a.h+8+8*c,d);a.j++}
function sa(a){l(a.h,"VirtQueue addresses must be configured before use");if(0===a.j)K("flush_replies: Nothing to flush",2097152);else{K("Flushing "+a.j+" replies",2097152);var b=a.s.Da(a.h+2)+a.j&65535;a.s.Xd(a.h+2,b);a.j=0;0<(a.V.h[0]&536870912)?(a.s.Da(a.g+4+2*a.size),a.V.Za(1)):~a.s.Da(a.g)&1&&a.V.Za(1)}}
function Pe(a,b){this.s=a.s;this.V=a.V;this.C=b;this.l=[];this.ye=this.g=this.j=0;this.u=[];this.i=this.h=this.o=0;let c=a.l,d=0,e=a.size,f=!1;const h=0<(this.V.h[0]&268435456);K("<<< Descriptor chain start",2097152);do{var g=a,m=c,n=b;g={Vf:g.s.h(m+16*n),Ti:g.s.h(m+16*n+4),xe:g.s.h(m+16*n+8),flags:g.s.Da(m+16*n+12),next:g.s.Da(m+16*n+14)};K("descriptor: idx="+b+" addr="+B(g.Ti,8)+":"+B(g.Vf,8)+" len="+B(g.xe,8)+" flags="+B(g.flags,4)+" next="+B(g.next,4),2097152);if(h&&g.flags&4)g.flags&1&&K("Driver bug: has set VIRTQ_DESC_F_NEXT flag in an indirect table descriptor",
2097152),c=g.Vf,d=b=0,e=g.xe/16,K("start indirect",2097152);else{if(g.flags&2)f=!0,this.u.push(g);else{if(f){K("Driver bug: readonly buffer after writeonly buffer within chain",2097152);break}this.l.push(g);this.ye+=g.xe}d++;if(d>e){K("Driver bug: descriptor chain cycle detected",2097152);break}if(g.flags&1)b=g.next;else break}}while(1);K("Descriptor chain end >>>",2097152)}
function ta(a,b){let c=0,d=b.length;for(;d;){if(a.j===a.l.length){K("Device<"+a.V.name+"> Read more than device-readable buffers has",2097152);break}var e=a.l[a.j],f=e.Vf+a.g;let n=e.xe-a.g;n>d?(n=d,a.g+=d):(a.j++,a.g=0);e=b;var h=e.set,g=a.s,m=n;m&&(l(!g.og(f)),l(!g.og(f+m-1)));h.call(e,g.fb.subarray(f,f+m),c);c+=n;d-=n}}
function qa(a,b){let c=0,d=b.length;for(;d;){if(a.o===a.u.length){K("Device<"+a.V.name+"> Write more than device-writable capacity",2097152);break}var e=a.u[a.o];const f=e.Vf+a.h;e=e.xe-a.h;e>d?(e=d,a.h+=d):(a.o++,a.h=0);vc(a.s,b.subarray(c,c+e),f);c+=e;d-=e}a.i+=c};function Qe(a,b){this.A=b;this.rows=25;this.cols=80;this.ports=4;b=[{ab:16,pb:0},{ab:16,pb:1},{ab:16,pb:2},{ab:16,pb:3}];for(let c=1;c<this.ports;++c)b.push({ab:16,pb:0}),b.push({ab:8,pb:1});this.V=new ha(a,{name:"virtio-console",Ta:56,Xe:4163,Eg:3,Ve:{ob:47104,$:b,features:[0,1,32],Rh:()=>{}},notification:{ob:47360,Cg:!1,$e:[c=>{for(c=this.V.$[c];Oe(c)>c.size-2;)ja(c)},c=>{const d=this.V.$[c],e=3<c?c-3>>1:0;for(;ia(d);){const f=ja(d),h=new Uint8Array(f.ye);ta(f,h);this.A.send("virtio-console"+e+
"-output-bytes",h);Re(this,c,f)}},c=>{if(2!==c)l(!1,"VirtioConsole Notified for wrong queue: "+c+" (expected queue_id of 2)");else for(c=this.V.$[c];Oe(c)>c.size-2;)ja(c)},c=>{if(3!==c)l(!1,"VirtioConsole Notified for wrong queue: "+c+" (expected queue_id of 3)");else for(var d=this.V.$[c];ia(d);){var e=ja(d),f=new Uint8Array(e.ye);ta(e,f);var h=A(["w","h","h"],f,{offset:0});f=h[0];h=h[1];Re(this,c,e);switch(h){case 0:for(f=0;f<this.ports;++f)Se(this,f,1,0);break;case 3:Re(this,c,e);Se(this,f,4,1);
h=f;var g="virtio-"+f;e=ja(this.V.$[2]);g=(new TextEncoder).encode(g);const m=new Uint8Array(g.length+9);oa(["w","h","h"],[h,7,1],m,0);for(h=0;h<g.length;++h)m[h+8]=g[h];m[8+g.length]=0;this.ud(2,e,m);Se(this,f,6,1);break;case 6:Re(this,c,e);0===f&&Te(this,f);break;default:l(!1," VirtioConsole received unknown event: "+h[1]);return}}}]},Ic:{ob:46848},cg:{ob:46592,qd:[{bytes:2,name:"cols",read:()=>this.cols,write:()=>{}},{bytes:2,name:"rows",read:()=>this.rows,write:()=>{}},{bytes:4,name:"max_nr_ports",
read:()=>this.ports,write:()=>{}},{bytes:4,name:"emerg_wr",read:()=>0,write:()=>{l(!1,"Emergency write!")}}]}});for(let c=0;c<this.ports;++c){const d=0===c?0:2*c+2;this.A.register("virtio-console"+c+"-input-bytes",function(e){var f=this.V.$[d];ia(f)&&(f=ja(f),this.ud(d,f,new Uint8Array(e)))},this);this.A.register("virtio-console"+c+"-resize",function(e){this.cols=e[0];this.rows=e[1];Me(this.V.$[2])&&ia(this.V.$[2])&&Te(this,c)},this)}}
function Te(a,b){const c=ja(a.V.$[2]),d=new Uint8Array(12);oa(["w","h","h","h","h"],[b,5,0,a.rows,a.cols],d,0);a.ud(2,c,d)}Qe.prototype.ea=function(){const a=[];a[0]=this.V;a[1]=this.rows;a[2]=this.cols;a[3]=this.ports;return a};Qe.prototype.I=function(a){this.V.I(a[0]);this.rows=a[1];this.cols=a[2];this.ports=a[3]};Qe.prototype.reset=function(){this.V.reset()};function Se(a,b,c,d){const e=ja(a.V.$[2]),f=new Uint8Array(8);oa(["w","h","h"],[b,c,d],f,0);a.ud(2,e,f)}
Qe.prototype.ud=function(a,b,c){qa(b,c);ra(this.V.$[a],b);sa(this.V.$[a])};function Re(a,b,c){qa(c,new Uint8Array(0));ra(a.V.$[b],c);sa(a.V.$[b])};function Ue(a,b,c){this.A=b;this.id=a.v.gb?1:0;this.status=1;this.Ge=c;this.ia=new Uint8Array([0,34,21,255*Math.random()|0,255*Math.random()|0,255*Math.random()|0]);this.A.send("net"+this.id+"-mac",Vd(this.ia));b=[];for(c=0;1>c;++c)b.push({ab:32,pb:0}),b.push({ab:32,pb:1});b.push({ab:16,pb:2});this.V=new ha(a,{name:"virtio-net",Ta:80,Xe:4161,Eg:1,Ve:{ob:51200,$:b,features:[5,16,22,3,17,23,32],Rh:()=>{}},notification:{ob:51456,Cg:!1,$e:[d=>{d=this.V.$[d];var e=d.s.Da(d.g+4+2*d.i);e=new Pe(d,e);d.i=
d.i+1&d.dd;ra(this.V.$[0],e);sa(this.V.$[0])},d=>{const e=this.V.$[d];for(;ia(e);){const f=ja(e),h=new Uint8Array(f.ye);ta(f,h);this.A.send("net"+this.id+"-send",h.subarray(12));this.A.send("eth-transmit-end",[h.length-12]);ra(this.V.$[d],f)}sa(this.V.$[d])},d=>{if(2!==d)l(!1,"VirtioConsole Notified for wrong queue: "+d+" (expected queue_id of 3)");else for(var e=this.V.$[d];ia(e);){const g=ja(e);var f=new Uint8Array(g.ye);ta(g,f);var h=A(["b","b"],f,{offset:0});const m=h[0];h=h[1];switch(m<<8|h){case 1024:f=
A(["h"],f,{offset:2});l(1===f[0]);this.ud(d,g,new Uint8Array([0]));break;case 257:this.ia=f.subarray(2,8);this.ud(d,g,new Uint8Array([0]));this.A.send("net"+this.id+"-mac",Vd(this.ia));break;default:l(!1," VirtioConsole received unknown command: "+m+":"+h);this.ud(d,g,new Uint8Array([1]));return}}}]},Ic:{ob:50944},cg:{ob:50688,qd:[0,1,2,3,4,5].map((d,e)=>({bytes:1,name:"mac_"+e,read:()=>this.ia[e],write:()=>{}})).concat([{bytes:2,name:"status",read:()=>this.status,write:()=>{}},{bytes:2,name:"max_pairs",
read:()=>1,write:()=>{}},{bytes:2,name:"mtu",read:()=>1500,write:()=>{}}])}});this.A.register("net"+this.id+"-receive",d=>{this.A.send("eth-receive-end",[d.length]);const e=new Uint8Array(12+d.byteLength);(new DataView(e.buffer,e.byteOffset,e.byteLength)).setInt16(10,1);e.set(d,12);d=this.V.$[0];ia(d)?(d=ja(d),qa(d,e),ra(this.V.$[0],d),sa(this.V.$[0])):console.log("No buffer to write into!")},this)}
Ue.prototype.ea=function(){const a=[];a[0]=this.V;a[1]=this.id;this.Ge&&(this.ia=a[2],this.A.send("net"+this.id+"-mac",Vd(this.ia)));return a};Ue.prototype.I=function(a){this.V.I(a[0])};Ue.prototype.reset=function(){this.V.reset()};Ue.prototype.ud=function(a,b,c){qa(b,c);ra(this.V.$[a],b);sa(this.V.$[a])};function Ve(){this.Cf={};this.g=void 0}Ve.prototype.register=function(a,b,c){var d=this.Cf[a];void 0===d&&(d=this.Cf[a]=[]);d.push({mg:b,hh:c})};Ve.prototype.unregister=function(a,b){var c=this.Cf[a];void 0!==c&&(this.Cf[a]=c.filter(function(d){return d.mg!==b}))};Ve.prototype.send=function(a,b){if(this.g&&(a=this.g.Cf[a],void 0!==a))for(var c=0;c<a.length;c++){var d=a[c];d.mg.call(d.hh,b)}};function We(){var a=new Ve,b=new Ve;a.g=b;b.g=a;return[a,b]};var wb=[],K=function(){var a=aa.reduce(function(d,e){d[e[0]]=e[1];return d},{}),b="",c=0;return function(d,e){e=e||1;if(e&cb){d="["+fb(a[e]||"",4)+"] "+d;if(d===b&&(c++,2048>c))return;e=new Date;e=lb(e.getHours(),2)+":"+lb(e.getMinutes(),2)+":"+lb(e.getSeconds(),2)+"+"+lb(e.getMilliseconds(),3)+" ";c&&(1===c?console.log(e+b):console.log("Previous message repeated "+c+" times"),c=0);console.log(e+d);b=d}}}();
function l(a,b){if(!a){debugger;console.trace();if(b)throw"Assert failed: "+b;throw"Assert failed";}};function Eb(a,b,c){this.Ni=c;this.Na=b;Xe(this);b=Object.create(null);b.m=this.Na.exports.memory;for(var d of Object.keys(this.Na.exports))d.startsWith("_")||d.startsWith("zstd")||d.endsWith("_js")||(b[d]=this.Na.exports[d]);this.de=b;this.Ma=d=this.Na.exports.memory;this.F=W(Uint32Array,d,812,1);this.fb=new Uint8Array(0);this.yb=new Int32Array(this.fb.buffer);this.G=W(Uint8Array,d,724,8);this.J=W(Int32Array,d,736,8);this.l=W(Uint32Array,d,768,8);this.D=W(Uint8Array,d,512,8);this.C=W(Int32Array,d,
800,1);this.mb=W(Int32Array,d,564,1);this.lb=W(Int32Array,d,568,1);this.o=W(Int32Array,d,572,1);this.bb=W(Int32Array,d,576,1);this.rd=W(Int32Array,d,1128,1);this.Fc=W(Uint32Array,d,540,8);this.Ra=W(Int32Array,d,580,8);this.P=W(Uint8Array,d,612,1);this.u=W(Int32Array,d,804,1);this.N=W(Int32Array,d,808,1);this.yc=W(Uint8Array,d,616,1);this.Ec=W(Int32Array,d,620,1);this.ac=W(Int32Array,d,624,1);this.ld=W(Int32Array,d,636,1);this.od=W(Int32Array,d,640,1);this.md=W(Int32Array,d,644,1);this.Jc=W(Int32Array,
d,648,1);this.flags=W(Int32Array,d,120,1);this.bc=W(Int32Array,d,100,1);this.Cc=W(Int32Array,d,96,1);this.zc=W(Int32Array,d,104,1);W(Int32Array,d,112,1);this.Yd=W(Uint32Array,d,960,2);this.v={};this.xb=W(Int32Array,d,556,1);this.Kc=W(Int32Array,d,560,1);W(Uint8Array,d,548,1);this.Jb=W(Uint8Array,d,552,1);this.j=[];this.Ff=[];this.zb=[];this.Ef=[];this.Cb={Rg:null,Ud:null};this.Lj=W(Uint32Array,d,664,1);this.i=W(Int32Array,d,64,8);this.$b=W(Int32Array,d,1152,32);this.qa=W(Uint8Array,d,816,1);this.qa[0]=
255;this.Qa=W(Uint8Array,d,1032,1);this.Qa[0]=0;this.R=W(Uint16Array,d,1036,1);this.R[0]=895;this.Zd=W(Uint16Array,d,1040,1);this.Zd[0]=0;this.Z=W(Int32Array,d,1048,1);this.Z[0]=0;this.aa=W(Int32Array,d,1052,1);this.aa[0]=0;this.fa=W(Int32Array,d,1044,1);this.fa[0]=0;this.U=W(Int32Array,d,1056,1);this.U[0]=0;this.X=W(Int32Array,d,1060,1);this.X[0]=0;this.bd=W(Int32Array,d,832,32);W(Int32Array,d,824,1);this.g=W(Uint16Array,d,668,8);this.Kb=W(Int32Array,d,684,8);this.Lc=W(Int32Array,d,968,8);this.Ri=
W(Uint32Array,d,716,1);this.Ji=W(Uint32Array,d,720,1);this.nb=[];this.Pg=0;this.Gd=[];this.B=void 0;this.A=a;this.gd(0,0);Ye(this);this.fd={}}
function Xe(a){const b=c=>{const d=a.Na.exports[c];console.assert(d,"Missing import: "+c);return d};a.Ab=b("reset_cpu");a.ae=b("getiopl");a.cc=b("get_eflags");a.be=b("handle_irqs");a.ee=b("main_loop");a.Mi=b("set_jit_config");a.$a=b("read8");a.Da=b("read16");a.h=b("read32s");a.Ne=b("write8");a.Xd=b("write16");a.wa=b("write32");a.og=b("in_mapped_range");b("fpu_load_tag_word");b("fpu_load_status_word");b("fpu_get_sti_f64");a.Bb=b("translate_address_system_read_js");a.fc=b("get_seg_cs");a.td=b("get_real_eip");
b("clear_tlb");a.$d=b("full_clear_tlb");a.sd=b("update_state_flags");a.gd=b("set_tsc");a.Oi=b("store_current_tsc");a.Li=b("set_cpuid_level");a.ge=b("pic_set_irq");a.fe=b("pic_clear_irq");a.ce=b("jit_clear_cache_js");a.Mj=b("jit_dirty_cache");a.Wd=b("codegen_finalize_finished");a.Td=b("allocate_memory");a.Bj=b("zero_memory");a.Qi=b("svga_allocate_memory");a.Pi=b("svga_allocate_dest_buffer");a.Xi=b("svga_fill_pixel_buffer");a.jd=b("svga_mark_dirty");a.dc=b("get_pic_addr_master");a.ec=b("get_pic_addr_slave");
a.Fi=b("zstd_create_ctx");a.Ii=b("zstd_get_src_ptr");a.Hi=b("zstd_free_ctx");a.lf=b("zstd_read");a.mf=b("zstd_read_free");a.he=b("port20_read");a.je=b("port21_read");a.Se=b("portA0_read");a.Uf=b("portA1_read");a.ie=b("port20_write");a.ke=b("port21_write");a.nf=b("portA0_write");a.Ki=b("portA1_write");a.Oe=b("port4D0_read");a.Qe=b("port4D1_read");a.Pe=b("port4D0_write");a.Re=b("port4D1_write")}
Eb.prototype.ea=function(){var a=[];a[0]=this.F[0];a[1]=new Uint8Array([...this.G,...this.D]);a[2]=this.J;a[3]=this.l;a[4]=this.C[0];a[5]=this.lb[0];a[6]=this.mb[0];a[7]=this.bb[0];a[8]=this.o[0];a[9]=this.Fc[0];a[10]=this.Ra;a[11]=this.P[0];a[13]=this.u[0];a[16]=this.N[0];a[17]=this.yc[0];a[18]=this.Ec[0];a[19]=this.ac[0];a[22]=this.ld[0];a[23]=this.md[0];a[24]=this.od[0];a[25]=this.Jc[0];a[26]=this.flags[0];a[27]=this.bc[0];a[28]=this.zc[0];a[30]=this.Cc[0];a[37]=this.xb[0];a[38]=this.Kc[0];a[39]=
this.i;a[40]=this.g;a[41]=this.Kb;a[42]=this.Lc;this.Oi();a[43]=this.Yd;a[45]=this.v.Sf;a[46]=this.v.Te;a[47]=this.v.Rd;a[48]=this.v.kb;a[49]=this.v.Pb;a[50]=this.v.xa;a[52]=this.v.Ud;a[53]=this.v.Yg;a[54]=this.v.lh;a[55]=this.v.ue;a[56]=this.v.Y;a[57]=this.v.K;a[58]=this.v.wg;a[59]=this.v.gb;var b=new Uint8Array(this.Ma.buffer,this.dc(),13),c=new Uint8Array(this.Ma.buffer,this.ec(),13),d=[],e=[];d[0]=b[0];d[1]=b[1];d[2]=b[2];d[3]=b[3];d[4]=b[4];d[5]=e;d[6]=b[6];d[7]=b[7];d[8]=b[8];d[9]=b[9];d[10]=
b[10];d[11]=b[11];d[12]=b[12];e[0]=c[0];e[1]=c[1];e[2]=c[2];e[3]=c[3];e[4]=c[4];e[5]=null;e[6]=c[6];e[7]=c[7];e[8]=c[8];e[9]=c[9];e[10]=c[10];e[11]=c[11];e[12]=c[12];a[60]=d;a[61]=this.v.ah;a[62]=this.nb;a[63]=this.v.Ad;a[64]=this.rd[0];a[66]=this.bd;a[67]=this.$b;a[68]=this.qa[0];a[69]=this.Qa[0];a[70]=this.R[0];a[71]=this.Z[0];a[72]=this.aa[0];a[73]=this.U[0];a[74]=this.X[0];a[75]=this.fa[0];l(0===(this.fb.length&4095));c=this.fb.length>>12;b=[];for(d=0;d<c;d++){e=d<<12;e=this.yb.subarray(e>>2,
e+4096>>2);let g=!0;for(let m=0;m<e.length;m++)if(0!==e[m]){g=!1;break}g||b.push(d)}c=new Ub(c);d=new Uint8Array(b.length<<12);for(const [g,m]of b.entries())c.set(m,1),b=m<<12,d.set(this.fb.subarray(b,b+4096),g<<12);const {Sj:f,Yi:h}={Yi:c,Sj:d};a[77]=f;a[78]=new Uint8Array(h.kc());a[79]=this.v.hf;a[80]=this.v.jf;a[81]=this.v.kf;a[82]=this.v.Vd;a[83]=this.v.Me;return a};
Eb.prototype.I=function(a){this.F[0]=a[0];this.fb.length!==this.F[0]&&console.warn("Note: Memory size mismatch. we="+this.fb.length+" state="+this.F[0]);8===a[1].length?(this.G.set(a[1]),this.D.fill(242),this.D[1]=250):16===a[1].length?(this.G.set(a[1].subarray(0,8)),this.D.set(a[1].subarray(8,16))):l("Unexpected cpu segment state length:"+a[1].length);this.J.set(a[2]);this.l.set(a[3]);this.C[0]=a[4];this.lb[0]=a[5];this.mb[0]=a[6];this.bb[0]=a[7];this.o[0]=a[8];this.Fc[0]=a[9];this.Ra.set(a[10]);
this.P[0]=a[11];this.u[0]=a[13];this.N[0]=a[16];this.yc[0]=a[17];this.Ec[0]=a[18];this.ac[0]=a[19];this.ld[0]=a[22];this.md[0]=a[23];this.od[0]=a[24];this.Jc[0]=a[25];this.flags[0]=a[26];this.bc[0]=a[27];this.zc[0]=a[28];this.Cc[0]=a[30];this.xb[0]=a[37];this.Kc[0]=a[38];this.i.set(a[39]);this.g.set(a[40]);this.Kb.set(a[41]);a[42]&&this.Lc.set(a[42]);this.gd(a[43][0],a[43][1]);this.v.Sf&&this.v.Sf.I(a[45]);this.v.Te&&this.v.Te.I(a[46]);this.v.Rd&&this.v.Rd.I(a[47]);this.v.kb&&this.v.kb.I(a[48]);this.v.Pb&&
this.v.Pb.I(a[49]);this.v.xa&&this.v.xa.I(a[50]);this.v.Ud&&this.v.Ud.I(a[52]);this.v.Yg&&this.v.Yg.I(a[53]);this.v.lh&&this.v.lh.I(a[54]);this.v.ue&&this.v.ue.I(a[55]);this.v.Y&&this.v.Y.I(a[56]);this.v.K&&this.v.K.I(a[57]);this.v.wg&&this.v.wg.I(a[58]);this.v.gb&&this.v.gb.I(a[59]);var b=a[60],c=new Uint8Array(this.Ma.buffer,this.dc(),13),d=new Uint8Array(this.Ma.buffer,this.ec(),13);c[0]=b[0];c[1]=b[1];c[2]=b[2];c[3]=b[3];c[4]=b[4];var e=b[5];c[6]=b[6];c[7]=b[7];c[8]=b[8];c[9]=b[9];c[10]=b[10];
c[11]=b[11];c[12]=b[12];d[0]=e[0];d[1]=e[1];d[2]=e[2];d[3]=e[3];d[4]=e[4];d[6]=e[6];d[7]=e[7];d[8]=e[8];d[9]=e[9];d[10]=e[10];d[11]=e[11];d[12]=e[12];this.v.ah&&this.v.ah.I(a[61]);this.v.hf&&this.v.hf.I(a[79]);this.v.jf&&this.v.jf.I(a[80]);this.v.kf&&this.v.kf.I(a[81]);this.v.Vd&&this.v.Vd.I(a[82]);this.v.Me&&this.v.Me.I(a[83]);this.nb=a[62];this.v.Ad&&this.v.Ad.I(a[63]);this.rd[0]=a[64];this.bd.set(a[66]);this.$b.set(a[67]);this.qa[0]=a[68];this.Qa[0]=a[69];this.R[0]=a[70];this.Z[0]=a[71];this.aa[0]=
a[72];this.U[0]=a[73];this.X[0]=a[74];this.fa[0]=a[75];b=new Ub(a[78].buffer);a=a[77];this.Bj(this.F[0]);c=this.F[0]>>12;d=0;for(e=0;e<c;e++)if(b.get(e)){const f=d<<12;this.fb.set(a.subarray(f,f+4096),e<<12);d++}this.sd();this.$d();this.ce()};function Dc(a){a.Ab();a.nb=[];a.v.Sf&&a.v.Sf.reset();a.v.Vd&&a.v.Vd.reset();a.v.Me&&a.v.Me.reset();Ib(a)}
function Ze(a,b,c){b<c?(b=c,K("Rounding memory size up to "+b,2)):0>(b|0)&&(b=Math.pow(2,31)-131072,K("Rounding memory size down to "+b,2));b=(b-1|131071)+1|0;l(0<(b|0));l(0===(b&131071));console.assert(0===a.F[0],"Expected uninitialised memory");a.F[0]=b;c=a.Td(b);a.fb=W(Uint8Array,a.Ma,c,b);a.yb=W(Uint32Array,a.Ma,c,b>>2)}
Eb.prototype.Eb=function(a,b){Ze(this,a.F||67108864,a.Ub?67108864:1048576);a.sf&&this.Mi(0,1);a.xd&&this.Li(a.xd);this.Jb[0]=+a.xa;this.Ab();var c=new xb(this);this.B=c;this.Cb.Rg=a.Cb;this.Cb.Ud=a.Rf;Ib(this);if(a.Db){const e=$e(this.fb,a.Db,a.Ub,a.Mb||"");e&&this.Gd.push(e)}M(c,179,this,function(){K("port 0xB3 read");return 0});var d=0;M(c,146,this,function(){return d});T(c,146,this,function(e){d=e});M(c,1297,this,function(){if(this.Pg<this.nb.length)return this.nb[this.Pg++];l(!1,"config port: Read past value");
return 0});T(c,1296,this,void 0,function(e){function f(m){return new Uint8Array(Int32Array.of(m).buffer)}function h(m){return m>>8|m<<8&65280}function g(m){return m<<24|m<<8&16711680|m>>8&65280|m>>>24}K("bios config port, index="+B(e));this.Pg=0;if(0===e)this.nb=f(1431127377);else if(1===e)this.nb=f(0);else if(3===e)this.nb=f(this.F[0]);else if(5===e)this.nb=f(1);else if(15===e)this.nb=f(1);else if(13===e)this.nb=new Uint8Array(16);else if(25===e){e=new Int32Array(4+64*this.Gd.length);const m=new Uint8Array(e.buffer);
e[0]=g(this.Gd.length);for(let n=0;n<this.Gd.length;n++){const {name:p,data:t}=this.Gd[n],x=4+64*n;l(65536>49152+n);e[x>>2]=g(t.length);e[x+4>>2]=h(49152+n);l(56>p.length);for(let y=0;y<p.length;y++)m[x+8+y]=p.charCodeAt(y)}this.nb=m}else 32768<=e&&49152>e?this.nb=f(0):49152<=e&&e-49152<this.Gd.length?this.nb=this.Gd[e-49152].data:(K("Warning: Unimplemented fw index: "+B(e)),this.nb=f(0))});T(c,128,this,function(){});M(c,128,this,function(){return 255});T(c,233,this,function(){});M(c,32,this,this.he);
M(c,33,this,this.je);M(c,160,this,this.Se);M(c,161,this,this.Uf);T(c,32,this,this.ie);T(c,33,this,this.ke);T(c,160,this,this.nf);T(c,161,this,this.Ki);M(c,1232,this,this.Oe);M(c,1233,this,this.Qe);T(c,1232,this,this.Pe);T(c,1233,this,this.Re);this.v={};a.Nj&&(this.v.kb=new zc(this),this.Jb[0]&&(this.v.Ad=new Pd(this),this.v.Te=new Fd(this),this.v.xa=new Bd(this)),this.v.Rd=new sd(this),af(this,this.v.Rd,a),this.v.Pb=new Ic(this),this.v.Ud=new Uc(this,b,a.screen,a.la||8388608),this.v.Yg=new od(this,
b),this.v.lh=new vd(this,1016,b),a.hf&&(this.v.hf=new vd(this,760,b)),a.jf&&(this.v.jf=new vd(this,1E3,b)),a.kf&&(this.v.kf=new vd(this,744,b)),this.v.ue=new Fc(this,a.W,a.te),c=0,a.K&&(this.v.K=new Yb(this,a.K,a.Zc,!1,c++,b)),a.Y&&(this.v.Y=new Yb(this,a.Y,void 0,!0,c++,b)),this.v.wg=new Nc(this,b),"ne2k"===a.bf.type?this.v.gb=new Wd(this,b,a.Ge,a.Vb):"virtio"===a.bf.type&&(this.v.Me=new Ue(this,b,a.Ge)),a.Bc&&(this.v.Sf=new fa(a.Bc,this,b)),a.Vd&&(this.v.Vd=new Qe(this,b)),this.v.ah=new ke(this,
b));a.Fb&&(K("loading multiboot",2),a=bf(this,a.Fb,a.Ub,a.Mb))&&(this.Cb.Rg?(K("adding option rom for multiboot",2),this.Gd.push(a)):(K("loaded multiboot without bios",2),this.i[0]=Ab(this.B,244)));this.debug.Eb()};
function bf(a,b,c,d){K("Trying multiboot from buffer of size "+b.byteLength,2);if(8192>b.byteLength){var e=new Int32Array(2048);(new Uint8Array(e.buffer)).set(new Uint8Array(b))}else e=new Int32Array(b,0,2048);for(var f=0;8192>f;f+=4){if(464367618===e[f>>2]){var h=e[f+4>>2];if(464367618+h+e[f+8>>2]|0){K("Multiboot checksum check failed",2);continue}}else continue;K("Multiboot magic found, flags: "+B(h>>>0,8),2);l(0===(h&-65540),"TODO");var g=a;M(a.B,244,a,function(){return 0},function(){return 0},
function(){var p=31860,t=0;if(d){t|=4;g.wa(31760,p);d+="\x00";var x=(new TextEncoder).encode(d);vc(g,x,p);p+=x.length}if(h&2){t|=64;x=0;g.wa(31788,0);g.wa(31792,p);var y=0;let r=!1;for(let E=0;4294967296>E;E+=131072)r&&void 0!==g.j[E>>>17]?(g.wa(p,20),g.wa(p+4,y),g.wa(p+8,0),g.wa(p+12,E-y),g.wa(p+16,0),g.wa(p+20,1),p+=24,x+=24,r=!1):r||void 0!==g.j[E>>>17]||(y=E,r=!0);l(!r,"top of 4GB shouldn't have memory");g.wa(31788,x)}g.wa(31744,t);x=t=0;if(h&65536){K("Multiboot specifies its own address table",
2);var F=e[f+12>>2];var z=e[f+16>>2];var u=e[f+20>>2];var w=e[f+24>>2];t=e[f+28>>2];K("header="+B(F,8)+" load="+B(z,8)+" load_end="+B(u,8)+" bss_end="+B(w,8)+" entry="+B(t,8));l(z<=F);F=f-(F-z);0===u?x=void 0:(l(u>=z),x=u-z);F=new Uint8Array(b,F,x);vc(g,F,z);t|=0;x=Math.max(u,w)}else if(1179403647===e[0]){K("Multiboot image is in elf format",2);y=new DataView(b);const [r,E]=cf(y,df);console.assert(52===E);for(F of Object.keys(r))K(F+": 0x"+(r[F].toString(16)>>>0));console.assert(1179403647===r.Qh,
"Bad magic");console.assert(1===r.oe,"Unimplemented: 64 bit elf");console.assert(1===r.data,"Unimplemented: big endian");console.assert(1===r.Dl,"Bad version0");console.assert(2===r.type,"Unimplemented type");console.assert(1===r.El,"Bad version1");console.assert(52===r.zj,"Bad header size");console.assert(32===r.Xh,"Bad program header size");console.assert(40===r.xi,"Bad section header size");[t]=ef(new DataView(y.buffer,y.byteOffset+r.Uj,r.Xh*r.Yh),ff,r.Yh);[F]=ef(new DataView(y.buffer,y.byteOffset+
r.ul,r.xi*r.yi),gf,r.yi);if(cb){console.log("%d program headers:",t.length);for(w of t)console.log("type=%s offset=%s vaddr=%s paddr=%s filesz=%s memsz=%s flags=%s align=%s",w.type.toString(16),w.offset.toString(16),w.Jg.toString(16),w.Oc.toString(16),w.kg.toString(16),w.Fd.toString(16),w.flags.toString(16),w.align.toString(16));console.log("%d section headers:",F.length);for(z of F)console.log("name=%s type=%s flags=%s addr=%s offset=%s size=%s link=%s info=%s addralign=%s entsize=%s",z.name.toString(16),
z.type.toString(16),z.flags.toString(16),z.Si.toString(16),z.offset.toString(16),z.size.toString(16),z.link.toString(16),z.info.toString(16),z.Ui.toString(16),z.Aj.toString(16))}w=r;z=t;t=w.Dh;for(u of z)0!==u.type&&(1===u.type?(l(u.kg<=u.Fd),u.Oc+u.Fd<g.F[0]?(u.kg&&(z=new Uint8Array(b,u.offset,u.kg),vc(g,z,u.Oc)),x=Math.max(x,u.Oc+u.Fd),K("prg load "+u.Oc+" to "+(u.Oc+u.Fd),2),t===w.Dh&&u.Jg<=t&&u.Jg+u.Fd>t&&(t=t-u.Jg+u.Oc)):K("Warning: Skipped loading section, paddr="+B(u.Oc)+" memsz="+u.Fd,2)):
2===u.type||3===u.type||4===u.type||6===u.type||7===u.type||1685382480===u.type||1685382481===u.type||1685382482===u.type||1685382483===u.type?K("skip load type "+u.type+" "+u.Oc+" to "+(u.Oc+u.Fd),2):l(!1,"unimplemented elf section type: "+B(u.type)))}else l(!1,"Not a bootable multiboot format");c&&(g.wa(31764,1),g.wa(31768,p),u=x,0!==(u&4095)&&(u=(u&-4096)+4096),K("ramdisk address "+u),w=u+c.byteLength,g.wa(p,u),g.wa(p+4,w),g.wa(p+8,0),g.wa(p+12,0),l(w<g.F[0]),vc(g,new Uint8Array(c),u));g.i[3]=
31744;g.Ra[0]=1;g.C[0]=1;g.flags[0]=2;g.u[0]=1;g.N[0]=1;for(p=0;6>p;p++)g.G[p]=0,g.J[p]=0,g.l[p]=4294967295,g.g[p]=45058;g.xb[0]=g.fc()+t|0;g.sd();K("Starting multiboot kernel at:",2);g.debug.wj();g.debug.Ch();return 732803074});a.B.nd(244,a,function(p){console.log("Test exited with code "+B(p,2));throw"HALT";},function(){},function(){},function(){});for(let p=0;15>=p;p++){function t(x){K("kvm-unit-test: Set irq "+B(p)+" to "+B(x,2));x?this.cb(p):$b(this,p)}T(a.B,8192+p,a,t,t,t)}a=new Uint8Array(512);
(new Uint16Array(a.buffer))[0]=43605;a[2]=1;var m=3;a[m++]=102;a[m++]=229;a[m++]=244;l(512>m);let n=a[m]=0;for(let p=0;p<a.length;p++)n+=a[p];a[m]=-n;return{name:"genroms/multiboot.bin",data:a}}K("Multiboot header not found",2)}
function af(a,b,c){var d=c.Lb||291;nc(b,56,1|d>>4&240);nc(b,61,d&255);nc(b,21,128);nc(b,22,2);d=0;1048576<=a.F[0]&&(d=a.F[0]-1048576>>10,d=Math.min(d,65535));nc(b,23,d&255);nc(b,24,d>>8&255);nc(b,48,d&255);nc(b,49,d>>8&255);d=0;16777216<=a.F[0]&&(d=a.F[0]-16777216>>16,d=Math.min(d,65535));nc(b,52,d&255);nc(b,53,d>>8&255);nc(b,91,0);nc(b,92,0);nc(b,93,0);nc(b,20,47);nc(b,95,0);c.Eh&&nc(b,63,1)}
function Ib(a){var b=a.Cb.Rg,c=a.Cb.Ud;if(b){l(b instanceof ArrayBuffer);var d=new Uint8Array(b);vc(a,d,1048576-b.byteLength);if(c){l(c instanceof ArrayBuffer);var e=new Uint8Array(c);vc(a,e,786432);zb(a.B,4272947200,1048576,function(f){f=f-4272947200|0;return f<e.length?e[f]:0},function(){l(!1,"Unexpected write to VGA rom")})}else K("Warning: No VGA BIOS");zb(a.B,4293918720,1048576,function(f){return this.fb[f&1048575]}.bind(a),function(f,h){this.fb[f&1048575]=h}.bind(a))}else K("Warning: No BIOS")}
function hf(a,b,c,d,e,f){e>>>=0;f>>>=0;l(0<=b&&900>b);const h=new Uint8Array(a.Ma.buffer,e,f);a.fd[c]=(a.fd[c]||0)+1;a.xj&&a.xj(h);WebAssembly.instantiate(h,{e:a.de}).then(g=>{a.Na.mh.set(b+1024,g.instance.exports.f);a.Wd(b,c,d);a.aj&&a.aj(h)}).catch(g=>{console.log(g);debugger;throw g;})}Eb.prototype.cb=function(a){l(1===arguments.length);this.ge(a);if(this.v.Ad){var b=this.v.Ad;if(24<=a)l(!1,"Bad irq: "+a);else{var c=1<<a;0===(b.j&c)&&(b.j|=c,65536!==(b.g[a]&98304)&&(b.h|=c,Kd(b,a)))}}};
function $b(a,b){a.fe(b);if(a.v.Ad)if(a=a.v.Ad,24<=b)l(!1,"Bad irq: "+b);else{var c=1<<b;(a.j&c)===c&&(a.j&=~c,a.g[b]&32768&&(a.h&=~c))}};function Ye(a){function b(p){for(var t=f.C[0]?"prot":"real",x=f.cc(),y=f.ae(),F=f.P[0],z=B(f.g[1],4)+":"+B(f.td()>>>0,8),u=B(f.g[2],4)+":"+B(f.i[0]>>>0,8),w=f.u[0]?"32":"16",r=f.flags[0]&512?1:0,E={[1]:"c",[4]:"p",[16]:"a",[64]:"z",[128]:"s",[256]:"t",[512]:"i",[1024]:"d",[2048]:"o"},N="",P=0;16>P;P++)E[1<<P]&&(N=x&1<<P?N+E[1<<P]:N+" ");return"mode="+t+"/"+w+" paging="+ +(0!==(f.Ra[0]&-2147483648))+" pae="+ +(0!==(f.Ra[4]&32))+" iopl="+y+" cpl="+F+" if="+r+" cs:eip="+z+" cs_off="+B(f.fc()>>>0,8)+
" flgs="+B(f.cc()>>>0,6)+" ("+N+") ss:esp="+u+" ssize="+ +f.N[0]+(p?" in "+p:"")}function c(){for(var p={eax:0,ecx:1,edx:2,ebx:3,esp:4,ebp:5,esi:6,edi:7},t="eax ecx edx ebx esp ebp esi edi".split(" "),x="",y="",F=0;4>F;F++)x+=t[F]+"="+B(f.i[p[t[F]]]>>>0,8)+" ",y+=t[F+4]+"="+B(f.i[p[t[F+4]]]>>>0,8)+" ";x+="  ds="+B(f.g[3],4)+" es="+B(f.g[0],4)+" fs="+B(f.g[4],4);y+="  gs="+B(f.g[5],4)+" cs="+B(f.g[1],4)+" ss="+B(f.g[2],4);return[x,y]}function d(p,t,x){if(!(p&1))return!1;var y=128===(p&128);return{size:y,
global:256===(p&256),ph:32===(p&32),mj:64===(p&64),rh:16===(p&16),Di:4===(p&4),si:2===(p&2),Wf:(y&&!x?p&(t?4292870144:4290772992):p&4294963200)>>>0}}function e(p,t,x){for(var y=t?512:1024,F=t?8:4,z=t?21:22,u=0;u<y;u++){var w=f.h(p+u*F),r=d(w,t,!0);if(r)if(w="",w+=r.size?"S ":"  ",w+=r.ph?"A ":"  ",w+=r.rh?"Cd ":"  ",w+=r.Di?"U ":"  ",w+=r.si?"Rw ":"   ",r.size)K("=== "+B(x+(u<<z)>>>0,8)+" -> "+B(r.Wf>>>0,8)+" | "+w);else{K("=== "+B(x+(u<<z)>>>0,8)+" | "+w);for(var E=0;E<y;E++){var N=r.Wf+E*F;w=f.h(N);
var P=d(w,t,!1);P&&(w="",w+=P.rh?"Cd ":"   ",w+=P.Di?"U ":"  ",w+=P.si?"Rw ":"   ",w+=P.global?"G ":"  ",w+=P.ph?"A ":"  ",w+=P.mj?"Di ":"   ",K("# "+B(x+(u<<z|E<<12)>>>0,8)+" -> "+B(P.Wf,8)+" | "+w+"        (at "+B(N,8)+")"))}}}}var f=a,h={};a.debug=h;h.Eb=function(){function p(x){10===x?(K(t,4096),t=""):t+=String.fromCharCode(x)}if(f.B){var t="";T(f.B,1026,this,p);T(f.B,1280,this,p)}};h.Ej=c;h.Ch=function(){var p=c();K(p[0],2);K(p[1],2)};h.ea=b;h.wj=function(){K(b(void 0),2)};h.Pl=function(p,t){var x=
f.i[4];K("========= STACK ==========");if(t>=p||void 0===t)p=5,t=-5;for(;p>t;p--){var y="    ";p||(y="=>  ");y+=B(p,2)+" | ";K(y+B(x+4*p,8)+" | "+B(f.h(x+4*p)>>>0))}};h.vj=function(){if(f.Ra[4]&32){K("PAE enabled");for(var p=0;4>p;p++){var t=f.h(f.Ra[3]+8*p);t&1&&e(t&4294963200,!0,p<<30)}}else K("PAE disabled"),e(f.Ra[3],!1,0)};h.tj=function(){function p(t,x){for(var y=0;y<x;y+=8,t+=8){var F=f.Da(t+2)|f.$a(t+4)<<16|f.$a(t+7)<<24,z=f.Da(t)|(f.$a(t+6)&15)<<16,u=f.$a(t+5),w=f.$a(t+6)>>4,r="",E=u>>5&
3;r=u&128?r+" P ":r+"NP ";u&16?(r=w&4?r+"32b ":r+"16b ",u&8?(r+="X ",u&4&&(r+="C ")):r+="R ",r+="RW "):r+="sys: "+B(u&15);w&8&&(z=z<<12|4095);K(B(y&-8,4)+" "+B(F>>>0,8)+" ("+B(z>>>0,8)+" bytes) "+r+";  dpl = "+E+", a = "+u.toString(2)+", f = "+w.toString(2))}}K("gdt: (len = "+B(f.o[0])+")");p(f.Bb(f.bb[0]),f.o[0]);K("\nldt: (len = "+B(f.l[7])+")");p(f.Bb(f.J[7]),f.l[7])};h.uj=function(){for(var p=0;p<f.mb[0];p+=8){var t=f.Bb(f.lb[0]+p),x=f.Da(t)|f.Da(t+6)<<16,y=f.Da(t+2);t=f.$a(t+5);var F=t>>5&3;
var z=5===(t&31)?"task gate ":14===(t&31)?"intr gate ":15===(t&31)?"trap gate ":"invalid   ";z=t&128?z+" P":z+"NP";K(B(p>>3,4)+" "+B(x>>>0,8)+", "+B(y,4)+"; "+z+";  dpl = "+F+", t = "+t.toString(2))}};h.Tl=function(p,t){void 0===p?(p=0,t=f.F[0]):void 0===t&&(t=p,p=0);return f.fb.slice(p,p+t).buffer};h.Yl=function(p,t){t=t||64;for(var x,y,F=0;F<t>>4;F++){x=B(p+(F<<4),5)+"   ";for(var z=0;16>z;z++)y=f.$a(p+(F<<4)+z),x+=B(y,2)+" ";x+="  ";for(z=0;16>z;z++)y=f.$a(p+(F<<4)+z),x+=33>y||126<y?".":String.fromCharCode(y);
K(x)}};h.fm=function(){for(var p=f.F[0]/128/16|0,t,x=0;16>x;x++){t=B(128*x*p,8)+" | ";for(var y=0;128>y;y++)t+=0<f.yb[(128*x+y)*p]?"X":" ";K(t)}};h.Jl=function(){};let g,m;h.Ol=function(p,t,x){if(!m){if(void 0===g&&(g="function"===typeof require?require("./capstone-x86.min.js"):window.cs,void 0===g)){K("Warning: Missing capstone library, disassembly not available");return}m=[new g.Capstone(g.ARCH_X86,g.MODE_16),new g.Capstone(g.ARCH_X86,g.MODE_32)]}try{m[p].disasm(t,x).forEach(function(y){K(B(y.Wf>>>
0)+": "+fb(y.bytes.map(F=>B(F,2).slice(-2)).join(" "),20)+" "+y.mnemonic+" "+y.op_str)}),K("")}catch(y){K("Could not disassemble: "+Array.from(t).map(F=>B(F,2)).join(" "))}};let n;h.Ql=function(p){if(void 0===n&&(n="function"===typeof require?require("./libwabt.js"):new window.WabtModule,void 0===n)){K("Warning: Missing libwabt, wasm dump not available");return}p=p.slice();try{var t=n.readWasm(p,{cm:!1});t.generateNames();t.applyNames();const F=t.toText({Sl:!0,Vl:!0});K(F)}catch(F){var x=new Blob([p]),
y=document.createElement("a");y.download="failed.wasm";y.href=window.URL.createObjectURL(x);y.dataset.downloadurl=["application/octet-stream",y.download,y.href].join(":");y.click();window.URL.revokeObjectURL(y.src);console.log(F.toString())}finally{t&&t.Aa()}}};const jf=DataView.prototype,kf={size:1,get:jf.getUint8,set:jf.setUint8},lf={size:2,get:jf.getUint16,set:jf.setUint16},mf={size:4,get:jf.getUint32,set:jf.setUint32},df=nf([{Qh:mf},{oe:kf},{data:kf},{Dl:kf},{$l:kf},{Il:kf},{am:function(a){return{size:a,get:()=>-1}}(7)},{type:lf},{Xl:lf},{El:mf},{Dh:mf},{Uj:mf},{ul:mf},{flags:mf},{zj:lf},{Xh:lf},{Yh:lf},{xi:lf},{yi:lf},{dm:lf}]);console.assert(52===df.reduce((a,b)=>a+b.size,0));
const ff=nf([{type:mf},{offset:mf},{Jg:mf},{Oc:mf},{kg:mf},{Fd:mf},{flags:mf},{align:mf}]);console.assert(32===ff.reduce((a,b)=>a+b.size,0));const gf=nf([{name:mf},{type:mf},{flags:mf},{Si:mf},{offset:mf},{size:mf},{link:mf},{info:mf},{Ui:mf},{Aj:mf}]);console.assert(40===gf.reduce((a,b)=>a+b.size,0));function nf(a){return a.map(function(b){var c=Object.keys(b);console.assert(1===c.length);c=c[0];b=b[c];console.assert(0<b.size);return{name:c,type:b,size:b.size,get:b.get,set:b.set}})}
function cf(a,b){const c={};let d=0;for(const e of b)b=e.get.call(a,d,!0),console.assert(void 0===c[e.name]),c[e.name]=b,d+=e.size;return[c,d]}function ef(a,b,c){const d=[];let e=0;for(var f=0;f<c;f++){const [h,g]=cf(new DataView(a.buffer,a.byteOffset+e,void 0),b);d.push(h);e+=g}return[d,e]};function $e(a,b,c,d){K("Trying to load kernel of size "+b.byteLength);var e=new Uint8Array(b);const f=new Uint16Array(b);var h=new Uint32Array(b),g=e[497]||4,m=f[255];if(43605!==m)K("Bad checksum1: "+B(m));else if(m=f[257]|f[258]<<16,1400005704!==m)K("Bad checksum2: "+B(m));else{m=f[259];l(514<=m);var n=e[529];l(n&1);var p=f[283],t=h[139],x=h[140],y=e[564],F=e[565],z=518<=m?h[142]:255,u=h[146],w=h[147],r=h[150],E=h[151],N=h[152];K("kernel boot protocol version: "+B(m));K("flags="+B(n)+" xflags="+
B(p));K("code32_start="+B(h[133]));K("initrd_addr_max="+B(t));K("kernel_alignment="+B(x));K("relocatable="+y);K("min_alignment="+B(F));K("cmdline max="+B(z));K("payload offset="+B(u)+" size="+B(w));K("pref_address="+B(E)+":"+B(r));K("init_size="+B(N));e[528]=255;e[529]=n&-97|128;f[274]=56832;f[253]=65535;K("heap_end_ptr="+B(56832));d+="\x00";l(d.length<z);K("cmd_line_ptr="+B(581632));h[138]=581632;for(e=0;e<d.length;e++)a[581632+e]=d.charCodeAt(e);g=512*(g+1);K("prot_mode_kernel_start="+B(g));d=new Uint8Array(b,
0,g);b=new Uint8Array(b,g);e=g=0;c&&(g=67108864,e=c.byteLength,l(1048576+b.length<g),a.set(new Uint8Array(c),g));h[134]=g;h[135]=e;l(655360>524288+d.length);a.set(d,524288);a.set(b,1048576);a=new Uint8Array(512);(new Uint16Array(a.buffer))[0]=43605;a[2]=1;c=3;a[c++]=250;a[c++]=184;a[c++]=32768;a[c++]=128;a[c++]=142;a[c++]=192;a[c++]=142;a[c++]=216;a[c++]=142;a[c++]=224;a[c++]=142;a[c++]=232;a[c++]=142;a[c++]=208;a[c++]=188;a[c++]=57344;a[c++]=224;a[c++]=234;a[c++]=0;a[c++]=0;a[c++]=32800;a[c++]=128;
l(512>c);h=a[c]=0;for(b=0;b<a.length;b++)h+=a[b];a[c]=-h;return{name:"genroms/kernel.bin",data:a}}};var Ka=32768,Ia=16384,Qa=4;function of(a){this.g=[];this.C=[];this.j=a;this.u={Qg:0};this.h={};this.l=274877906944;this.o=0;this.i=[];Fa(this,"",-1)}of.prototype.ea=function(){let a=[];a[0]=this.g;a[1]=this.u.Qg;a[2]=[];for(const [b,c]of Object.entries(this.h))0===(this.g[b].mode&Ia)&&a[2].push([b,c]);a[3]=this.l;a[4]=this.o;return a=a.concat(this.i)};
of.prototype.I=function(a){this.g=a[0].map(b=>{const c=new pf(0);c.I(b);return c});this.u.Qg=a[1];this.h={};for(let [b,c]of a[2])c.buffer.byteLength!==c.byteLength&&(c=c.slice()),this.h[b]=c;this.l=a[3];this.o=a[4];this.i=a.slice(5)};function Aa(a,b,c){var d=a.g[b];0===d.status||2===d.status?c():5===d.status?Aa(qf(a,d),d.g,c):a.C.push({id:b,Hl:c})}
function rf(a,b,c){var d=sf(a);const e=b[0];d.size=b[1];d.ed=b[2];d.We=d.ed;d.ne=d.ed;d.mode=b[3];d.uid=b[4];d.eb=b[5];var f=d.mode&61440;if(f===Ia)for(tf(a,d,c,e),c=a.g.length-1,b=b[6],d=0;d<b.length;d++)rf(a,b[d],c);else f===Ka?(d.status=2,d.Qc=b[6],l(d.Qc),tf(a,d,c,e)):40960===f?(d.gf=b[6],tf(a,d,c,e)):49152!==f&&K("Unexpected ifmt: "+B(f)+" ("+e+")")}
function uf(a,b,c,d){const e=a.g[c],f=a.g[b];l(5!==f.status,"Filesystem: Shouldn't link under fowarder parents");l(vf(a,b),"Filesystem: Can't link under non-directories");l(5!==e.status||0===e.g,"Filesystem: Can't link across filesystems apart from their root");l(0<=e.Ja,"Filesystem: Found negative nlinks value of "+e.Ja);l(!f.ua.has(d),"Filesystem: Name '"+d+"' is already taken");f.ua.set(d,c);e.Ja++;vf(a,c)&&(l(!e.ua.has(".."),"Filesystem: Cannot link a directory twice"),e.ua.has(".")||e.Ja++,e.ua.set(".",
c),e.ua.set("..",b),f.Ja++)}function wf(a,b,c){const d=Ya(a,b,c),e=a.g[d],f=a.g[b];l(5!==f.status,"Filesystem: Can't unlink from forwarders");l(vf(a,b),"Filesystem: Can't unlink from non-directories");f.ua.delete(c)?(e.Ja--,vf(a,d)&&(l(e.ua.get("..")===b,"Filesystem: Found directory with bad parent id"),e.ua.delete(".."),f.Ja--),l(0<=e.Ja,"Filesystem: Found negative nlinks value of "+e.Ja)):l(!1,"Filesystem: Can't unlink non-existent file: "+c)}
function tf(a,b,c,d){-1!==c?(a.g.push(b),b.Ac=a.g.length-1,uf(a,c,b.Ac,d)):0===a.g.length?(a.g.push(b),b.ua.set(".",0),b.ua.set("..",0),b.Ja=2):(q("Error in Filesystem: Pushed inode with name = "+d+" has no parent"),ab())}function pf(a){this.ua=new Map;this.qg=this.pg=this.ed=this.ne=this.We=this.Ac=this.eb=this.uid=this.size=this.status=0;this.gf="";this.mode=493;this.Ua={type:0,version:0,path:a};this.Ja=0;this.Qc="";this.h=[];this.g=this.i=-1}
pf.prototype.ea=function(){const a=[];a[0]=this.mode;a[1]=(this.mode&61440)===Ia?[...this.ua]:(this.mode&61440)===Ka?this.Qc:40960===(this.mode&61440)?this.gf:49152===(this.mode&61440)?[this.qg,this.pg]:null;a[2]=this.h;a[3]=this.status;a[4]=this.size;a[5]=this.uid;a[6]=this.eb;a[7]=this.Ac;a[8]=this.We;a[9]=this.ne;a[10]=this.ed;a[11]=this.Ua.version;a[12]=this.Ua.path;a[13]=this.Ja;return a};
pf.prototype.I=function(a){this.mode=a[0];if((this.mode&61440)===Ia){this.ua=new Map;for(const [b,c]of a[1])this.ua.set(b,c)}else(this.mode&61440)===Ka?this.Qc=a[1]:40960===(this.mode&61440)?this.gf=a[1]:49152===(this.mode&61440)&&([this.qg,this.pg]=a[1]);this.h=[];for(const b of a[2]){const c=new xf;c.I(b);this.h.push(c)}this.status=a[3];this.size=a[4];this.uid=a[5];this.eb=a[6];this.Ac=a[7];this.We=a[8];this.ne=a[9];this.ed=a[10];this.Ua.type=(this.mode&61440)>>8;this.Ua.version=a[11];this.Ua.path=
a[12];this.Ja=a[13]};function yf(a,b){Object.assign(b,a,{Ac:b.Ac,ua:b.ua,Ja:b.Ja})}function sf(a){const b=Math.round(Date.now()/1E3);a=new pf(++a.u.Qg);a.ne=a.We=a.ed=b;return a}function Fa(a,b,c){var d=a.g[c];if(0<=c&&5===d.status)return c=d.g,b=Fa(qf(a,d),b,c),zf(a,d.i,b);d=sf(a);d.mode=511|Ia;0<=c&&(d.uid=a.g[c].uid,d.eb=a.g[c].eb,d.mode=a.g[c].mode&511|Ia);d.Ua.type=Ia>>8;tf(a,d,c,b);return a.g.length-1}
function Ja(a,b,c){var d=a.g[c];if(5===d.status)return c=d.g,b=Ja(qf(a,d),b,c),zf(a,d.i,b);d=sf(a);d.uid=a.g[c].uid;d.eb=a.g[c].eb;d.Ua.type=Ka>>8;d.mode=a.g[c].mode&438|Ka;tf(a,d,c,b);return a.g.length-1}function Ea(a,b,c,d,e){var f=a.g[c];if(5===f.status)return c=f.g,b=Ea(qf(a,f),b,c,d,e),zf(a,f.i,b);f=sf(a);f.pg=d;f.qg=e;f.uid=a.g[c].uid;f.eb=a.g[c].eb;f.Ua.type=192;f.mode=a.g[c].mode&438;tf(a,f,c,b);return a.g.length-1}
function Da(a,b,c,d){var e=a.g[c];if(5===e.status)return c=e.g,b=Da(qf(a,e),b,c,d),zf(a,e.i,b);e=sf(a);e.uid=a.g[c].uid;e.eb=a.g[c].eb;e.Ua.type=160;e.gf=d;e.mode=40960;tf(a,e,c,b);return a.g.length-1}async function Af(a,b,c,d){var e=a.g[c];if(5===e.status)return c=e.g,d=await Af(qf(a,e),b,c,d),zf(a,e.i,d);e=Ja(a,b,c);b=a.g[e];c=new Uint8Array(d.length);c.set(d);await Bf(a,e,c);b.size=d.length;return e}
function za(a,b,c){var d=a.g[b];if(5===d.status)return za(qf(a,d),d.g,c);(d.mode&61440)===Ia&&Cf(a,b);return!0}async function $a(a,b){var c=a.g[b];if(5===c.status)return await $a(qf(a,c),c.g);2===c.status&&a.j.g(c.Qc);c.status===Qa&&(c.status=-1,await Df(a,b))}
async function Xa(a,b,c,d,e){if(b===d&&c===e)return 0;var f=Ya(a,b,c);if(-1===f)return-2;var h=b;l(vf(a,h),"Filesystem: Cannot get full path of non-directory inode");for(var g="";0!==h;)g="/"+Ef(a,h)+g,h=Ff(a,h);if(-1!==Ya(a,d,e)&&(h=Za(a,d,e),0>h))return h;g=a.g[f];var m=a.g[b];h=a.g[d];if(5===m.status||5===h.status)if(5===m.status&&m.i===h.i){if(a=await Xa(qf(a,m),m.g,c,h.g,e),0>a)return a}else{if(0===ya(a,f).Ac)return K("XXX: Attempted to move mountpoint ("+c+") - skipped",4194304),-1;if(!vf(a,
f)&&1<ya(a,f).Ja)return K("XXX: Attempted to move hardlinked file ("+c+") across filesystems - skipped",4194304),-1;m=Ya(a,b,c);var n=a.g[m],p=new pf(-1);l(n,"Filesystem divert: name ("+c+") not found");l(vf(a,m)||1>=n.Ja,"Filesystem: can't divert hardlinked file '"+c+"' with nlinks="+n.Ja);Object.assign(p,n);const t=a.g.length;a.g.push(p);p.Ac=t;5===n.status&&a.i[n.i].g.set(n.g,t);if(5!==n.status||0===n.g)wf(a,b,c),uf(a,b,t,c);if(vf(a,m)&&5!==n.status)for(const [x,y]of p.ua)"."!==x&&".."!==x&&vf(a,
y)&&a.g[y].ua.set("..",t);a.h[t]=a.h[m];delete a.h[m];n.ua=new Map;n.Ja=0;m=t;n=ya(a,f);p=await Ta(a,m,0,n.size);5===h.status?(d=qf(a,h),e=vf(a,m)?Fa(d,e,h.g):Ja(d,e,h.g),d=ya(d,e),yf(n,d),Gf(a,f,h.i,e)):(l(5===g.status,"Filesystem delete_forwarder: expected forwarder"),g.status=-1,a.i[g.i].g.delete(g.g),yf(n,g),uf(a,d,f,e));await Ra(a,f,n.size);p&&p.length&&await Wa(a,f,0,p.length,p);if(vf(a,f))for(const x of Hf(a,m))if(e=await Xa(a,m,x,f,x),0>e)return e;await Df(a,m);a=Za(a,b,c);if(0>a)return a}else wf(a,
b,c),uf(a,d,f,e),g.Ua.version++;return 0}async function Wa(a,b,c,d,e){var f=a.g[b];if(5===f.status)b=f.g,await Wa(qf(a,f),b,c,d,e);else{var h=await a.kc(b);!h||h.length<c+d?(await Ra(a,b,Math.floor(3*(c+d)/2)),f.size=c+d,h=await a.kc(b)):f.size<c+d&&(f.size=c+d);e&&h.set(e.subarray(0,d),c);await Bf(a,b,h)}}async function Ta(a,b,c,d){const e=a.g[b];return 5===e.status?(b=e.g,await Ta(qf(a,e),b,c,d)):await If(a,b,c,d)}
function Ya(a,b,c){b=a.g[b];if(5===b.status){const d=b.g;c=Ya(qf(a,b),d,c);return-1===c?-1:Jf(a,b.i,c)}a=b.ua.get(c);return void 0===a?-1:a}function wa(a){let b=a.g.length;for(const {h:c,g:d}of a.i)b+=wa(c),b-=d.size;return b}function xa(a){let b=1048576;for(const {h:c}of a.i)b+=xa(c);return b}function ua(a){let b=a.o;for(const {h:c}of a.i)b+=ua(c);return b}function va(a){let b=a.l;for(const {h:c}of a.i)b+=va(c);return a.l}
function Ef(a,b){const c=a.g[Ff(a,b)];if(5===c.status)return Ef(qf(a,c),a.g[b].g);if(!c)return"";for(const [d,e]of c.ua)if(e===b)return d;l(!1,"Filesystem: Found directory inode whose parent doesn't link to it");return""}
function Ca(a,b,c,d){if(vf(a,c))return-1;const e=a.g[b],f=a.g[c];if(5===e.status)return 5!==f.status||f.i!==e.i?(K("XXX: Attempted to hardlink a file into a child filesystem - skipped",4194304),-1):Ca(qf(a,e),e.g,f.g,d);if(5===f.status)return K("XXX: Attempted to hardlink file across filesystems - skipped",4194304),-1;uf(a,b,c,d);return 0}
function Za(a,b,c){if("."===c||".."===c)return-1;var d=Ya(a,b,c);const e=a.g[d];var f=a.g[b];if(5===f.status)return l(5===e.status,"Children of forwarders should be forwarders"),b=f.g,Za(qf(a,f),b,c);if(f=vf(a,d)){a:if(d=a.g[d],5===d.status)var h=vf(qf(a,d),d.g);else{for(h of d.ua.keys())if("."!==h&&".."!==h){h=!1;break a}h=!0}f=!h}if(f)return-39;wf(a,b,c);0===e.Ja&&(e.status=Qa);return 0}async function Df(a,b){const c=a.g[b];5===c.status?await Df(qf(a,c),c.g):(c.size=0,delete a.h[b])}
of.prototype.kc=async function(a){const b=this.g[a];l(b,`Filesystem get_buffer: idx ${a} does not point to an inode`);return this.h[a]?this.h[a]:2===b.status?(l(b.Qc,"Filesystem get_data: found inode on server without sha256sum"),await this.j.read(b.Qc,0,b.size)):null};
async function If(a,b,c,d){const e=a.g[b];l(e,`Filesystem get_data: idx ${b} does not point to an inode`);return a.h[b]?a.h[b].subarray(c,c+d):2===e.status?(l(e.Qc,"Filesystem get_data: found inode on server without sha256sum"),await a.j.read(e.Qc,c,d)):null}async function Bf(a,b,c){a.h[b]=c;2===a.g[b].status&&(a.g[b].status=0,a.j.g(a.g[b].Qc))}
function ya(a,b){l(!isNaN(b),"Filesystem GetInode: NaN idx");l(0<=b&&b<a.g.length,"Filesystem GetInode: out of range idx:"+b);b=a.g[b];return 5===b.status?ya(qf(a,b),b.g):b}async function Ra(a,b,c){var d=ya(a,b),e=await If(a,b,0,d.size);if(c!==d.size){var f=new Uint8Array(c);d.size=c;e&&f.set(e.subarray(0,Math.min(e.length,d.size)),0);await Bf(a,b,f)}}
function Kf(a,b){b=b.replace("//","/");b=b.split("/");0<b.length&&0===b[b.length-1].length&&b.pop();0<b.length&&0===b[0].length&&b.shift();const c=b.length;var d=-1,e=0;let f=null;for(var h=0;h<c;h++)if(d=e,e=Ya(a,d,b[h]),!f&&5===a.g[d].status&&(f="/"+b.slice(h).join("/")),-1===e)return h<c-1?{id:-1,Ug:-1,name:b[h],Gh:f}:{id:-1,Ug:d,name:b[h],Gh:f};return{id:e,Ug:d,name:b[h],Gh:f}}
function Cf(a,b){var c=a.g[b];if(5===c.status)Cf(qf(a,c),c.g);else{var d=0;for(const e of c.ua.keys())d+=24+Lf.encode(e).length;b=a.h[b]=new Uint8Array(d);c.size=d;d=0;for(const [e,f]of c.ua)c=ya(a,f),d+=oa(["Q","d","b","s"],[c.Ua,d+13+8+1+2+Lf.encode(e).length,c.mode>>12,e],b,d)}}
function Sa(a,b,c){a=a.h[b];l(a,`FS directory data for dirid=${b} should be generated`);l(a.length,"FS directory should have at least an entry");if(c>=a.length)return a.length;for(b=0;;){const d=A(["Q","d"],a,{offset:b})[1];if(d>c)break;b=d}return b}function vf(a,b){b=a.g[b];return 5===b.status?vf(qf(a,b),b.g):(b.mode&61440)===Ia}
function Hf(a,b){l(vf(a,b),"Filesystem: cannot get children of non-directory inode");b=a.g[b];if(5===b.status)return Hf(qf(a,b),b.g);a=[];for(const c of b.ua.keys())"."!==c&&".."!==c&&a.push(c);return a}function Ff(a,b){l(vf(a,b),"Filesystem: cannot get parent of non-directory inode");b=a.g[b];if(5!==b.status||0===b.g)return b.ua.get("..");const c=Ff(qf(a,b),b.g);l(-1!==c,"Filesystem: should not have invalid parent ids");return Jf(a,b.i,c)}
function Gf(a,b,c,d){const e=a.g[b];l(0===e.Ja,"Filesystem: attempted to convert an inode into forwarder before unlinking the inode");5===e.status&&a.i[e.i].g.delete(e.g);e.status=5;e.i=c;e.g=d;a.i[c].g.set(d,b)}function zf(a,b,c){const d=sf(a),e=a.g.length;a.g.push(d);d.Ac=e;Gf(a,e,b,c);return e}function Jf(a,b,c){var d=a.i[b];l(0<=c,"Filesystem get_forwarder: invalid foreign_id: "+c);l(d,"Filesystem get_forwarder: invalid mount number: "+b);d=d.g.get(c);return void 0===d?zf(a,b,c):d}
function qf(a,b){a=a.i[b.i];l(5===b.status,"Filesystem follow_fs: inode should be a forwarding inode");l(a,"Filesystem follow_fs: inode<id="+b.Ac+"> should point to valid mounted FS");return a.h}function xf(){this.type=2;this.start=0;this.length=Infinity;this.g=-1;this.h=""}xf.prototype.ea=function(){const a=[];a[0]=this.type;a[1]=this.start;a[2]=Infinity===this.length?0:this.length;a[3]=this.g;a[4]=this.h;return a};
xf.prototype.I=function(a){this.type=a[0];this.start=a[1];this.length=0===a[2]?Infinity:a[2];this.g=a[3];this.h=a[4]};function Mf(a){const b=new xf;b.I(a.ea());return b}function Nf(a,b){return a.g===b.g&&a.h===b.h||2===a.type||2===b.type||1!==a.type&&1!==b.type||a.start+a.length<=b.start||b.start+b.length<=a.start?!1:!0}function Of(a,b){return b.g===a.g&&b.h===a.h&&b.type===a.type}function Pf(a,b){return Of(a,b)&&b.start+b.length===a.start}
function La(a,b,c,d,e){l(0===a||1===a||2===a,"Filesystem: Invalid lock type: "+a);l(0<=b,"Filesystem: Invalid negative lock starting offset: "+b);l(0<c,"Filesystem: Invalid non-positive lock length: "+c);const f=new xf;f.type=a;f.start=b;f.length=c;f.g=d;f.h=e;return f}function Pa(a,b,c){b=a.g[b];if(5===b.status){var d=b.g;return Pa(qf(a,b),d,c)}for(d of b.h)if(Nf(c,d))return Mf(d);return null}
function Ma(a,b,c,d){const e=a.g[b];if(5===e.status)return b=e.g,Ma(qf(a,e),b,c,d);c=Mf(c);if(2!==c.type&&Pa(a,b,c))return 1;for(a=0;a<e.h.length;a++){d=e.h[a];l(0<d.length,"Filesystem: Found non-positive lock region length: "+d.length);l(0===d.type||1===d.type,"Filesystem: Found invalid lock type: "+d.type);l(!e.h[a-1]||e.h[a-1].start<=d.start,"Filesystem: Locks should be sorted by starting offset");if(d.start+d.length<=c.start)continue;if(c.start+c.length<=d.start)break;if(d.g!==c.g||d.h!==c.h){l(!Nf(d,
c),"Filesytem: Found conflicting lock region, despite already checked for conflicts");continue}b=c.start+c.length;const f=c.start-d.start,h=d.start+d.length-b;if(0<f&&0<h&&d.type===c.type)return 0;0<f&&(d.length=f);if(0>=f&&0<h)d.start=b,d.length=h;else if(0<h){for(;a<e.h.length&&e.h[a].start<b;)a++;e.h.splice(a,0,La(d.type,b,h,d.g,d.h))}else 0>=f&&(e.h.splice(a,1),a--)}if(2!==c.type){a=c;d=!1;for(b=0;b<e.h.length&&!(Pf(a,e.h[b])&&(e.h[b].length+=c.length,a=e.h[b],d=!0),c.start<=e.h[b].start);b++);
d||(e.h.splice(b,0,a),b++);for(;b<e.h.length;b++)if(Of(e.h[b],a)){Pf(e.h[b],a)&&(a.length+=e.h[b].length,e.h.splice(b,1));break}}return 0}function Qf(a,b){b=Kf(a,b);if(-1!==b.id)return a=ya(a,b.id),Array.from(a.ua.keys()).filter(c=>"."!==c&&".."!==c)}of.prototype.Kf=function(a){a=Kf(this,a);if(-1===a.id)return Promise.resolve(null);const b=ya(this,a.id);return Ta(this,a.id,0,b.size)};function q(a){K([].slice.apply(arguments).join(" "),4194304)}function ab(){throw Error("message.Abort()");};const Rf=new TextDecoder,Lf=new TextEncoder;
function oa(a,b,c,d){for(var e,f=0,h=0;h<a.length;h++)switch(e=b[h],a[h]){case "w":c[d++]=e&255;c[d++]=e>>8&255;c[d++]=e>>16&255;c[d++]=e>>24&255;f+=4;break;case "d":c[d++]=e&255;c[d++]=e>>8&255;c[d++]=e>>16&255;c[d++]=e>>24&255;c[d++]=0;c[d++]=0;c[d++]=0;c[d++]=0;f+=8;break;case "h":c[d++]=e&255;c[d++]=e>>8;f+=2;break;case "b":c[d++]=e;f+=1;break;case "s":var g=d,m=0;c[d++]=0;c[d++]=0;f+=2;e=Lf.encode(e);f+=e.byteLength;m+=e.byteLength;c.set(e,d);d+=e.byteLength;c[g+0]=m&255;c[g+1]=m>>8&255;break;
case "Q":oa(["b","w","d"],[e.type,e.version,e.path],c,d);d+=13;f+=13;break;default:q("Marshall: Unknown type="+a[h])}return f}
function A(a,b,c){let d=c.offset;for(var e=[],f=0;f<a.length;f++)switch(a[f]){case "w":var h=b[d++];h+=b[d++]<<8;h+=b[d++]<<16;h+=b[d++]<<24>>>0;e.push(h);break;case "d":h=b[d++];h+=b[d++]<<8;h+=b[d++]<<16;h+=b[d++]<<24>>>0;d+=4;e.push(h);break;case "h":h=b[d++];e.push(h+(b[d++]<<8));break;case "b":e.push(b[d++]);break;case "s":h=b[d++];h+=b[d++]<<8;var g=b.slice(d,d+h);d+=h;e.push(Rf.decode(g));break;case "Q":c.offset=d;h=A(["b","w","d"],b,c);d=c.offset;e.push({type:h[0],version:h[1],path:h[2]});
break;default:q("Error in Unmarshall: Unknown type="+a[f])}c.offset=d;return e};const Sf="undefined"!==typeof window&&0<=window.navigator.platform.toString().toLowerCase().search("win");
function Tf(a){function b(w){!w.altKey&&m[56]&&h(56,!1);return e(w,!1)}function c(w){!w.altKey&&m[56]&&h(56,!1);return e(w,!0)}function d(){for(var w=Object.keys(m),r,E=0;E<w.length;E++)r=+w[E],m[r]&&h(r,!1);m={}}function e(w,r){if(x.A&&(w.shiftKey&&w.ctrlKey&&(73===w.keyCode||74===w.keyCode||75===w.keyCode)||!x.jg?0:w.target?w.target.classList.contains("phone_keyboard")||"INPUT"!==w.target.nodeName&&"TEXTAREA"!==w.target.nodeName:1)){w.preventDefault&&w.preventDefault();if(Sf&&(n&&(clearTimeout(t),
w.getModifierState&&w.getModifierState("AltGraph")&&p===r&&"ControlLeft"===n.code&&"AltRight"===w.code||f(n,p),n=null),"ControlLeft"===w.code))return n=w,p=r,t=setTimeout(()=>{f(n,p);n=null},10),!1;f(w,r);return!1}}function f(w,r){a:{if(void 0!==w.code){var E=u[w.code];if(void 0!==E)break a}E=y[w.keyCode]}E?h(E,r,w.repeat):console.log("Missing char in map: keyCode="+(w.keyCode||-1).toString(16)+" code="+w.code)}function h(w,r,E){if(r)m[w]&&!E&&h(w,!1);else if(!m[w])return;(m[w]=r)||(w|=128);255<w?
(g(w>>8),g(w&255)):g(w)}function g(w){x.A.send("keyboard-code",w)}var m={},n=null,p=!1,t=0,x=this;this.jg=!0;var y=new Uint16Array([0,0,0,0,0,0,0,0,14,15,0,0,0,28,0,0,42,29,56,0,58,0,0,0,0,0,0,1,0,0,0,0,57,57417,57425,57423,57415,57419,57416,57421,80,0,0,0,0,82,83,0,11,2,3,4,5,6,7,8,9,10,0,39,0,13,0,0,0,30,48,46,32,18,33,34,35,23,36,37,38,50,49,24,25,16,19,31,20,22,47,17,45,21,44,57435,57436,57437,0,0,82,79,80,81,75,76,77,71,72,73,0,0,0,0,0,0,59,60,61,62,63,64,65,66,67,68,87,88,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,69,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,0,0,0,0,0,0,0,0,0,0,0,0,39,13,51,12,52,53,41,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,26,43,27,40,0,57435,57400,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),F={8:8,10:13,32:32,39:222,44:188,45:189,46:190,47:191,48:48,49:49,50:50,51:51,52:52,53:53,54:54,55:55,56:56,57:57,59:186,61:187,91:219,92:220,93:221,96:192,97:65,98:66,99:67,100:68,101:69,102:70,103:71,104:72,105:73,106:74,107:75,108:76,109:77,110:78,111:79,112:80,
113:81,114:82,115:83,116:84,117:85,118:86,119:87,120:88,121:89,122:90},z={33:49,34:222,35:51,36:52,37:53,38:55,40:57,41:48,42:56,43:187,58:186,60:188,62:190,63:191,64:50,65:65,66:66,67:67,68:68,69:69,70:70,71:71,72:72,73:73,74:74,75:75,76:76,77:77,78:78,79:79,80:80,81:81,82:82,83:83,84:84,85:85,86:86,87:87,88:88,89:89,90:90,94:54,95:189,123:219,124:220,125:221,126:192},u={Escape:1,Digit1:2,Digit2:3,Digit3:4,Digit4:5,Digit5:6,Digit6:7,Digit7:8,Digit8:9,Digit9:10,Digit0:11,Minus:12,Equal:13,Backspace:14,
Tab:15,KeyQ:16,KeyW:17,KeyE:18,KeyR:19,KeyT:20,KeyY:21,KeyU:22,KeyI:23,KeyO:24,KeyP:25,BracketLeft:26,BracketRight:27,Enter:28,ControlLeft:29,KeyA:30,KeyS:31,KeyD:32,KeyF:33,KeyG:34,KeyH:35,KeyJ:36,KeyK:37,KeyL:38,Semicolon:39,Quote:40,Backquote:41,ShiftLeft:42,Backslash:43,KeyZ:44,KeyX:45,KeyC:46,KeyV:47,KeyB:48,KeyN:49,KeyM:50,Comma:51,Period:52,Slash:53,IntlRo:53,ShiftRight:54,NumpadMultiply:55,AltLeft:56,Space:57,CapsLock:58,F1:59,F2:60,F3:61,F4:62,F5:63,F6:64,F7:65,F8:66,F9:67,F10:68,NumLock:69,
ScrollLock:70,Numpad7:71,Numpad8:72,Numpad9:73,NumpadSubtract:74,Numpad4:75,Numpad5:76,Numpad6:77,NumpadAdd:78,Numpad1:79,Numpad2:80,Numpad3:81,Numpad0:82,NumpadDecimal:83,IntlBackslash:86,F11:87,F12:88,NumpadEnter:57372,ControlRight:57373,NumpadDivide:57397,AltRight:57400,Home:57415,ArrowUp:57416,PageUp:57417,ArrowLeft:57419,ArrowRight:57421,End:57423,ArrowDown:57424,PageDown:57425,Insert:57426,Delete:57427,OSLeft:57435,OSRight:57436,ContextMenu:57437};this.A=a;this.Aa=function(){"undefined"!==typeof window&&
(window.removeEventListener("keyup",b,!1),window.removeEventListener("keydown",c,!1),window.removeEventListener("blur",d,!1))};this.Eb=function(){"undefined"!==typeof window&&(this.Aa(),window.addEventListener("keyup",b,!1),window.addEventListener("keydown",c,!1),window.addEventListener("blur",d,!1))};this.Eb();this.g=function(w){w={keyCode:w};e(w,!0);e(w,!1)};this.wl=function(w){var r=w.charCodeAt(0);r in F?this.g(F[r]):r in z?(g(42),this.g(z[r]),g(170)):console.log("ascii -> keyCode not found: ",
r,w)}};function Uf(a,b){function c(u){if(!z.enabled||!z.jg)return!1;var w=b||document.body,r;if(!(r=document.pointerLockElement))a:{for(u=u.target;u.parentNode;){if(u===w){r=!0;break a}u=u.parentNode}r=!1}return r}function d(u){c(u)&&(u=u.changedTouches)&&u.length&&(u=u[u.length-1],y=u.clientX,F=u.clientY)}function e(){if(p||x||t)z.A.send("mouse-click",[!1,!1,!1]),p=x=t=!1}function f(u){if(z.A&&c(u)&&z.Cd){var w=0,r=0,E=u.changedTouches;E?E.length&&(E=E[E.length-1],w=E.clientX-y,r=E.clientY-F,y=E.clientX,
F=E.clientY,u.preventDefault()):"number"===typeof u.movementX?(w=u.movementX,r=u.movementY):"number"===typeof u.webkitMovementX?(w=u.webkitMovementX,r=u.webkitMovementY):"number"===typeof u.mozMovementX?(w=u.mozMovementX,r=u.mozMovementY):(w=u.clientX-y,r=u.clientY-F,y=u.clientX,F=u.clientY);z.A.send("mouse-delta",[.15*w,-(.15*r)]);b&&z.A.send("mouse-absolute",[u.pageX-b.offsetLeft,u.pageY-b.offsetTop,b.offsetWidth,b.offsetHeight])}}function h(u){c(u)&&m(u,!0)}function g(u){c(u)&&m(u,!1)}function m(u,
w){z.A&&(1===u.which?p=w:2===u.which?x=w:3===u.which?t=w:K("Unknown event.which: "+u.which),z.A.send("mouse-click",[p,x,t]),u.preventDefault())}function n(u){if(c(u)){var w=u.wheelDelta||-u.detail;0>w?w=-1:0<w&&(w=1);z.A.send("mouse-wheel",[w,0]);u.preventDefault()}}var p=!1,t=!1,x=!1,y=0,F=0,z=this;this.enabled=!1;this.jg=!0;this.A=a;this.A.register("mouse-enable",function(u){this.enabled=u},this);this.Cd=!1;this.A.register("emulator-stopped",function(){this.Cd=!1},this);this.A.register("emulator-started",
function(){this.Cd=!0},this);this.Aa=function(){"undefined"!==typeof window&&(window.removeEventListener("touchstart",d,!1),window.removeEventListener("touchend",e,!1),window.removeEventListener("touchmove",f,!1),window.removeEventListener("mousemove",f,!1),window.removeEventListener("mousedown",h,!1),window.removeEventListener("mouseup",g,!1),window.removeEventListener("wheel",n,{passive:!1}))};this.Eb=function(){"undefined"!==typeof window&&(this.Aa(),window.addEventListener("touchstart",d,!1),
window.addEventListener("touchend",e,!1),window.addEventListener("touchmove",f,!1),window.addEventListener("mousemove",f,!1),window.addEventListener("mousedown",h,!1),window.addEventListener("mouseup",g,!1),window.addEventListener("wheel",n,{passive:!1}))};this.Eb()};function Vf(a){if("undefined"!==typeof window)if(window.AudioContext||window.webkitAudioContext){var b=window.AudioWorklet?Wf:Xf;this.A=a;this.S=window.AudioContext?new AudioContext:new webkitAudioContext;this.rg=new Yf(a,this.S);this.h=new Zf(a,this.S,this.rg);this.g=new b(a,this.S,this.rg);this.h.start();a.register("emulator-stopped",function(){this.S.suspend()},this);a.register("emulator-started",function(){this.S.resume()},this);a.register("speaker-confirm-initialized",function(){a.send("speaker-has-initialized")},
this);a.send("speaker-has-initialized")}else console.warn("Web browser doesn't support Web Audio API")}Vf.prototype.Aa=function(){this.S&&this.S.close();this.S=null;this.g&&this.g.Ya&&this.g.Ya.port.close();this.g=null};
function Yf(a,b){function c(d){return function(e){d.gain.setValueAtTime(e,this.S.currentTime)}}this.S=b;this.sources=new Map;this.Jh=this.Ih=this.G=this.D=this.u=1;this.i=this.S.createBiquadFilter();this.j=this.S.createBiquadFilter();this.i.type="highshelf";this.j.type="highshelf";this.i.frequency.setValueAtTime(2E3,this.S.currentTime);this.j.frequency.setValueAtTime(2E3,this.S.currentTime);this.g=this.S.createBiquadFilter();this.h=this.S.createBiquadFilter();this.g.type="lowshelf";this.h.type="lowshelf";
this.g.frequency.setValueAtTime(200,this.S.currentTime);this.h.frequency.setValueAtTime(200,this.S.currentTime);this.l=this.S.createGain();this.o=this.S.createGain();this.C=this.S.createChannelMerger(2);this.J=this.i;this.N=this.j;this.i.connect(this.g);this.g.connect(this.l);this.l.connect(this.C,0,0);this.j.connect(this.h);this.h.connect(this.o);this.o.connect(this.C,0,1);this.C.connect(this.S.destination);a.register("mixer-connect",function(d){$f(this,d[0],d[1])},this);a.register("mixer-disconnect",
function(d){ag(this,d[0],d[1])},this);a.register("mixer-volume",function(d){var e=d[0],f=d[1];d=Math.pow(10,d[2]/20);var h=0===e?this:this.sources.get(e);void 0===h?l(!1,"Mixer set volume - cannot set volume for undefined source: "+e):h.Bg(d,f)},this);a.register("mixer-gain-left",function(d){this.Ih=Math.pow(10,d/20);this.update()},this);a.register("mixer-gain-right",function(d){this.Jh=Math.pow(10,d/20);this.update()},this);a.register("mixer-treble-left",c(this.i),this);a.register("mixer-treble-right",
c(this.j),this);a.register("mixer-bass-left",c(this.g),this);a.register("mixer-bass-right",c(this.h),this)}function bg(a,b,c){b=new cg(a.S,b,a.J,a.N);l(!a.sources.has(c),"Mixer add source - overwritting source: "+c);a.sources.set(c,b);return b}function $f(a,b,c){a=a.sources.get(b);void 0===a?l(!1,"Mixer connect - cannot connect undefined source: "+b):a.connect(c)}function ag(a,b,c){a=a.sources.get(b);void 0===a?l(!1,"Mixer disconnect - cannot disconnect undefined source: "+b):a.disconnect(c)}
Yf.prototype.Bg=function(a,b){void 0===b&&(b=2);switch(b){case 0:this.D=a;break;case 1:this.G=a;break;case 2:this.u=a;break;default:l(!1,"Mixer set master volume - unknown channel: "+b);return}this.update()};Yf.prototype.update=function(){var a=this.u*this.G*this.Jh;this.l.gain.setValueAtTime(this.u*this.D*this.Ih,this.S.currentTime);this.o.gain.setValueAtTime(a,this.S.currentTime)};
function cg(a,b,c,d){this.S=a;this.o=this.l=!0;this.D=this.C=this.j=this.g=1;this.u=a.createChannelSplitter(2);this.h=a.createGain();this.i=a.createGain();b.connect(this.u);this.u.connect(this.h,0);this.h.connect(c);this.u.connect(this.i,1);this.i.connect(d)}cg.prototype.update=function(){var a=this.o*this.g*this.j*this.D;this.h.gain.setValueAtTime(this.l*this.g*this.j*this.C,this.S.currentTime);this.i.gain.setValueAtTime(a,this.S.currentTime)};
cg.prototype.connect=function(a){var b=!a||2===a;if(b||0===a)this.l=!0;if(b||1===a)this.o=!0;this.update()};cg.prototype.disconnect=function(a){var b=!a||2===a;if(b||0===a)this.l=!1;if(b||1===a)this.o=!1;this.update()};cg.prototype.Bg=function(a,b){void 0===b&&(b=2);switch(b){case 0:this.C=a;break;case 1:this.D=a;break;case 2:this.j=a;break;default:l(!1,"Mixer set volume - unknown channel: "+b);return}this.update()};
function Zf(a,b,c){this.cf=b.createOscillator();this.cf.type="square";this.cf.frequency.setValueAtTime(440,b.currentTime);this.g=bg(c,this.cf,1);this.g.disconnect();a.register("pcspeaker-enable",function(){$f(c,1)},this);a.register("pcspeaker-disable",function(){ag(c,1)},this);a.register("pcspeaker-update",function(d){var e=d[1],f=0;3===d[0]&&(f=Math.min(1193181.6665999999/e,this.cf.frequency.maxValue),f=Math.max(f,0));this.cf.frequency.setValueAtTime(f,b.currentTime)},this)}Zf.prototype.start=function(){this.cf.start()};
function Wf(a,b,c){this.A=a;this.S=b;this.enabled=!1;this.Ib=48E3;b=function(){function e(g){if(0===g)return 1;g*=Math.PI;return Math.sin(g)/g}function f(){var g=Reflect.construct(AudioWorkletProcessor,[],f);g.D=3;g.u=Array(1024);g.C=0;g.J=0;g.j=0;g.G=g.u.length;g.l=0;g.N=h;g.g=h;g.P=1;g.o=0;g.i=0;g.h=0;g.port.onmessage=m=>{switch(m.data.type){case "queue":g.qa(m.data.value);break;case "sampling-rate":g.P=m.data.value/sampleRate}};return g}var h=[new Float32Array(256),new Float32Array(256)];Reflect.setPrototypeOf(f.prototype,
AudioWorkletProcessor.prototype);Reflect.setPrototypeOf(f,AudioWorkletProcessor);f.prototype.process=f.prototype.process=function(g,m){for(g=0;g<m[0][0].length;g++){for(var n=0,p=0,t=this.h+this.D,x=this.h-this.D+1;x<=t;x++){var y=this.o+x;n+=this.U(y,0)*this.X(this.i-x);p+=this.U(y,1)*this.X(this.i-x)}if(isNaN(n)||isNaN(p))n=p=0,this.R("ERROR: NaN values! Ignoring for now.");m[0][0][g]=n;m[0][1][g]=p;this.i+=this.P;this.h=Math.floor(this.i)}m=this.h;m+=this.D+2;this.i-=this.h;this.o+=this.h;this.h=
0;this.aa(m);return!0};f.prototype.X=function(g){return e(g)*e(g/this.D)};f.prototype.U=function(g,m){return 0>g?(g+=this.N[0].length,this.N[m][g]):this.g[m][g]};f.prototype.aa=function(g){var m=this.g[0].length;m-this.o<g&&(this.fa(),this.o-=m)};f.prototype.fa=function(){256>this.l&&this.j&&this.R("Not enough samples - should not happen during midway of playback");this.N=this.g;this.g=this.Z();var g=this.g[0].length;if(256>g){for(var m=this.C,n=0;256>g&&n<this.j;)g+=this.u[m][0].length,m=m+1&this.G-
1,n++;g=Math.max(g,256);g=[new Float32Array(g),new Float32Array(g)];g[0].set(this.g[0]);g[1].set(this.g[1]);m=this.g[0].length;for(var p=0;p<n;p++){var t=this.Z();g[0].set(t[0],m);g[1].set(t[1],m);m+=t[0].length}this.g=g}this.Hb()};f.prototype.Hb=function(){1024>this.l/this.P&&this.port.postMessage({type:"pump"})};f.prototype.qa=function(g){this.j<this.G&&(this.u[this.J]=g,this.J=this.J+1&this.G-1,this.j++,this.l+=g[0].length,this.Hb())};f.prototype.Z=function(){if(!this.j)return h;var g=this.u[this.C];
this.u[this.C]=null;this.C=this.C+1&this.G-1;this.j--;this.l-=g[0].length;return g};f.prototype.R=function(g){this.port.postMessage({type:"debug-log",value:g})};registerProcessor("dac-processor",f)}.toString();var d=URL.createObjectURL(new Blob(["var DEBUG = true;\n"+b.substring(b.indexOf("{")+1,b.lastIndexOf("}"))],{type:"application/javascript"}));this.Ya=null;this.g=this.S.createGain();this.S.audioWorklet.addModule(d).then(()=>{URL.revokeObjectURL(d);this.Ya=new AudioWorkletNode(this.S,"dac-processor",
{numberOfInputs:0,numberOfOutputs:1,outputChannelCount:[2],parameterData:{},processorOptions:{}});this.Ya.port.postMessage({type:"sampling-rate",value:this.Ib});this.Ya.port.onmessage=e=>{switch(e.data.type){case "pump":this.Hb();break;case "debug-log":K("SpeakerWorkletDAC - Worklet: "+e.data.value)}};this.Ya.connect(this.g)});this.i=bg(c,this.g,2);this.i.g=3;a.register("dac-send-data",function(e){this.Zg(e)},this);a.register("dac-enable",function(){this.enabled=!0},this);a.register("dac-disable",
function(){this.enabled=!1},this);a.register("dac-tell-sampling-rate",function(e){l(0<e,"Sampling rate should be nonzero");this.Ib=e;this.Ya&&this.Ya.port.postMessage({type:"sampling-rate",value:e})},this);this.h=new dg(this.S,this.g)}Wf.prototype.Zg=function(a){this.Ya&&(eg(this.h,a),this.Ya.port.postMessage({type:"queue",value:a},[a[0].buffer,a[1].buffer]))};Wf.prototype.Hb=function(){this.enabled&&this.A.send("dac-request-data")};
function Xf(a,b,c){this.A=a;this.S=b;this.enabled=!1;this.Ib=22050;this.g=0;this.Jf=1;this.tg=this.S.createBiquadFilter();this.tg.type="lowpass";this.h=this.tg;this.j=bg(c,this.h,2);this.j.g=3;a.register("dac-send-data",function(d){this.Zg(d)},this);a.register("dac-enable",function(){this.enabled=!0;this.Hb()},this);a.register("dac-disable",function(){this.enabled=!1},this);a.register("dac-tell-sampling-rate",function(d){l(0<d,"Sampling rate should be nonzero");this.Ib=d;this.Jf=Math.ceil(8E3/d);
this.tg.frequency.setValueAtTime(d/2,this.S.currentTime)},this);this.i=new dg(this.S,this.h)}
Xf.prototype.Zg=function(a){eg(this.i,a);var b=a[0].length,c=b/this.Ib;if(1<this.Jf){var d=this.S.createBuffer(2,b*this.Jf,this.Ib*this.Jf);for(var e=d.getChannelData(0),f=d.getChannelData(1),h=0,g=0;g<b;g++)for(var m=0;m<this.Jf;m++,h++)e[h]=a[0][g],f[h]=a[1][g]}else d=this.S.createBuffer(2,b,this.Ib),d.copyToChannel?(d.copyToChannel(a[0],0),d.copyToChannel(a[1],1)):(d.getChannelData(0).set(a[0]),d.getChannelData(1).set(a[1]));a=this.S.createBufferSource();a.buffer=d;a.connect(this.tg);a.addEventListener("ended",
this.Hb.bind(this));d=this.S.currentTime;if(this.g<d)for(K("Speaker DAC - Creating/Recreating reserve - shouldn't occur frequently during playback"),this.g=d,d=.2-c,b=0;b<=d;)b+=c,this.g+=c,setTimeout(()=>this.Hb(),1E3*b);a.start(this.g);this.g+=c;setTimeout(()=>this.Hb(),0)};Xf.prototype.Hb=function(){this.enabled&&(.2<this.g-this.S.currentTime||this.A.send("dac-request-data"))};
function dg(a,b){this.S=a;this.l=b;this.Ya=null;this.j=this.S.createGain();this.j.gain.setValueAtTime(0,this.S.currentTime);this.j.connect(this.S.destination);this.i=!1;this.u=[];this.o=[];this.h=[[],[]];this.g=[[],[]]}
dg.prototype.start=function(a){this.i=!0;this.h=[[],[]];this.g=[[],[]];this.u.push(this.h);this.o.push(this.g);this.Ya=this.S.createScriptProcessor(1024,2,2);this.Ya.onaudioprocess=b=>{this.g[0].push(b.inputBuffer.getChannelData(0).slice());this.g[1].push(b.inputBuffer.getChannelData(1).slice())};this.l.connect(this.Ya);this.Ya.connect(this.j);setTimeout(()=>{this.stop()},a)};dg.prototype.stop=function(){this.i=!1;this.l.disconnect(this.Ya);this.Ya.disconnect();this.Ya=null};
function eg(a,b){a.i&&(a.h[0].push(b[0].slice()),a.h[1].push(b[1].slice()))};function fg(a,b){function c(g){h.A&&h.enabled&&(h.i(g.which),g.preventDefault())}function d(g){var m=g.which;8===m?(h.i(127),g.preventDefault()):9===m&&(h.i(9),g.preventDefault())}function e(g){if(h.enabled){for(var m=g.clipboardData.getData("text/plain"),n=0;n<m.length;n++)h.i(m.charCodeAt(n));g.preventDefault()}}function f(g){g.target!==a&&a.blur()}var h=this;this.enabled=!0;this.A=b;this.text="";this.j=!1;this.h=0;this.A.register("serial0-output-byte",function(g){this.vl(String.fromCharCode(g))},
this);this.Aa=function(){a.removeEventListener("keypress",c,!1);a.removeEventListener("keydown",d,!1);a.removeEventListener("paste",e,!1);window.removeEventListener("mousedown",f,!1)};this.Eb=function(){this.Aa();a.style.display="block";a.addEventListener("keypress",c,!1);a.addEventListener("keydown",d,!1);a.addEventListener("paste",e,!1);window.addEventListener("mousedown",f,!1)};this.Eb();this.vl=function(g){"\b"===g?(this.text=this.text.slice(0,-1),this.update()):"\r"!==g&&(this.text+=g,"\n"===
g&&(this.j=!0),this.update())};this.update=function(){var g=Date.now(),m=g-this.h;16>m?void 0===this.g&&(this.g=setTimeout(()=>{this.g=void 0;var n=Date.now();l(15<=n-this.h);this.h=n;this.l()},16-m)):(void 0!==this.g&&(clearTimeout(this.g),this.g=void 0),this.h=g,this.l())};this.l=function(){a.value=this.text;this.j&&(this.j=!1,a.scrollTop=1E9)};this.i=function(g){h.A&&h.A.send("serial0-input",g)}}
function ub(a,b){this.element=a;if(window.Terminal){var c=this.g=new window.Terminal({logLevel:"off"});c.write("This is the serial console. Whatever you type or paste here will be sent to COM1");var d=c.onData(function(e){for(let f=0;f<e.length;f++)b.send("serial0-input",e.charCodeAt(f))});b.register("serial0-output-byte",function(e){c.write(Uint8Array.of(e))},this);this.Aa=function(){d.dispose();c.dispose()}}}ub.prototype.show=function(){this.g&&this.g.open(this.element)};function gg(a,b){this.A=b;this.g=void 0;this.id=0;this.h=[];this.url=a;this.i=Date.now()-1E4;this.A.register("net"+this.id+"-send",function(c){this.send(c)},this)}k=gg.prototype;k.Hj=function(a){this.A&&this.A.send("net"+this.id+"-receive",new Uint8Array(a.data))};k.Fj=function(){this.connect();setTimeout(this.connect.bind(this),1E4)};k.Ij=function(){for(var a=0;a<this.h.length;a++)this.send(this.h[a]);this.h=[]};k.Gj=function(){};k.Aa=function(){this.g&&this.g.close()};
k.connect=function(){if("undefined"!==typeof WebSocket){if(this.g){var a=this.g.readyState;if(0===a||1===a)return}if(!(this.i+1E4>Date.now())){this.i=Date.now();try{this.g=new WebSocket(this.url)}catch(b){console.error(b);return}this.g.binaryType="arraybuffer";this.g.onopen=this.Ij.bind(this);this.g.onmessage=this.Hj.bind(this);this.g.onclose=this.Fj.bind(this);this.g.onerror=this.Gj.bind(this)}}};
k.send=function(a){this.g&&1===this.g.readyState?this.g.send(a):(this.h.push(a),128<this.h.length&&(this.h=this.h.slice(-64)),this.connect())};function hb(a){"number"===typeof a.Oj&&(cb=a.Oj);this.bg=!1;this.C=function(){};var b=We();this.A=b[0];this.se=b[1];var c,d;const e=new WebAssembly.Table({element:"anyfunc",initial:1924});b={cpu_exception_hook:()=>this.C(),run_hardware_timers:function(h,g){var m=c;const n=m.v.wg.Sc(g,!1),p=m.v.Rd.Sc(g,!1);let t=100,x=100;h&&(t=m.v.xa.Sc(g),x=m.v.Te.Sc(g));return Math.min(n,p,t,x)},cpu_event_halt:()=>{this.se.send("cpu-event-halt")},abort:function(){l(!1)},microtick:Jb,get_rand_int:function(){return Qb()},
apic_acknowledge_irq:function(){var h=c.v.Te;var g=Nd(h);-1===g||Hd(h)>=g||(g&240)<=(h.u&240)?h=-1:(Id(h.i,g),Md(h.Xa,g),Gd(h),h=g);return h},stop_idling:function(){return c.Ni()},io_port_read8:function(h){var g=c.B,m=g.ports[h];m.$a===g.ig&&K("read8 port  #"+B(h,4)+Bb(h),32);g=m.$a.call(m.Ba);l("number"===typeof g);l(256>g&&0<=g,"8 bit port returned large value: "+B(h));return g},io_port_read16:function(h){var g=c.B,m=g.ports[h];m.Da===g.gg&&K("read16 port  #"+B(h,4)+Bb(h),32);g=m.Da.call(m.Ba);
l("number"===typeof g);l(65536>g&&0<=g,"16 bit port returned large value: "+B(h));return g},io_port_read32:function(h){return Ab(c.B,h)},io_port_write8:function(h,g){var m=c.B,n=m.ports[h];n.Ne===m.Rb&&K("write8 port #"+B(h,4)+" <- "+B(g,2)+Bb(h),32);n.Ne.call(n.Ba,g)},io_port_write16:function(h,g){var m=c.B,n=m.ports[h];n.Xd===m.Rb&&K("write16 port #"+B(h,4)+" <- "+B(g,4)+Bb(h),32);n.Xd.call(n.Ba,g)},io_port_write32:function(h,g){var m=c.B,n=m.ports[h];n.wa===m.Rb&&K("write32 port #"+B(h,4)+" <- "+
B(g>>>0,8)+Bb(h),32);n.wa.call(n.Ba,g)},mmap_read8:function(h){h=c.j[h>>>17](h);l(0<=h&&255>=h);return h},mmap_read16:function(h){var g=c.j[h>>>17];h=g(h)|g(h+1|0)<<8;l(0<=h&&65535>=h);return h},mmap_read32:function(h){return c.zb[h>>>17](h)},mmap_write8:function(h,g){var m=c;l(0<=g&&255>=g);m.Ff[h>>>17](h,g)},mmap_write16:function(h,g){var m=c.Ff[h>>>17];l(0<=g&&65535>=g);m(h,g&255);m(h+1|0,g>>8)},mmap_write32:function(h,g){c.Ef[h>>>17](h,g)},mmap_write64:function(h,g,m){var n=c,p=h>>>17;l(p===h+
7>>>17);n=n.Ef[p];n(h,g);n(h+4,m)},mmap_write128:function(h,g,m,n,p){var t=c,x=h>>>17;l(x===h+12>>>17);t=t.Ef[x];t(h,g);t(h+4,m);t(h+8,n);t(h+12,p)},log_from_wasm:function(h,g){h=String.fromCharCode(...(new Uint8Array(d.buffer,h>>>0,g>>>0)));K(h,2)},console_log_from_wasm:function(h,g){h=String.fromCharCode(...(new Uint8Array(d.buffer,h>>>0,g>>>0)));console.error(h)},dbg_trace_from_wasm:function(){K(Error().stack,2)},codegen_finalize:(h,g,m,n,p)=>{hf(c,h,g,m,n,p)},jit_clear_func:h=>{var g=c;l(0<=h&&
900>h);g.Na.mh.set(h+1024,null)},jit_clear_all_funcs:()=>{const h=c.Na.mh;for(let g=0;900>g;g++)h.set(1024+g,null)},__indirect_function_table:e};let f=a.gm;f||(f=h=>new Promise(g=>{let m="v86-debug.wasm",n="v86-fallback.wasm";if(a.Fl){m=a.Fl;const p=m.lastIndexOf("/");n=(-1===p?"":m.substr(0,p))+"/"+n}else"undefined"===typeof window&&"string"===typeof __dirname?(m=__dirname+"/"+m,n=__dirname+"/"+n):(m="build/"+m,n="build/"+n);Xb(m,{done:async p=>{try{const {instance:t}=await WebAssembly.instantiate(p,
h);this.u=p;g(t.exports)}catch(t){Xb(n,{done:async x=>{const {instance:y}=await WebAssembly.instantiate(x,h);this.u=x;g(y.exports)}})}},progress:p=>{this.se.send("download-progress",{yf:0,xf:1,zf:m,lengthComputable:p.lengthComputable,total:p.total,loaded:p.loaded})}})}));f({env:b}).then(h=>{d=h.memory;h.rust_init();h=this.Fa=new Db(this.se,{exports:h,mh:e});c=h.s;hg(this,h,a)});this.h=null;this.D=0}
async function hg(a,b,c){function d(x,y){switch(x){case "hda":f.K=this.ub.K=y;break;case "hdb":f.Zc=this.ub.Zc=y;break;case "cdrom":f.Y=this.ub.Y=y;break;case "fda":f.W=this.ub.W=y;break;case "fdb":f.te=this.ub.te=y;break;case "multiboot":f.Fb=this.ub.Fb=y.buffer;break;case "bzimage":f.Db=this.ub.Db=y.buffer;break;case "initrd":f.Ub=this.ub.Ub=y.buffer;break;case "bios":f.Cb=y.buffer;break;case "vga_bios":f.Rf=y.buffer;break;case "initial_state":f.lc=y.buffer;break;case "fs9p_json":f.Hh=y;break;default:l(!1,
x)}}async function e(){if(f.Bc&&f.Hh)if(f.lc)K("Filesystem basefs ignored: Overridden by state image");else{var x=f.Bc,y=f.Hh;l(y,"Invalid fs passed to load_from_json");if(3!==y.version)throw"The filesystem JSON format has changed. Please update your fs2json (https://github.com/copy/fs2json) and recreate the filesystem JSON.";var F=y.fsroot;x.o=y.size;for(y=0;y<F.length;y++)rf(x,F[y],0);if(c.Ue){const {Zi:z,Kj:u}=ig(f.Bc);K("Found bzimage: "+z+" and initrd: "+u);const [w,r]=await Promise.all([f.Bc.Kf(u),
f.Bc.Kf(z)]);d.call(this,"initrd",new Lb(w.buffer));d.call(this,"bzimage",new Lb(r.buffer))}}else l(!c.Ue||f.lc,"bzimage_initrd_from_filesystem: Requires a filesystem");this.pc&&this.pc.show&&this.pc.show();this.Fa.Eb(f);f.lc&&(b.ef(f.lc),f.lc=void 0);c.Vi&&this.Fa.Lf();this.se.send("emulator-loaded")}a.A.register("emulator-stopped",function(){this.bg=!1;this.oc.pause()},a);a.A.register("emulator-started",function(){this.bg=!0;this.oc.continue()},a);var f={};a.ub={W:void 0,te:void 0,K:void 0,Zc:void 0,
Y:void 0};var h=c.Lb?c.Lb:c.W?801:c.K?786:291;f.xa=c.xa;f.sf=c.sf;f.Nj=!0;f.F=c.F||67108864;f.la=c.la||8388608;f.Lb=h;f.Eh=c.Eh||!1;f.W=void 0;f.te=void 0;f.hf=c.hf;f.jf=c.jf;f.kf=c.kf;f.Mb=c.Mb;f.Ge=c.Ge;f.Vb=c.Vb;f.xd=c.xd;f.Vd=c.Vd;f.Me=c.Me;f.vi=c.vi;if(h=c.Zl||c.bf&&c.bf.Je)"fetch"===h?a.l=new jg(a.A):h.startsWith("wisp://")||h.startsWith("wisps://")?a.l=new kg(h,a.A,c):a.l=new gg(h,a.A);f.bf=c.bf||{type:"ne2k"};h=c.screen||{};c.rl&&(h.ag=c.rl);c.Ml||(a.o=new Tf(a.A));c.Nl||(a.j=new Uf(a.A,h.ag));
h.ag?a.oc=new bb(h,()=>a.Fa.s.v.Ud&&a.Fa.s.v.Ud.bh()):a.oc=new lg;f.screen=a.oc;f.vi=h;c.sl&&(a.pc=new fg(c.sl,a.A));c.tl&&(a.pc=new ub(c.tl,a.A));c.nj||(a.g=new Vf(a.A));var g=[];h=(x,y)=>{if(y)if(y.get&&y.set&&y.load)g.push({name:x,Df:y});else{if("bios"===x||"vga_bios"===x||"initial_state"===x||"multiboot"===x||"bzimage"===x||"initrd"===x)y.async=!1;if("fda"===x||"fdb"===x)y.async=!1;y.url&&!y.async?g.push({name:x,url:y.url,size:y.size}):g.push({name:x,Df:Pb(y,a.Gi.bind(a))})}};c.state&&console.warn("Warning: Unknown option 'state'. Did you mean 'initial_state'?");
h("bios",c.Cb);h("vga_bios",c.Rf);h("cdrom",c.Y);h("hda",c.K);h("hdb",c.Zc);h("fda",c.W);h("fdb",c.te);h("initial_state",c.lc);h("multiboot",c.Fb);h("bzimage",c.Db);h("initrd",c.Ub);if(c.filesystem){h=c.filesystem.Wi;var m=c.filesystem.Xf;let x=new mg;m&&(x=new ng(x,m));f.Bc=a.Bc=new of(x);if(h){l(m,"Filesystem: baseurl must be specified");if("object"===typeof h){var n=h.size;h=h.url}l("string"===typeof h);g.push({name:"fs9p_json",url:h,size:n,le:!0})}}var p=g.length,t=function(x){if(x===p)setTimeout(e.bind(this),
0);else{var y=g[x];y.Df?(y.Df.onload=function(){d.call(this,y.name,y.Df);t(x+1)}.bind(this),y.Df.load()):Xb(y.url,{done:function(F){if(y.url.endsWith(".zst")&&"initial_state"!==y.name){l(y.size,"A size must be provided for compressed images");var z=y.size,u=new Uint8Array(F);F=this.Fa.s;l(!this.i);this.i=F.Fi(u.length);(new Uint8Array(F.Ma.buffer)).set(u,F.Ii(this.i));u=F.lf(this.i,z);const w=F.Ma.buffer.slice(u,u+z);F.mf(u,z);F.Hi(this.i);this.i=null;F=w}d.call(this,y.name,y.le?F:new Lb(F));t(x+
1)}.bind(this),progress:function(F){200===F.target.status?a.se.send("download-progress",{yf:x,xf:p,zf:y.url,lengthComputable:F.lengthComputable,total:F.total||y.size,loaded:F.loaded}):a.se.send("download-error",{yf:x,xf:p,zf:y.url,request:F.target})},le:y.le})}}.bind(a);t(0)}k=hb.prototype;
k.Gi=async function(a,b){if(!this.h){const c=URL.createObjectURL(new Blob(["("+function(){let d;globalThis.onmessage=function(e){if(d){var f=e.data.src,h=e.data.lj;e=e.data.id;var g=d.exports,m=g.zstd_create_ctx(f.length);(new Uint8Array(g.memory.buffer)).set(f,g.zstd_get_src_ptr(m));f=g.zstd_read(m,h);var n=g.memory.buffer.slice(f,f+h);g.zstd_read_free(f,h);g.zstd_free_ctx(m);postMessage({result:n,id:e},[n])}else h=Object.fromEntries("cpu_exception_hook run_hardware_timers cpu_event_halt microtick get_rand_int apic_acknowledge_irq stop_idling io_port_read8 io_port_read16 io_port_read32 io_port_write8 io_port_write16 io_port_write32 mmap_read8 mmap_read16 mmap_read32 mmap_write8 mmap_write16 mmap_write32 mmap_write64 mmap_write128 codegen_finalize jit_clear_func jit_clear_all_funcs".split(" ").map(p=>
[p,()=>console.error("zstd worker unexpectedly called "+p)])),h.__indirect_function_table=new WebAssembly.Table({element:"anyfunc",initial:1024}),h.abort=()=>{throw Error("zstd worker aborted");},h.log_from_wasm=h.console_log_from_wasm=(p,t)=>{console.log(String.fromCharCode(...(new Uint8Array(d.exports.memory.buffer,p,t))))},h.dbg_trace_from_wasm=()=>console.trace(),d=new WebAssembly.Instance(new WebAssembly.Module(e.data),{env:h})}}.toString()+")()"],{type:"text/javascript"}));this.h=new Worker(c);
URL.revokeObjectURL(c);this.h.postMessage(this.u,[this.u])}return new Promise(c=>{const d=this.D++,e=async f=>{f.data.id===d&&(this.h.removeEventListener("message",e),l(a===f.data.result.byteLength),c(f.data.result))};this.h.addEventListener("message",e);this.h.postMessage({src:b,lj:a,id:d},[b.buffer])})};
function ig(a){const b=(Qf(a,"/")||[]).map(e=>"/"+e);a=(Qf(a,"/boot/")||[]).map(e=>"/boot/"+e);let c,d;for(const e of[].concat(b,a)){const f=/old/i.test(e)||/fallback/i.test(e),h=/initrd/i.test(e)||/initramfs/i.test(e);!/vmlinuz/i.test(e)&&!/bzimage/i.test(e)||d&&f||(d=e);!h||c&&f||(c=e)}c&&d||(console.log("Failed to find bzimage or initrd in filesystem. Files:"),console.log(b.join(" ")),console.log(a.join(" ")));return{Kj:c,Zi:d}}k.Lf=async function(){this.Fa.Lf()};
k.stop=async function(){this.bg&&await new Promise(a=>{const b=()=>{this.A.unregister("emulator-stopped",b);a()};ib(this,"emulator-stopped",b);this.Fa.stop()})};k.Aa=async function(){await this.stop();this.Fa.Aa();this.o&&this.o.Aa();this.l&&this.l.Aa();this.j&&this.j.Aa();this.oc&&this.oc.Aa();this.pc&&this.pc.Aa();this.g&&this.g.Aa()};k.$g=function(){this.Fa.$g()};function ib(a,b,c){a.A.register(b,c,a)}k.ef=async function(a){l(1===arguments.length);this.Fa.ef(a)};
k.Mf=async function(){l(0===arguments.length);return this.Fa.Mf()};k.Cd=function(){return this.bg};k.Nf=async function(a){if(a.url&&!a.async)Xb(a.url,{done:b=>{this.Fa.s.v.ue.Nf(new Lb(b))}});else{const b=Pb(a,this.Gi.bind(this));b.onload=()=>{this.Fa.s.v.ue.Nf(b)};await b.load()}};k.fg=function(){this.Fa.s.v.ue.fg()};function tb(a,b){for(var c=0;c<b.length;c++)a.A.send("keyboard-code",b[c])}function kb(a,b){for(var c=0;c<b.length;c++)a.o.wl(b[c])}
function sb(){var a=document.body,b=a.requestPointerLock||a.mozRequestPointerLock||a.webkitRequestPointerLock;b&&b.call(a)}k.fj=async function(a,b){l(2===arguments.length);var c=this.Bc;if(c){var d=a.split("/");d=d[d.length-1];var e=Kf(c,a).Ug;if(""!==d&&-1!==e)await Af(c,d,e,b);else return Promise.reject(new og)}};k.Kf=async function(a){l(1===arguments.length);var b=this.Bc;if(b)return(b=await b.Kf(a))?b:Promise.reject(new og)};function og(){this.message="File not found"}og.prototype=Error.prototype;
"undefined"!==typeof module&&"undefined"!==typeof module.exports?module.exports.V86=hb:"undefined"!==typeof window?window.V86=hb:"function"===typeof importScripts&&(self.V86=hb);function lg(){var a,b=0,c=0;this.j=function(d,e,f){l(0<=d&&d<c);l(0<=e&&e<b);a[d*b+e]=f};this.Aa=function(){};this.pause=function(){};this.continue=function(){};this.g=function(){};this.C=function(){};this.D=function(){};this.N=function(){};this.i=function(d,e){if(d!==b||e!==c)a=new Uint8Array(d*e),b=d,c=e};this.h=function(){};this.fh=function(){};this.J=function(){};this.G=function(){};this.l=function(){};this.i(80,25)};const pg=(new Date("1970-01-01T00:00:00Z")).getTime()-(new Date("1900-01-01T00:00:00Z")).getTime(),qg=Math.pow(2,32),rg=[118,56,54];function sg(a){return[0,1,2,3,4,5].map(b=>a[b].toString(16)).map(b=>1===b.length?"0"+b:b).join(":")}function tg(a){return a[0]<<24|a[1]<<16|a[2]<<8|a[3]}
function ug(a,b){let c=Date.now()+pg,d=c%1E3/1E3*qg,e={};e.Ca={jc:2048,src:b.wb,ma:a.Ca.src};e.da={Pc:17,src:a.da.ma,ma:a.da.src};e.La={ka:123,ga:a.La.ka};e.oa=Object.assign({},a.oa);e.oa.flags=36;e.oa.Zh=10;e.oa.Th=a.oa.jh;e.oa.Sh=a.oa.ih;e.oa.ui=c/1E3;e.oa.ti=d;e.oa.jh=c/1E3;e.oa.ih=d;e.oa.Ai=2;b.Pa(vg(e));return!0}
function wg(a,b){let c={};c.Ca={jc:2048,src:b.wb,ma:a.Ca.src};c.da={Pc:17,src:b.vb,ma:b.Tf};c.La={ka:67,ga:68};c.ta={Bf:1,Nh:6,Oh:0,nh:a.ta.nh,wi:0,flags:0,th:0,Ei:tg(b.Tf),zi:tg(b.vb),Lh:tg(b.vb),$f:a.ta.$f};let d=[],e=a.ta.options.find(function(f){return 53===f[0]});e&&3===e[2]&&(a.ta.df=3);1===a.ta.df&&(c.ta.df=2,d.push(new Uint8Array([53,1,2])));3===a.ta.df&&(c.ta.df=2,d.push(new Uint8Array([53,1,5])),d.push(new Uint8Array([51,4,8,0,0,0])));a=[b.vb[0],b.vb[1],b.vb[2],b.vb[3]];d.push(new Uint8Array([1,
4,255,255,255,0]));b.ze&&(d.push(new Uint8Array([3,4].concat(a))),d.push(new Uint8Array([6,4].concat(a))));d.push(new Uint8Array([54,4].concat(a)));d.push(new Uint8Array([60,3].concat(rg)));d.push(new Uint8Array([255,0]));c.ta.options=d;b.Pa(vg(c))}
function xg(a,b){var c=(new DataView(a.buffer,a.byteOffset,a.byteLength)).getUint16(12),d={jc:c,ma:a.subarray(0,6),Kl:sg(a.subarray(0,6)),src:a.subarray(6,12),em:sg(a.subarray(6,12))};b.Ca=d;a=a.subarray(14,a.length);if(2048===c){var e=new DataView(a.buffer,a.byteOffset,a.byteLength),f=a[0]>>4&15;d=a[0]&15;var h=e.getUint8(1),g=e.getUint16(2),m=e.getUint8(8);c=e.getUint8(9);e=e.getUint16(10);f={version:f,Ul:d,yl:h,xe:g,Gg:m,Pc:c,Wl:e,src:a.subarray(12,16),ma:a.subarray(16,20)};Math.max(g,46)!==a.length&&
K(`ipv4 Length mismatch: ${g} != ${a.length}`,16777216);b.da=f;a=a.subarray(4*d,g);1===c&&(d=a,g=new DataView(d.buffer,d.byteOffset,d.byteLength),d={type:g.getUint8(0),code:g.getUint8(1),sh:g.getUint16(2),data:d.subarray(4)},b.Tb=d);6===c&&(d=a,f=new DataView(d.buffer,d.byteOffset,d.byteLength),g={ka:f.getUint16(0),ga:f.getUint16(2),sa:f.getUint32(4),sb:f.getUint32(8),sj:f.getUint8(12)>>4,hb:f.getUint16(14),sh:f.getUint16(16),Al:f.getUint16(18)},f=f.getUint8(13),g.Ze=!!(f&1),g.Yb=!!(f&2),g.zg=!!(f&
4),g.pi=!!(f&8),g.Ga=!!(f&16),g.zl=!!(f&32),g.yj=!!(f&64),g.gj=!!(f&128),b.H=g,b.rb=d.subarray(4*g.sj));if(17===c){c=new DataView(a.buffer,a.byteOffset,a.byteLength);c={ka:c.getUint16(0),ga:c.getUint16(2),xe:c.getUint16(4),sh:c.getUint16(6),data:a.subarray(8),kj:(new TextDecoder).decode(a.subarray(8))};if(67===c.ga||67===c.ka){g=a.subarray(8);d=new DataView(g.buffer,g.byteOffset,g.byteLength);d={df:d.getUint8(0),Bf:d.getUint8(1),Nh:d.getUint8(2),Oh:d.getUint8(3),nh:d.getUint32(4),wi:d.getUint16(8),
flags:d.getUint16(10),th:d.getUint32(12),Ei:d.getUint32(16),zi:d.getUint32(20),Lh:d.getUint32(24),$f:g.subarray(28,44),Qh:d.getUint32(236),options:[]};g=g.subarray(240);for(f=0;f<g.length;++f)h=f,0!==g[f]&&(++f,m=g[f],f+=m,d.options.push(g.subarray(h,h+m+2)));b.ta=d;b.Ll=d.options}53!==c.ga&&53!==c.ka||yg(a.subarray(8),b);123===c.ga&&(a=a.subarray(8),a=new DataView(a.buffer,a.byteOffset,a.byteLength),b.oa={flags:a.getUint8(0),Ai:a.getUint8(1),Zh:a.getUint8(2),precision:a.getUint8(3),pl:a.getUint32(4),
ql:a.getUint32(8),ml:a.getUint32(12),ol:a.getUint32(16),nl:a.getUint32(20),Th:a.getUint32(24),Sh:a.getUint32(28),ui:a.getUint32(32),ti:a.getUint32(36),jh:a.getUint32(40),ih:a.getUint32(44)});b.La=c}}else 2054===c?(c=new DataView(a.buffer,a.byteOffset,a.byteLength),c={Bf:c.getUint16(0),yg:c.getUint16(2),vg:c.getUint16(6),gh:a.subarray(8,14),Dg:a.subarray(14,18),Bi:a.subarray(18,24),Pf:a.subarray(24,28)},b.Ia=c):34525===c?K("Unimplemented: ipv6"):K("Unknown ethertype: "+B(c),16777216)}
function yg(a,b){function c(){let n=[],p;do p=d.getUint8(g),n.push((new TextDecoder).decode(a.subarray(g+1,g+1+p))),g+=p+1;while(0<p);return n}let d=new DataView(a.buffer,a.byteOffset,a.byteLength),e={id:d.getUint16(0),flags:d.getUint16(2),Od:[],pf:[]};var f=d.getUint16(4);let h=d.getUint16(6);d.getUint16(8);d.getUint16(10);let g=12;for(var m=0;m<f;m++)e.Od.push({name:c(),type:d.getInt16(g),oe:d.getInt16(g+2)}),g+=4;for(f=0;f<h;f++){m={name:c(),type:d.getInt16(g),oe:d.getUint16(g+2),Gg:d.getUint32(g+
4)};g+=8;let n=d.getUint16(g);g+=2;m.data=a.subarray(g,g+n);g+=n;e.pf.push(m)}b.jb=e}
function vg(a){let b=new Uint8Array(1518);l(a.Ca);var c=new DataView(b.buffer,b.byteOffset,b.byteLength);c.setUint16(12,a.Ca.jc);for(var d=0;6>d;++d)c.setUint8(d,a.Ca.ma[d]);for(d=0;6>d;++d)c.setUint8(6+d,a.Ca.src[d]);c=14;if(a.Ia){d=b.subarray(14);d=new DataView(d.buffer,d.byteOffset,d.byteLength);d.setUint16(0,a.Ia.Bf);d.setUint16(2,a.Ia.yg);d.setUint8(4,a.Ia.gh.length);d.setUint8(5,a.Ia.Dg.length);d.setUint16(6,a.Ia.vg);for(var e=0;6>e;++e)d.setUint8(8+e,a.Ia.gh[e]),d.setUint8(18+e,a.Ia.Bi[e]);
for(e=0;4>e;++e)d.setUint8(14+e,a.Ia.Dg[e]),d.setUint8(24+e,a.Ia.Pf[e]);c+=28}if(a.da){e=b.subarray(14);d=new DataView(e.buffer,e.byteOffset,e.byteLength);var f=20;if(a.Tb){var h=e.subarray(20);h=new DataView(h.buffer,h.byteOffset,h.byteLength);h.setUint8(0,a.Tb.type);h.setUint8(1,a.Tb.code);h.setUint16(2,0);for(var g=0;g<a.Tb.data.length;++g)h.setUint8(g+4,a.Tb.data[g]);g=0;for(var m=0;m<4+a.Tb.data.length;m+=2)g+=h.getUint16(m),65535<g&&(g=(g&65535)+1);h.setUint16(2,g^65535);f+=4+a.Tb.data.length}if(a.La){g=
e.subarray(20);h=new DataView(g.buffer,g.byteOffset,g.byteLength);if(a.ta){var n=g.subarray(8);n=new DataView(n.buffer,n.byteOffset,n.byteLength);n.setUint8(0,a.ta.df);n.setUint8(1,a.ta.Bf);n.setUint8(2,a.ta.Nh);n.setUint8(3,a.ta.Oh);n.setUint32(4,a.ta.nh);n.setUint16(8,a.ta.wi);n.setUint16(10,a.ta.flags);n.setUint32(12,a.ta.th);n.setUint32(16,a.ta.Ei);n.setUint32(20,a.ta.zi);n.setUint32(24,a.ta.Lh);for(var p=0;p<a.ta.$f.length;++p)n.setUint8(28+p,a.ta.$f[p]);n.setUint32(236,1669485411);p=240;for(var t of a.ta.options)for(g=
0;g<t.length;++g)n.setUint8(p,t[g]),++p;n=p}else if(a.jb){t=g.subarray(8);t=new DataView(t.buffer,t.byteOffset,t.byteLength);t.setUint16(0,a.jb.id);t.setUint16(2,a.jb.flags);t.setUint16(4,a.jb.Od.length);t.setUint16(6,a.jb.pf.length);g=12;for(m=0;m<a.jb.Od.length;++m){var x=a.jb.Od[m];for(p of x.name){t.setUint8(g,p.length);g++;for(let y=0;y<p.length;++y)t.setUint8(g,p.charCodeAt(y)),g++}t.setUint16(g,x.type);g+=2;t.setUint16(g,x.oe);g+=2}for(m=0;m<a.jb.pf.length;++m){p=a.jb.pf[m];for(n of p.name)for(t.setUint8(g,
n.length),g++,x=0;x<n.length;++x)t.setUint8(g,n.charCodeAt(x)),g++;t.setUint16(g,p.type);g+=2;t.setUint16(g,p.oe);g+=2;t.setUint32(g,p.Gg);g+=4;t.setUint16(g,p.data.length);g+=2;for(x=0;x<p.data.length;++x)t.setUint8(g+x,p.data[x]);g+=p.data.length}n=g}else if(a.oa)n=g.subarray(8),n=new DataView(n.buffer,n.byteOffset,n.byteLength),n.setUint8(0,a.oa.flags),n.setUint8(1,a.oa.Ai),n.setUint8(2,a.oa.Zh),n.setUint8(3,a.oa.precision),n.setUint32(4,a.oa.pl),n.setUint32(8,a.oa.ql),n.setUint32(12,a.oa.ml),
n.setUint32(16,a.oa.ol),n.setUint32(20,a.oa.nl),n.setUint32(24,a.oa.Th),n.setUint32(28,a.oa.Sh),n.setUint32(32,a.oa.ui),n.setUint32(36,a.oa.ti),n.setUint32(40,a.oa.jh),n.setUint32(44,a.oa.ih),n=48;else for(p=a.La.data,n=p.length,t=0;t<p.length;++t)h.setUint8(8+t,p[t]);h.setUint16(0,a.La.ka);h.setUint16(2,a.La.ga);h.setUint16(4,8+n);h.setUint16(6,0);f+=8+n}if(a.H){n=f;e=e.subarray(20);e=new DataView(e.buffer,e.byteOffset,e.byteLength);p=0;t=a.H;t.Ze&&(p|=1);t.Yb&&(p|=2);t.zg&&(p|=4);t.pi&&(p|=8);t.Ga&&
(p|=16);t.zl&&(p|=32);t.yj&&(p|=64);t.gj&&(p|=128);e.setUint16(0,t.ka);e.setUint16(2,t.ga);e.setUint32(4,t.sa);e.setUint32(8,t.sb);e.setUint8(12,80);e.setUint8(13,p);e.setUint16(14,t.hb);e.setUint16(16,0);e.setUint16(18,t.Al||0);t=20+(a.rb?a.rb.length:0);p=0;f=new Uint8Array(12);f=new DataView(f.buffer,f.byteOffset,f.byteLength);for(h=0;4>h;++h)f.setUint8(h,a.da.src[h]),f.setUint8(4+h,a.da.ma[h]);f.setUint8(9,6);f.setUint16(10,t);for(t=0;6>t;++t)p+=f.getUint16(t<<1),65535<p&&(p=(p&65535)+1);for(t=
0;10>t;++t)p+=e.getUint16(t<<1),65535<p&&(p=(p&65535)+1);if(a.rb)for(t=0;t<a.rb.length;t+=2)p+=a.rb[t]<<8|a.rb[t+1],65535<p&&(p=(p&65535)+1);e.setUint16(16,p^65535);f=n+20}if(a.rb){for(e=0;e<a.rb.length;++e)d.setUint8(f+e,a.rb[e]);f+=a.rb.length}d.setUint8(0,69);d.setUint8(1,a.da.yl||0);d.setUint16(2,f);d.setUint16(4,a.da.id||0);d.setUint8(6,64);d.setUint8(8,a.da.Gg||32);d.setUint8(9,a.da.Pc);d.setUint16(10,0);for(e=0;4>e;++e)d.setUint8(12+e,a.da.src[e]),d.setUint8(16+e,a.da.ma[e]);a=0;for(e=0;10>
e;++e)a+=d.getUint16(e<<1),65535<a&&(a=(a&65535)+1);d.setUint16(10,a^65535);c+=f}return b.subarray(0,c)}function zg(){this.g=new Uint8Array([]);this.J=[]}function Ag(a){let b={};b.Ca={jc:2048,src:a.u,ma:a.o};b.da={Pc:6,src:a.G,ma:a.D};b.H={ka:a.ka,ga:a.ga,hb:a.hb,sb:a.Ga,sa:a.sa,Ga:!0};return b}k=zg.prototype;k.connect=function(){this.sa=1338;this.Ga=1;this.h=0;this.hb=64240;this.state="syn-sent";let a=Ag(this);a.da.id=2345;a.H={ka:this.ka,ga:this.ga,sa:1337,sb:0,hb:0,Yb:!0};this.gb.Pa(vg(a))};
k.accept=function(a){this.sa=1338;this.Ga=a.H.sa+1;this.h=a.H.sa;this.u=this.gb.wb;this.G=a.da.ma;this.ka=a.H.ga;this.o=a.Ca.src;this.ga=a.H.ka;this.D=a.da.src;this.hb=a.H.hb;let b=Ag(this);b.H={ka:this.ka,ga:this.ga,sa:1337,sb:this.Ga,hb:a.H.hb,Yb:!0,Ga:!0};this.gb.Pa(vg(b))};
k.process=function(a){if(a.H.Yb)l(a.H.Ga),l("syn-sent"===this.state),this.Ga=a.H.sa+1,this.h=a.H.sa,this.i=a.H.sb,this.gb.Pa(vg(Ag(this))),this.state="established",this.C&&this.C.call(this);else if(a.H.Ze){K(`All done with ${this.j} resetting`,16777216);this.Ga!==a.H.sa&&(K("Closing the connecton, but seq was wrong",16777216),++this.Ga);var b=Ag(this);b.H={ka:a.H.ga,ga:a.H.ka,sa:this.sa,sb:this.Ga,hb:a.H.hb,zg:!0};delete this.gb.Rc[this.j];this.gb.Pa(vg(b))}else this.Ga!==a.H.sa?(K(`Packet seq was wrong ex: ${this.Ga} ~${this.Ga-
this.h} pk: ${a.H.sa} ~${this.h-a.H.sa} (${this.Ga-a.H.sa}) = ${this.name}`,16777216),b=Ag(this),b.H={ka:a.H.ga,ga:a.H.ka,sa:this.sa,sb:this.Ga,hb:a.H.hb,Ga:!0},this.gb.Pa(vg(b))):(this.J.push(`${a.H.sa-this.h}:${a.H.sa+a.rb.length-this.h}`),this.Ga+=a.rb.length,0<a.rb.length&&this.gb.Pa(vg(Ag(this))),void 0===this.i&&(this.i=a.H.sb),b=a.H.sb-this.i,0<b&&(this.i=a.H.sb,this.g=this.g.subarray(b),this.sa+=b,this.pending=!1),0>b||(this.l(a.rb),this.Hb()))};
k.write=function(a){if(0<this.g.length){let b=new Uint8Array(this.g.byteLength+a.byteLength);b.set(this.g,0);b.set(a,this.g.byteLength);this.g=b}else this.g=a;this.Hb()};k.close=function(){this.state="fin-wait-1";let a=Ag(this);a.H.Ze=!0;this.gb.Pa(vg(a));this.Hb()};k.Hb=function(){if(0<this.g.length&&!this.pending){let a=this.g.subarray(0,500),b=Ag(this);this.pending=!0;1>this.g.length&&(b.H.Ze=!0);b.H.pi=!0;b.rb=a;this.gb.Pa(vg(b))}};
function Bg(a,b){var c=tg(a.Ia.Pf)&4294967040;let d=tg(b.vb)&4294967040;!b.ze&&c!==d||c===d&&99<a.Ia.Pf[3]||(c={},c.Ca={jc:2054,src:b.wb,ma:a.Ca.src},c.Ia={Bf:1,yg:2048,vg:2,gh:b.wb,Dg:a.Ia.Pf,Bi:a.Ca.src,Pf:a.Ia.Dg},b.Pa(vg(c)))}function Cg(a,b){let c={};c.Ca={jc:2048,src:b.wb,ma:a.Ca.src};c.da={Pc:17,src:a.da.ma,ma:a.da.src};c.La={ka:a.La.ga,ga:a.La.ka,data:(new TextEncoder).encode(a.La.kj)};b.Pa(vg(c))};function kg(a,b,c){Dg(this,a);this.j=1;this.g={0:{qf:0}};this.i=[];c=c||{};this.A=b;this.id=c.id||0;this.wb=new Uint8Array((c.wb||"52:54:0:1:2:3").split(":").map(function(d){return parseInt(d,16)}));this.vb=new Uint8Array((c.vb||"192.168.86.1").split(".").map(function(d){return parseInt(d,10)}));this.Tf=new Uint8Array((c.Tf||"192.168.86.100").split(".").map(function(d){return parseInt(d,10)}));this.ze=void 0===c.ze||!!c.ze;new Uint8Array(6);this.Bh=c.Bh||"cloudflare-dns.com";this.Rc={};this.A.register("net"+
this.id+"-mac",function(d){new Uint8Array(d.split(":").map(function(e){return parseInt(e,16)}))},this);this.A.register("net"+this.id+"-send",function(d){this.send(d)},this)}
function Dg(a,b){a.h=new WebSocket(b.replace("wisp://","ws://").replace("wisps://","wss://"));a.h.binaryType="arraybuffer";a.h.onmessage=c=>{c=new Uint8Array(c.data);const d=new DataView(c.buffer),e=d.getUint32(1,!0);switch(c[0]){case 1:K("Server sent client-only packet CONNECT",1048576);break;case 2:if(a.g[e])a.g[e].Og(c.slice(5));else throw Error("Got a DATA packet but stream not registered. ID: "+e);break;case 3:a.g[e]&&(a.g[e].qf=d.getUint32(5,!0));if(a.g[e].uh){for(const f of a.i)Eg(a,f.data,
f.type,e);a.g[e].uh=!1}break;case 4:a.g[e]&&a.g[e].Mg(d.getUint8(5));delete a.g[e];break;case 5:K("got a wisp V2 upgrade request, ignoring",1048576);break;default:K("Wisp server returned unknown packet: "+c[0],1048576)}};a.h.onclose=()=>{setTimeout(()=>{Dg(a,b)},1E4)}}function Eg(a,b,c,d){0<a.g[d].qf?("DATA"===c&&a.g[d].qf--,a.h.send(b)):(a.g[d].uh=!0,a.i.push({data:b,type:c}))}
function Fg(a,b){let c,d;switch(b.type){case "CONNECT":const e=(new TextEncoder).encode(b.hostname);c=new Uint8Array(8+e.length);d=new DataView(c.buffer);d.setUint8(0,1);d.setUint32(1,b.pd,!0);d.setUint8(5,1);d.setUint16(6,b.port,!0);c.set(e,8);a.g[b.pd]={Og:b.Og,Mg:b.Mg,qf:a.g[0].qf};break;case "DATA":c=new Uint8Array(5+b.data.length);d=new DataView(c.buffer);d.setUint8(0,2);d.setUint32(1,b.pd,!0);c.set(b.data,5);break;case "CLOSE":c=new Uint8Array(6);d=new DataView(c.buffer);d.setUint8(0,4);d.setUint32(1,
b.pd,!0);d.setUint8(5,b.reason);break;default:K("Client tried to send unknown packet: "+b.type,1048576)}Eg(a,c,b.type,b.pd)}kg.prototype.Aa=function(){this.h&&(this.h.onmessage=null,this.h.onclose=null,this.h.close(),this.h=null)};
kg.prototype.send=function(a){let b={};xg(a,b);if(b.H){a={};a.Ca={jc:2048,src:this.wb,ma:b.Ca.src};a.da={Pc:6,src:b.da.ma,ma:b.da.src};var c=[b.da.src.join("."),b.H.ka,b.da.ma.join("."),b.H.ga].join(":");if(b.H.Yb){this.Rc[c]&&K("SYN to already opened port",16777216);const d=new zg;d.state="syn-received";d.gb=this;d.j=c;d.pd=this.j++;this.Rc[c]=d;d.l=e=>{0!==e.length&&Fg(this,{type:"DATA",pd:d.pd,data:e})};Fg(this,{type:"CONNECT",pd:d.pd,hostname:b.da.ma.join("."),port:b.H.ga,Og:e=>{d.write(e)},Mg:()=>
{d.close()}});d.accept(b);return}if(!this.Rc[c]){K(`I dont know about ${c}, so restting`,16777216);c=b.H.sb;if(b.H.Ze||b.H.Yb)c+=1;a.H={ka:b.H.ga,ga:b.H.ka,sa:c,sb:b.H.sa+(b.H.Yb?1:0),hb:b.H.hb,zg:!0,Ga:b.H.Yb};this.Pa(vg(a));return}this.Rc[c].process(b)}b.Ia&&1===b.Ia.vg&&2048===b.Ia.yg&&Bg(b,this);b.jb&&(async()=>{let d={};d.Ca={jc:2048,src:this.wb,ma:b.Ca.src};d.da={Pc:17,src:this.vb,ma:b.da.src};d.La={ka:53,ga:b.La.ka};const e=await (await fetch(`https://${this.Bh}/dns-query`,{method:"POST",headers:[["content-type",
"application/dns-message"]],body:b.La.data})).arrayBuffer();d.La.data=new Uint8Array(e);this.Pa(vg(d))})();b.oa?ug(b,this):b.ta?wg(b,this):b.La&&8===b.La.ga&&Cg(b,this)};kg.prototype.Pa=function(a){this.A.send("net"+this.id+"-receive",new Uint8Array(a))};function jg(a,b){b=b||{};this.A=a;this.id=b.id||0;this.wb=new Uint8Array((b.wb||"52:54:0:1:2:3").split(":").map(function(c){return parseInt(c,16)}));this.vb=new Uint8Array((b.vb||"192.168.86.1").split(".").map(function(c){return parseInt(c,10)}));this.Tf=new Uint8Array((b.Tf||"192.168.86.100").split(".").map(function(c){return parseInt(c,10)}));this.ze=void 0===b.ze||!!b.ze;new Uint8Array(6);this.Rc={};this.Ng=b.Ng;this.A.register("net"+this.id+"-mac",function(c){new Uint8Array(c.split(":").map(function(d){return parseInt(d,
16)}))},this);this.A.register("net"+this.id+"-send",function(c){this.send(c)},this)}jg.prototype.Aa=function(){};
async function Gg(a){if(a&&(this.read=this.read||"",(this.read+=(new TextDecoder).decode(a))&&-1!==this.read.indexOf("\r\n\r\n"))){var b=this.read.indexOf("\r\n\r\n");a=this.read.substring(0,b).split(/\r\n/);b=this.read.substring(b+4);this.read="";let c=a[0].split(" "),d;d=/^https?:/.test(c[1])?new URL(c[1]):new URL("http://host"+c[1]);"undefined"!==typeof window&&"http:"===d.protocol&&"https:"===window.location.protocol&&(d.protocol="https:");let e=new Headers;for(let m=1;m<a.length;++m){let n=a[m].split(": "),
p=n[0].toLowerCase(),t=n[1];"host"===p?d.host=t:1<p.length&&e.set(n[0],t)}K("HTTP Dispatch: "+d.href,16777216);this.name=d.href;a={method:c[0],headers:e};-1!==["put","post"].indexOf(a.method.toLowerCase())&&(a.body=b);const [f,h]=await this.gb.fetch(d.href,a),g=[`HTTP/1.1 ${f.status} ${f.statusText}`,"connection: Closed","content-length: "+h.byteLength];g.push("x-was-fetch-redirected: "+String(f.redirected));g.push("x-fetch-resp-url: "+String(f.url));f.headers.forEach(function(m,n){-1===["content-encoding",
"connection","content-length","transfer-encoding"].indexOf(n.toLowerCase())&&g.push(n+": "+m)});g.push("");g.push("");this.write((new TextEncoder).encode(g.join("\r\n")));this.write(new Uint8Array(h))}}
jg.prototype.fetch=async function(a,b){this.Ng&&(a=this.Ng+encodeURIComponent(a));try{const c=await fetch(a,b),d=await c.arrayBuffer();return[c,d]}catch(c){return console.warn("Fetch Failed: "+a+"\n"+c),b=new Headers,b.set("Content-Type","text/plain"),[{status:502,statusText:"Fetch Error",headers:b},(new TextEncoder).encode(`Fetch ${a} failed:\n\n${c.stack}`).buffer]}};
jg.prototype.send=function(a){{let f={};xg(a,f);if(!(a=!f.H)){b:{a=f;var b={};b.Ca={jc:2048,src:this.wb,ma:a.Ca.src};b.da={Pc:6,src:a.da.ma,ma:a.da.src};var c=[a.da.src.join("."),a.H.ka,a.da.ma.join("."),a.H.ga].join(":");if(a.H.Yb){this.Rc[c]&&K("SYN to already opened port",16777216);var d=c;if(80===a.H.ga){var e=new zg;e.state="syn-received";e.gb=this;e.l=Gg;e.j=d;e.accept(a);this.Rc[d]=e;d=!0}else d=!1;if(d){a=void 0;break b}}if(this.Rc[c])this.Rc[c].process(a),a=void 0;else{K(`I dont know about ${c}, so restting`,
16777216);c=a.H.sb;if(a.H.Ze||a.H.Yb)c+=1;b.H={ka:a.H.ga,ga:a.H.ka,sa:c,sb:a.H.sa+(a.H.Yb?1:0),hb:a.H.hb,zg:!0,Ga:a.H.Yb};this.Pa(vg(b));a=!0}}a=!a}if(a){f.Ia&&1===f.Ia.vg&&2048===f.Ia.yg&&Bg(f,this);if(!(a=!f.jb)){a=f;b={};b.Ca={jc:2048,src:this.wb,ma:a.Ca.src};b.da={Pc:17,src:this.vb,ma:a.da.src};b.La={ka:53,ga:a.La.ka};c=[];for(d=0;d<a.jb.Od.length;++d)switch(e=a.jb.Od[d],e.type){case 1:c.push({name:e.name,type:e.type,oe:e.oe,Gg:600,data:[192,168,87,1]})}b.jb={id:a.jb.id,flags:33152,Od:a.jb.Od,
pf:c};this.Pa(vg(b));a=!1}!a||f.oa&&ug(f,this)||(f.Tb&&8===f.Tb.type&&(a=f,b={},b.Ca={jc:2048,src:this.wb,ma:a.Ca.src},b.da={Pc:1,src:this.vb,ma:a.da.src},b.Tb={type:0,code:a.Tb.code,data:a.Tb.data},this.Pa(vg(b))),f.ta&&wg(f,this)||f.La&&8===f.La.ga&&Cg(f,this))}}};jg.prototype.Pa=function(a){this.A.send("net"+this.id+"-receive",new Uint8Array(a))};"undefined"!==typeof module&&"undefined"!==typeof module.exports&&(module.exports.FetchNetworkAdapter=jg);const jb={xl:function(a){return jb.kl(a)+jb.jl(a)},kl:function(a){let b="";var c="COMPILE COMPILE_SKIPPED_NO_NEW_ENTRY_POINTS COMPILE_WRONG_ADDRESS_SPACE COMPILE_CUT_OFF_AT_END_OF_PAGE COMPILE_WITH_LOOP_SAFETY COMPILE_PAGE COMPILE_PAGE/COMPILE COMPILE_BASIC_BLOCK COMPILE_DUPLICATED_BASIC_BLOCK COMPILE_WASM_BLOCK COMPILE_WASM_LOOP COMPILE_DISPATCHER COMPILE_ENTRY_POINT COMPILE_WASM_TOTAL_BYTES COMPILE_WASM_TOTAL_BYTES/COMPILE_PAGE RUN_INTERPRETED RUN_INTERPRETED_NEW_PAGE RUN_INTERPRETED_PAGE_HAS_CODE RUN_INTERPRETED_PAGE_HAS_ENTRY_AFTER_PAGE_WALK RUN_INTERPRETED_NEAR_END_OF_PAGE RUN_INTERPRETED_DIFFERENT_STATE RUN_INTERPRETED_DIFFERENT_STATE_CPL3 RUN_INTERPRETED_DIFFERENT_STATE_FLAT RUN_INTERPRETED_DIFFERENT_STATE_IS32 RUN_INTERPRETED_DIFFERENT_STATE_SS32 RUN_INTERPRETED_MISSED_COMPILED_ENTRY_RUN_INTERPRETED RUN_INTERPRETED_STEPS RUN_FROM_CACHE RUN_FROM_CACHE_STEPS RUN_FROM_CACHE_STEPS/RUN_FROM_CACHE RUN_FROM_CACHE_STEPS/RUN_INTERPRETED_STEPS DIRECT_EXIT INDIRECT_JUMP INDIRECT_JUMP_NO_ENTRY NORMAL_PAGE_CHANGE NORMAL_FALLTHRU NORMAL_FALLTHRU_WITH_TARGET_BLOCK NORMAL_BRANCH NORMAL_BRANCH_WITH_TARGET_BLOCK CONDITIONAL_JUMP CONDITIONAL_JUMP_PAGE_CHANGE CONDITIONAL_JUMP_EXIT CONDITIONAL_JUMP_FALLTHRU CONDITIONAL_JUMP_FALLTHRU_WITH_TARGET_BLOCK CONDITIONAL_JUMP_BRANCH CONDITIONAL_JUMP_BRANCH_WITH_TARGET_BLOCK DISPATCHER_SMALL DISPATCHER_LARGE LOOP LOOP_SAFETY CONDITION_OPTIMISED CONDITION_UNOPTIMISED CONDITION_UNOPTIMISED_PF CONDITION_UNOPTIMISED_UNHANDLED_L CONDITION_UNOPTIMISED_UNHANDLED_LE FAILED_PAGE_CHANGE SAFE_READ_FAST SAFE_READ_SLOW_PAGE_CROSSED SAFE_READ_SLOW_NOT_VALID SAFE_READ_SLOW_NOT_USER SAFE_READ_SLOW_IN_MAPPED_RANGE SAFE_WRITE_FAST SAFE_WRITE_SLOW_PAGE_CROSSED SAFE_WRITE_SLOW_NOT_VALID SAFE_WRITE_SLOW_NOT_USER SAFE_WRITE_SLOW_IN_MAPPED_RANGE SAFE_WRITE_SLOW_READ_ONLY SAFE_WRITE_SLOW_HAS_CODE SAFE_READ_WRITE_FAST SAFE_READ_WRITE_SLOW_PAGE_CROSSED SAFE_READ_WRITE_SLOW_NOT_VALID SAFE_READ_WRITE_SLOW_NOT_USER SAFE_READ_WRITE_SLOW_IN_MAPPED_RANGE SAFE_READ_WRITE_SLOW_READ_ONLY SAFE_READ_WRITE_SLOW_HAS_CODE PAGE_FAULT TLB_MISS MAIN_LOOP MAIN_LOOP_IDLE DO_MANY_CYCLES CYCLE_INTERNAL INVALIDATE_ALL_MODULES_NO_FREE_WASM_INDICES INVALIDATE_MODULE_WRITTEN_WHILE_COMPILED INVALIDATE_MODULE_UNUSED_AFTER_OVERWRITE INVALIDATE_MODULE_DIRTY_PAGE INVALIDATE_PAGE_HAD_CODE INVALIDATE_PAGE_HAD_ENTRY_POINTS DIRTY_PAGE_DID_NOT_HAVE_CODE RUN_FROM_CACHE_EXIT_SAME_PAGE RUN_FROM_CACHE_EXIT_NEAR_END_OF_PAGE RUN_FROM_CACHE_EXIT_DIFFERENT_PAGE CLEAR_TLB FULL_CLEAR_TLB TLB_FULL TLB_GLOBAL_FULL MODRM_SIMPLE_REG MODRM_SIMPLE_REG_WITH_OFFSET MODRM_SIMPLE_CONST_OFFSET MODRM_COMPLEX SEG_OFFSET_OPTIMISED SEG_OFFSET_NOT_OPTIMISED SEG_OFFSET_NOT_OPTIMISED_ES SEG_OFFSET_NOT_OPTIMISED_FS SEG_OFFSET_NOT_OPTIMISED_GS SEG_OFFSET_NOT_OPTIMISED_NOT_FLAT".split(" "),
d=0;const e={};for(let h=0;h<c.length;h++){const g=c[h];var f=void 0;if(g.includes("/")){d++;const [m,n]=g.split("/");f=e[m]/e[n]}else f=e[g]=a.Na.exports.profiler_stat_get(h-d),f=1E8<=f?Math.round(f/1E6)+"m":1E5<=f?Math.round(f/1E3)+"k":f;b+=g+"="+f+"\n"}b+="\n";c=a.Na.exports.get_valid_tlb_entries_count();d=a.Na.exports.get_valid_global_tlb_entries_count();b=b+("TLB_ENTRIES="+c+" ("+d+" global, "+(c-d)+" non-global)\nWASM_TABLE_FREE=")+(a.Na.exports.jit_get_wasm_table_index_free_list_count()+"\n");
b+="JIT_CACHE_SIZE="+a.Na.exports.jit_get_cache_size()+"\n";b+="FLAT_SEGMENTS="+a.Na.exports.has_flat_segmentation()+"\n";b+="wasm memory size: "+(a.Ma.buffer.byteLength>>20)+"m\n";b=b+"Config:\nJIT_DISABLED="+(a.Na.exports.get_jit_config(0)+"\n");b+="MAX_PAGES="+a.Na.exports.get_jit_config(1)+"\n";b+="JIT_USE_LOOP_SAFETY="+!!a.Na.exports.get_jit_config(2)+"\n";return b+="MAX_EXTRA_BASIC_BLOCKS="+a.Na.exports.get_jit_config(3)+"\n"},jl:function(a){return[jb.If(a,!1,!1,!1,!1),jb.If(a,!0,!1,!1,!1),
jb.If(a,!1,!0,!1,!1),jb.If(a,!1,!1,!0,!1),jb.If(a,!1,!1,!1,!0)].join("\n\n")},If:function(a,b,c,d,e){let f="";var h=[],g=b?"compiled":c?"jit exit":d?"unguarded register":e?"wasm size":"executed";for(let p=0;256>p;p++)for(let t=0;8>t;t++)for(const x of[!1,!0]){var m=a.Na.exports.get_opstats_buffer(b,c,d,e,p,!1,x,t);h.push({ug:p,count:m,Ph:x,Fh:t});m=a.Na.exports.get_opstats_buffer(b,c,d,e,p,!0,x,t);h.push({ug:3840|p,count:m,Ph:x,Fh:t})}a=0;b=new Set([38,46,54,62,100,101,102,103,240,242,243]);for(const {count:p,
ug:t}of h)b.has(t)||(a+=p);if(0===a)return"";c=new Uint32Array(256);b=new Uint32Array(256);for(const {ug:p,count:t}of h)3840===(p&65280)?b[p&255]+=t:c[p&255]+=t;f=f+"------------------\nTotal: "+(a+"\n");const n=1E7<a?1E3:1;d=Math.max.apply(Math,h.map(({count:p})=>Math.round(p/n)));d=String(d).length;f+=`Instruction counts ${g} (in ${n}):\n`;for(e=0;256>e;e++)f+=e.toString(16).padStart(2,"0")+":"+fb(Math.round(c[e]/n),d),f=15===e%16?f+"\n":f+" ";f=f+"\n"+`Instruction counts ${g} (0f, in ${n}):\n`;
for(g=0;256>g;g++)f+=(g&255).toString(16).padStart(2,"0")+":"+fb(Math.round(b[g]/n),d),f=15===g%16?f+"\n":f+" ";f+="\n";h=h.filter(({count:p})=>p).sort(({count:p},{count:t})=>t-p);for(const {ug:p,Ph:t,Fh:x,count:y}of h.slice(0,200))f+=p.toString(16)+"_"+x+(t?"_m":"_r")+":"+(y/a*100).toFixed(2)+" ";return f+"\n"}};"undefined"!==typeof module&&"undefined"!==typeof module.exports&&(module.exports.print_stats=jb);function mg(){this.h=new Map}mg.prototype.read=async function(a,b,c){l(a,"MemoryFileStorage read: sha256sum should be a non-empty string");return(a=this.h.get(a))?a.subarray(b,b+c):null};mg.prototype.cache=async function(a,b){l(a,"MemoryFileStorage cache: sha256sum should be a non-empty string");this.h.set(a,b)};mg.prototype.g=function(a){this.h.delete(a)};function ng(a,b){l(b,"ServerMemoryFileStorage: baseurl should not be empty");b.endsWith("/")||(b+="/");this.h=a;this.Xf=b}
function Hg(a,b){return new Promise(c=>{Xb(a.Xf+b,{done:async d=>{d=new Uint8Array(d);await a.cache(b,d);c(d)}})})}ng.prototype.read=async function(a,b,c){const d=await this.h.read(a,b,c);return d?d:(await Hg(this,a)).subarray(b,b+c)};ng.prototype.cache=async function(a,b){return await this.h.cache(a,b)};ng.prototype.g=function(a){this.h.g(a)};
